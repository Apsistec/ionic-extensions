{"version":3,"file":"html-editor-module.umd.js","sources":["../../../node_modules/tslib/tslib.es6.js","ng://@co.mmons/ionic-extensions/html-editor/alignment.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/commands/toogle-block-mark.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/alignment/commands.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/marks/font-size.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/marks/alignment.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/nodes/youtube.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/schema.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/utils/selection/find-block-marks.ts","ng://@co.mmons/ionic-extensions/html-editor/alignment-menu.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/keymap.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/views/youtube.ts","ng://@co.mmons/ionic-extensions/html-editor/scroll.ts","ng://@co.mmons/ionic-extensions/html-editor/editor.ts","ng://@co.mmons/ionic-extensions/html-editor/heading-menu.ts","ng://@co.mmons/ionic-extensions/html-editor/link-type.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/utils/find-marks.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/utils/find-marks-in-selection.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/utils/find-node-start-end.ts","ng://@co.mmons/ionic-extensions/html-editor/link-modal.ts","ng://@co.mmons/ionic-extensions/html-editor/insert-menu.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/commands/filter.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/commands/is-empty-selection-at-start.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/commands/is-first-child-of-parent.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/document-utils.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/list/transforms/lift-following-list.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/list/utils/get-list-lift-target.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/list/transforms/lift-selection-list.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/mark-utils.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/utils.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/utils/find-cut-before.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/list-commands.ts","ng://@co.mmons/ionic-extensions/html-editor/list-menu.ts","ng://@co.mmons/ionic-extensions/html-editor/font-sizes.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/commands/toogle-inline-mark.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/is-active.ts","ng://@co.mmons/ionic-extensions/html-editor/text-format-menu.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/utils/selection/is-block-mark-active.ts","ng://@co.mmons/ionic-extensions/html-editor/toolbar.ts","ng://@co.mmons/ionic-extensions/html-editor/index.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import {MessageRef} from \"@co.mmons/js-intl\";\n\nexport class Alignment {\n\n    private static _alignments: Alignment[] = [];\n\n    static alignments() {\n        return Alignment._alignments.slice();\n    }\n\n    static readonly left = new Alignment(\"left\");\n    static readonly right = new Alignment(\"right\");\n    static readonly center = new Alignment(\"center\");\n    static readonly justify = new Alignment(\"justify\");\n\n    private constructor(public readonly alignment: string) {\n\n        Alignment._alignments.push(this);\n\n        this.label = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"alignmentMenu/\" + alignment);\n    }\n\n    readonly label: MessageRef;\n}\n","import {MarkType, Node as PMNode, NodeType, Schema} from \"prosemirror-model\";\nimport {Transaction} from \"prosemirror-state\";\nimport {Command} from \"../command\";\n\n/**\n * Toggles block mark based on the return type of `getAttrs`.\n * This is similar to ProseMirror\"s `getAttrs` from `AttributeSpec`\n * return `false` to remove the mark.\n * return `undefined for no-op.\n * return an `object` to update the mark.\n */\nexport const toggleBlockMark = <T = object>(\n    markType: MarkType,\n    getAttrs: ((prevAttrs?: T, node?: PMNode) => T | undefined | false),\n    allowedBlocks?:\n        | Array<NodeType>\n        | ((schema: Schema, node: PMNode, parent: PMNode) => boolean),\n): Command => (state, dispatch) => {\n    let markApplied = false;\n    const tr = state.tr;\n\n    const toggleBlockMarkOnRange = (from: number, to: number, tr: Transaction) => {\n\n        state.doc.nodesBetween(from, to, (node, pos, parent) => {\n\n            if (!node.type.isBlock) {\n                return false;\n            }\n\n            if (\n                (!allowedBlocks || (Array.isArray(allowedBlocks) ? allowedBlocks.indexOf(node.type) > -1 : allowedBlocks(state.schema, node, parent))) &&\n                parent.type.allowsMarkType(markType)\n            ) {\n\n                const oldMarks = node.marks.filter(mark => mark.type === markType);\n\n                const prevAttrs = oldMarks.length ? (oldMarks[0].attrs as T) : undefined;\n                const newAttrs = getAttrs(prevAttrs, node);\n\n                if (newAttrs !== undefined) {\n\n                    tr.setNodeMarkup(\n                        pos,\n                        node.type,\n                        node.attrs,\n                        node.marks\n                            .filter(mark => !markType.excludes(mark.type))\n                            .concat(newAttrs === false ? [] : markType.create(newAttrs)),\n                    );\n\n                    markApplied = true;\n                }\n            }\n\n            return;\n\n        });\n    };\n\n    const {from, to} = state.selection;\n    toggleBlockMarkOnRange(from, to, tr);\n\n    if (markApplied && tr.docChanged) {\n        if (dispatch) {\n            dispatch(tr.scrollIntoView());\n        }\n        return true;\n    }\n\n    return false;\n};\n","import {EditorState, Transaction} from \"prosemirror-state\";\nimport {Command, CommandDispatch} from \"../command\";\nimport {toggleBlockMark} from \"../commands/toogle-block-mark\";\nimport {AlignmentState} from \"./alignment-state\";\n\n/**\n * Iterates over the commands one after the other,\n * passes the tr through and dispatches the cumulated transaction\n */\nexport const cascadeCommands = (cmds: Array<Command>) => (\n    state: EditorState,\n    dispatch?: CommandDispatch,\n) => {\n    const {tr: baseTr} = state;\n    let shouldDispatch = false;\n\n    const onDispatchAction = (tr: Transaction) => {\n        tr.steps.forEach(st => {\n            baseTr.step(st);\n        });\n        shouldDispatch = true;\n    };\n\n    cmds.forEach(cmd => {\n        cmd(state, onDispatchAction);\n    });\n\n    if (dispatch && shouldDispatch) {\n        dispatch(baseTr);\n        return true;\n    }\n    return false;\n};\n\nexport const isAlignable = (align?: AlignmentState): Command => (state, dispatch) => {\n\n    const {\n        nodes: {paragraph, heading},\n        marks: {alignment},\n    } = state.schema;\n\n    return toggleBlockMark(\n        alignment,\n        () => (!align ? undefined : align === \"left\" ? false : {align}),\n        [paragraph, heading],\n    )(state, dispatch);\n};\n\nexport const changeAlignment = (align?: AlignmentState): Command => (state, dispatch) => {\n\n    const {\n        nodes: {paragraph, heading},\n        marks: {alignment}\n    } = state.schema;\n\n    return toggleBlockMark(alignment,\n        () => (!align ? undefined : align === \"left\" ? false : {align}),\n        [paragraph, heading],\n    )(state, dispatch);\n};\n","import {MarkSpec} from \"prosemirror-model\";\n\nexport const fontSize: MarkSpec = {\n    excludes: \"fontSize\",\n    group: \"fontSize\",\n    attrs: {\n        fontSize: {},\n    },\n    parseDOM: [\n        {\n            tag: \"span[data-font-size]\",\n            getAttrs: dom => {\n                const size = (dom as Element).getAttribute(\"data-font-size\");\n                return size ? {fontSize: size} : false;\n            },\n        },\n    ],\n    toDOM(mark) {\n        return [\n            \"span\",\n            {style: `font-size: ${mark.attrs.fontSize}`, \"data-font-size\": mark.attrs.fontSize},\n            0\n        ];\n    },\n};\n","import {MarkSpec} from \"prosemirror-model\";\n\nexport const alignment: MarkSpec = {\n    excludes: \"alignment\",\n    group: \"alignment\",\n    attrs: {\n        align: {},\n    },\n    parseDOM: [\n        {\n            tag: \"div[data-align]\",\n            getAttrs: dom => {\n                const align = (dom as Element).getAttribute(\"data-align\");\n                return align ? {align} : false;\n            },\n        },\n    ],\n    toDOM(mark) {\n        return [\n            \"div\",\n            {\n                style: `text-align: ${mark.attrs.align}`,\n                \"data-align\": mark.attrs.align,\n            },\n            0\n        ];\n    },\n};\n","import {NodeSpec} from \"prosemirror-model\";\n\nexport const youtube: NodeSpec = {\n    attrs: {id: {default: \"\"}, start: {default: 0}},\n    inline: false,\n    group: \"block\",\n    draggable: false,\n\n    toDOM: (node) => {\n\n        return [\n            \"div\",\n            {\"data-youtube\": node.attrs.id + (node.attrs.start ? \",\" + node.attrs.start : \"\")},\n            \"youtube\"\n        ];\n    },\n\n    parseDOM: [\n        {\n            tag: \"div[data-youtube]\",\n            getAttrs: (dom) => {\n\n                // @ts-ignore\n                const info = dom.getAttribute(\"data-youtube\").split(\",\");\n\n                return {\n                    id: info[0],\n                    start: info.length > 1 ? info[1] : 0\n                };\n            },\n        }\n    ]\n};\n","import {MarkSpec, NodeSpec, Schema} from \"prosemirror-model\";\nimport {marks as basicMarks, nodes as basicNodes} from \"prosemirror-schema-basic\";\nimport {bulletList, listItem, orderedList} from \"prosemirror-schema-list\";\nimport {fontSize} from \"./marks/font-size\";\nimport {alignment} from \"./marks/alignment\";\nimport {youtube} from \"./nodes/youtube\";\n\nexport const nodes = {\n    doc: {\n        content: \"block+\",\n        marks: \"alignment\",\n    },\n\n    paragraph: {\n        content: \"inline*\",\n        marks: \"alignment strong underline em fontSize link\",\n        group: \"block\",\n        parseDOM: [{tag: \"p\"}],\n        toDOM() { return [\"p\", 0]; }\n    } as NodeSpec,\n\n    blockquote: basicNodes.blockquote,\n    horizontalRule: basicNodes.horizontal_rule,\n    heading: basicNodes.heading,\n    text: basicNodes.text,\n    hardBreak: basicNodes.hard_break,\n\n    bulletList: Object.assign({}, bulletList, {\n        content: \"listItem+\",\n        group: \"block\"\n    }) as NodeSpec,\n\n    orderedList: Object.assign({}, orderedList, {\n        content: \"listItem+\",\n        group: \"block\"\n    }) as NodeSpec,\n\n    listItem: Object.assign({}, listItem, {\n        content: \"paragraph block*\",\n        marks: \"alignment\"\n    }) as NodeSpec,\n\n    youtube\n};\n\nexport const marks = {\n    link: basicMarks.link,\n    em: basicMarks.em,\n    strong: basicMarks.strong,\n    alignment,\n    fontSize: fontSize,\n\n    underline: {\n        parseDOM: [{tag: \"u\"}, {style: \"text-decoration=underline\"}],\n        toDOM() {\n            return [\"u\", 0];\n        }\n    } as MarkSpec\n};\n\nexport const schema = new Schema<keyof typeof nodes, keyof typeof marks>({nodes: nodes, marks: marks});\n\n","import {Mark, MarkType} from \"prosemirror-model\";\nimport {EditorState} from \"prosemirror-state\";\n\nexport function findBlockMarks(state: EditorState, markType: MarkType) {\n\n    const marks: Mark[] = [];\n\n    const {from, to} = state.selection;\n\n    state.doc.nodesBetween(from, to, (node, pos, parent) => {\n\n        if (!node.type.isBlock) {\n            return false;\n        }\n\n        for (const mark of node.marks) {\n            if (mark.type === markType) {\n                marks.push(mark);\n            }\n        }\n\n    });\n\n\n    return marks;\n}\n","import {Component, Input, OnInit} from \"@angular/core\";\nimport {PopoverController} from \"@ionic/angular\";\nimport {Alignment} from \"./alignment\";\nimport {HtmlEditor} from \"./editor\";\nimport {changeAlignment} from \"./prosemirror/alignment/commands\";\nimport {schema} from \"./prosemirror/schema\";\nimport {findBlockMarks} from \"./prosemirror/utils/selection/find-block-marks\";\n\n@Component({\n    styles: [`\n        :host ion-list { margin: 0px; padding: 0px; }\n        :host ion-item:last-child { --border-width: 0px; }\n    `],\n    template: `\n        <ion-list lines=\"full\">\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleAligment(alignment)\" *ngFor=\"let alignment of Alignment.alignments()\">\n                <ion-label>{{alignment.label | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"active === alignment.alignment\"></ion-icon>\n                <ion-icon src=\"assets/html-editor/align-{{alignment.alignment}}.svg\" slot=\"start\"></ion-icon>\n            </ion-item>\n\n        </ion-list>\n    `\n})\nexport class AlignmentMenu implements OnInit {\n\n    Alignment = Alignment;\n\n    constructor(private popoverController: PopoverController) {\n    }\n\n    @Input()\n    private editor: HtmlEditor;\n\n    active: string;\n\n    toggleAligment(alignment: Alignment) {\n\n        const command = changeAlignment(<any>alignment.alignment);\n\n        if (command(this.editor.state)) {\n            command(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        }\n\n        this.popoverController.dismiss();\n    }\n\n    ngOnInit() {\n\n        this.active = undefined;\n\n        for (const mark of findBlockMarks(this.editor.state, schema.marks.alignment)) {\n\n            // zaznaczonych wiele blocków z różnym wyrównaniem\n            if (this.active && this.active !== mark.attrs.align) {\n                this.active = undefined;\n                break;\n            }\n\n            this.active = mark.attrs.align;\n        }\n    }\n\n    ionViewWillLeave() {\n        this.editor.focus();\n    }\n}\n","import {joinDown, joinUp, lift, selectParentNode, toggleMark} from \"prosemirror-commands\";\nimport {redo, undo} from \"prosemirror-history\";\nimport {undoInputRule} from \"prosemirror-inputrules\";\nimport {Schema} from \"prosemirror-model\";\nimport {splitListItem} from \"prosemirror-schema-list\";\n\nconst mac = typeof navigator !== \"undefined\" ? /Mac/.test(navigator.platform) : false;\n\nexport function buildKeymap(schema: Schema, mapKeys?: any) {\n\n    const keys = {};\n    let type: any;\n\n    function bind(key, cmd) {\n\n        if (mapKeys) {\n            const mapped = mapKeys[key];\n\n            if (mapped === false) {\n                return;\n            }\n\n            if (mapped) {\n                key = mapped;\n            }\n        }\n\n        keys[key] = cmd;\n    }\n\n\n    bind(\"Mod-z\", undo);\n    bind(\"Shift-Mod-z\", redo);\n    bind(\"Backspace\", undoInputRule);\n    if (!mac) {\n        bind(\"Mod-y\", redo);\n    }\n\n    bind(\"Alt-ArrowUp\", joinUp);\n    bind(\"Alt-ArrowDown\", joinDown);\n    bind(\"Mod-BracketLeft\", lift);\n    bind(\"Escape\", selectParentNode);\n\n    if (type = schema.marks.strong) {\n        bind(\"Mod-b\", toggleMark(type));\n        bind(\"Mod-B\", toggleMark(type));\n    }\n\n    if (type = schema.marks.em) {\n        bind(\"Mod-i\", toggleMark(type));\n        bind(\"Mod-I\", toggleMark(type));\n    }\n\n    if (type = schema.marks.underline) {\n        bind(\"Mod-u\", toggleMark(type));\n        bind(\"Mod-U\", toggleMark(type));\n    }\n\n    if (type = schema.nodes.listItem) {\n        bind(\"Enter\", splitListItem(type));\n    }\n\n    if (type = schema.nodes.hardBreak) {\n\n        const br = type;\n\n        const cmd = (state, dispatch) => {\n            dispatch(state.tr.replaceSelectionWith(br.create()).scrollIntoView());\n            return true;\n        };\n\n        bind(\"Mod-Enter\", cmd);\n        bind(\"Shift-Enter\", cmd);\n\n        if (mac) {\n            bind(\"Ctrl-Enter\", cmd);\n        }\n    }\n\n    return keys;\n}\n","import {EventManager} from \"@angular/platform-browser\";\nimport {Node} from \"prosemirror-model\";\nimport {removeSelectedNode} from \"prosemirror-utils\";\nimport {EditorView, NodeView} from \"prosemirror-view\";\n\nexport function createYoutubeIframe(id: string, start?: string) {\n\n    const iframe = document.createElement(\"iframe\");\n    iframe.height = \"200px\";\n    iframe.width = \"100%\";\n    iframe.src = `https://www.youtube.com/embed/${id}${start ? \"?start=\" + start : \"\"}`;\n    iframe.frameBorder = \"0\";\n    iframe.allow = \"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\";\n    iframe.allowFullscreen = true;\n\n    return iframe;\n}\n\n// https://www.youtube.com/watch?v=m3V7_Ov52sY\nexport class YoutubeNodeView implements NodeView {\n\n    constructor(node: Node, protected view: EditorView, eventManager: EventManager) {\n\n        this.dom = document.createElement(\"div\");\n        this.dom.style.position = \"relative\";\n        this.dom.style.overflow = \"hidden\";\n        this.dom.style.height = \"200px\";\n        this.dom.style.marginTop = \"16px\";\n        this.dom.setAttribute(\"no-blur\", \"\");\n\n        this.dom.appendChild(createYoutubeIframe(node.attrs.id, node.attrs.start));\n\n        const overlay = this.dom.appendChild(document.createElement(\"div\"));\n        overlay.style.position = \"absolute\";\n        overlay.style.left = \"0px\";\n        overlay.style.top = \"0px\";\n        overlay.style.width = \"100%\";\n        overlay.style.height = \"200px\";\n        overlay.style.display = \"flex\";\n        overlay.style.justifyContent = \"center\";\n\n        const button = overlay.appendChild(document.createElement(\"ion-button\"));\n        button.classList.add(\"ionx--interactive\");\n        button.setAttribute(\"color\", \"primary\");\n        this.deleteUnlisten = eventManager.addEventListener(button, \"click\", () => this.deleteNode());\n\n        const icon = document.createElement(\"ion-icon\");\n        icon.setAttribute(\"name\", \"trash\");\n        icon.slot = \"icon-only\";\n        button.appendChild(icon);\n    }\n\n    private deleteUnlisten: Function;\n\n    dom: HTMLElement;\n\n    private deleteNode() {\n        this.view.dispatch(removeSelectedNode(this.view.state.tr));\n    }\n\n    selectNode() {\n        this.dom.classList.add(\"ionx--selected\");\n    }\n\n    deselectNode() {\n        this.dom.classList.remove(\"ionx--selected\");\n    }\n\n    update(node: Node) {\n        return false;\n    }\n\n    destroy() {\n\n        if (this.deleteUnlisten) {\n            this.deleteUnlisten();\n        }\n    }\n\n    stopEvent(event: Event) {\n        return false;\n    }\n\n    ignoreMutation() {\n        return true;\n    }\n}\n","export function findScrollParent(element: HTMLElement): HTMLElement {\n\n    if (!element) {\n        return;\n    }\n\n    if (element.scrollHeight >= element.clientHeight) {\n        const overflowY = window.getComputedStyle(element).overflowY;\n        if (overflowY !== \"visible\" && overflowY !== \"hidden\") {\n            return element;\n        }\n    }\n\n    if (element.assignedSlot) {\n        const p = findScrollParent(element.assignedSlot.parentElement);\n        if (p) {\n            return p;\n        }\n    }\n\n    return findScrollParent(element.parentElement);\n}\n\nexport function scrollIntoView(element: HTMLElement, parent: HTMLElement) {\n\n    if (parent) {\n\n        const parentRect = parent.getBoundingClientRect();\n        const rect = element.getBoundingClientRect();\n\n        if (!(rect.top > parentRect.top && rect.top <= parentRect.bottom && rect.bottom < parentRect.height)) {\n\n            let top = element.offsetTop - 100;\n\n            if (element.offsetParent) {\n                let offsetParent = element.offsetParent as HTMLElement;\n                while (offsetParent !== parent && !!offsetParent) {\n                    top += offsetParent.offsetTop;\n                    offsetParent = offsetParent.offsetParent as HTMLElement;\n                }\n            }\n\n            parent.scrollTo({top: top});\n        }\n\n        return;\n    }\n\n    element.scrollIntoView();\n}\n\nexport function scrollToCaret(parent: HTMLElement) {\n\n    if (parent) {\n\n        const parentRect = parent.getBoundingClientRect();\n        const rect = caretTopPoint();\n        rect.top -= 100;\n\n        if (!(rect.top > parentRect.top && rect.top <= parentRect.bottom)) {\n\n            let top = rect.top - parentRect.top;\n            parent.scrollTo({top: top, behavior: \"auto\"});\n        }\n\n        return;\n    }\n\n}\n\nexport function caretTopPoint(): {left: number, top: number} {\n\n    const selection = document.getSelection();\n    const range0 = selection.getRangeAt(0);\n\n    let rect: {left: number, top: number};\n    let range: Range;\n\n    // supposed to be textNode in most cases\n    // but div[contenteditable] when empty\n    const node = range0.startContainer as Element;\n\n    const offset = range0.startOffset;\n    if (offset > 0) {\n\n        // new range, don't influence DOM state\n        range = document.createRange();\n        range.setStart(node, (offset - 1));\n        range.setEnd(node, offset);\n\n        // https://developer.mozilla.org/en-US/docs/Web/API/range.getBoundingClientRect\n        // IE9, Safari?(but look good in Safari 8)\n        rect = range.getBoundingClientRect();\n\n        return {left: rect[\"right\"], top: rect.top};\n\n    } else if (offset < node[\"length\"]) {\n\n        range = document.createRange();\n        // similar but select next on letter\n        range.setStart(node, offset);\n        range.setEnd(node, (offset + 1));\n        rect = range.getBoundingClientRect();\n\n        return {left: rect.left, top: rect.top};\n\n    } else {\n        // textNode has length\n\n        // https://developer.mozilla.org/en-US/docs/Web/API/Element.getBoundingClientRect\n        rect = node.getBoundingClientRect();\n        const styles = getComputedStyle(node);\n        const lineHeight = parseInt(styles.lineHeight);\n        const fontSize = parseInt(styles.fontSize);\n\n        // roughly half the whitespace... but not exactly\n        const delta = (lineHeight - fontSize) / 2;\n\n        return {left: rect.left, top: (rect.top + delta)};\n    }\n\n}\n","import {AfterContentChecked, AfterViewInit, Component, ElementRef, EventEmitter, HostBinding, Input, OnChanges, OnDestroy, OnInit, Optional, Output, SimpleChanges} from \"@angular/core\";\nimport {ControlValueAccessor, NgControl} from \"@angular/forms\";\nimport {EventManager} from \"@angular/platform-browser\";\nimport {waitTill} from \"@co.mmons/js-utils/core\";\nimport {IonItem} from \"@ionic/angular\";\nimport {baseKeymap} from \"prosemirror-commands\";\nimport {gapCursor} from \"prosemirror-gapcursor\";\nimport {history} from \"prosemirror-history\";\nimport {keymap} from \"prosemirror-keymap\";\nimport {DOMParser, DOMSerializer, Schema} from \"prosemirror-model\";\nimport {EditorState, Plugin, Transaction} from \"prosemirror-state\";\nimport {EditorView} from \"prosemirror-view\";\nimport {HtmlEditorFeatures} from \"./editor-features\";\nimport {buildKeymap} from \"./prosemirror/keymap\";\nimport {schema} from \"./prosemirror/schema\";\nimport {createYoutubeIframe, YoutubeNodeView} from \"./prosemirror/views/youtube\";\nimport {findScrollParent, scrollIntoView, scrollToCaret} from \"./scroll\";\n\n@Component({\n    selector: \"ionx-html-editor\",\n    template: `\n        <ionx-html-editor-toolbar [style.display]=\"readonly ? 'none' : ''\"></ionx-html-editor-toolbar>\n    `,\n    styleUrls: [\"editor.scss\"]\n})\nexport class HtmlEditor implements OnInit, AfterViewInit, ControlValueAccessor, AfterContentChecked, OnDestroy, OnChanges {\n\n    private static idGenerator: number = 0;\n\n    constructor(\n        private element: ElementRef<HTMLElement>,\n        public eventManager: EventManager,\n        @Optional() private formControl: NgControl,\n        @Optional() private item: IonItem\n    ) {\n\n        if (formControl) {\n            this.formControl.valueAccessor = this;\n        }\n\n        this.id = \"ionx-trix-editor\" + (HtmlEditor.idGenerator++);\n        this.itemInputWrapper = !!this.item;\n\n        this.element.nativeElement.setAttribute(\"no-blur\", \"\");\n    }\n\n    private eventUnlisteners: Function[] = [];\n\n    readonly id: string;\n\n    @HostBinding(\"class.ionx-item-input-wrapper\")\n    /*private*/ itemInputWrapper: boolean;\n\n    @Input()\n    features: HtmlEditorFeatures;\n\n    @Input()\n    disabled: boolean;\n\n    @Input()\n    readonly: boolean;\n\n    /**\n     * Value, that should be set when editor is fully initialized.\n     */\n    private uninitializedValue: any;\n\n    private controlOnChange: Function;\n\n    private controlOnTouched: Function;\n\n    private focused: boolean;\n\n    private silentChanges: boolean;\n\n    view: EditorView;\n\n    get state() {\n        return this.view.state;\n    }\n\n    private schema: Schema;\n\n    private plugins: Plugin[];\n\n    private scrollParent: HTMLElement;\n\n    @Output()\n    readonly change: EventEmitter<any> = new EventEmitter();\n\n    @Output()\n    readonly selectionChange: EventEmitter<any> = new EventEmitter();\n\n    @Input()\n    public set value(html: string) {\n\n        if (this.view) {\n\n            const state = EditorState.create({\n                schema: this.view.state.schema,\n                plugins: this.view.state.plugins,\n                doc: this.editorDoc(html || \"<div></div>\")\n            });\n\n            this.view.updateState(state);\n\n        } else {\n            this.uninitializedValue = html;\n        }\n\n        this.silentChanges = false;\n    }\n\n    public get value(): string {\n        if (this.view) {\n            const value = DOMSerializer.fromSchema(this.schema).serializeFragment(this.state.doc.content);\n            const tmp = document.createElement(\"div\");\n            tmp.appendChild(value);\n\n            if (!tmp.innerText) {\n                return null;\n            } else {\n                return this.prepareOutputValue(tmp);\n            }\n\n        } else {\n            return this.uninitializedValue;\n        }\n    }\n\n    get nativeElement(): HTMLElement {\n        return this.element.nativeElement;\n    }\n\n    private prepareOutputValue(value: HTMLElement) {\n\n        value.querySelectorAll(\"div[data-youtube]\").forEach((node: HTMLElement) => {\n            const params = node.getAttribute(\"data-youtube\").split(\",\");\n            node.appendChild(createYoutubeIframe(params[0], params.length > 1 ? params[1] : undefined));\n        });\n\n        return value.innerHTML;\n    }\n\n    private prepareInputValue(value: HTMLElement) {\n\n    }\n\n    setDisabledState(isDisabled: boolean): void {\n        this.disabled = !!isDisabled;\n    }\n\n    writeValue(value: any) {\n        this.silentChanges = true;\n        this.value = value;\n    }\n\n    registerOnChange(fn: Function): void {\n        this.controlOnChange = fn;\n    }\n\n    registerOnTouched(fn: Function): void {\n        this.controlOnTouched = fn;\n    }\n\n    focus() {\n\n        if (!this.scrollParent) {\n            this.scrollParent = findScrollParent(this.element.nativeElement);\n        }\n\n        (this.view.dom as HTMLElement).focus({preventScroll: true});\n\n        const pos = this.view.domAtPos(this.view.state.selection.to);\n        if (pos.node) {\n            if (pos.node.nodeType === Node.TEXT_NODE) {\n                scrollToCaret(this.scrollParent);\n            } else {\n                scrollIntoView(this.view.dom.querySelector(\".ionx--selected\") || pos.node as HTMLElement, this.scrollParent);\n            }\n        }\n    }\n\n    // @ts-ignore\n    private async editorInitialized(event: Event) {\n\n        if (this.uninitializedValue) {\n            // this.trixEditor.loadHTML(this.uninitializedValue);\n        }\n\n        // this.trixEditorController.toolbarController.applyKeyboardCommand = this.applyKeyboardCommand.bind(this);\n    }\n\n    // @ts-ignore\n    private editorFocused(event: Event) {\n\n        if (this.controlOnTouched) {\n            this.controlOnTouched(true);\n        }\n\n        this.focused = true;\n        this.updateItemClasses();\n    }\n\n    // @ts-ignore\n    private editorBlured(event: Event) {\n        this.focused = false;\n        this.updateItemClasses();\n    }\n\n    private handleScroll(view: EditorView) {\n\n        if (!this.scrollParent) {\n            this.scrollParent = findScrollParent(this.element.nativeElement);\n        }\n\n        const pos = view.domAtPos(view.state.selection.to);\n        if (pos.node) {\n            if (pos.node.nodeType === Node.TEXT_NODE) {\n                scrollToCaret(this.scrollParent);\n            } else {\n                scrollIntoView(view.dom.querySelector(\".ionx--selected\") || pos.node as HTMLElement, this.scrollParent);\n            }\n        }\n\n        return false;\n    }\n\n    private editorDoc(html: string) {\n\n        const node = document.createElement(\"div\");\n        node.innerHTML = html;\n        this.prepareInputValue(node);\n\n        return DOMParser.fromSchema(this.schema).parse(node);\n    }\n\n    private resetControlCss() {\n\n        const classes = {\n            \"ion-untouched\": this.formControl.untouched,\n            \"ion-touched\": this.formControl.touched,\n            \"ion-pristine\": this.formControl.pristine,\n            \"ion-dirty\": this.formControl.dirty,\n            \"ion-valid\": this.formControl.valid,\n            \"ion-invalid\": !this.formControl.valid\n        };\n\n        const elements: HTMLElement[] = [];\n        elements.push(this.element.nativeElement);\n\n        if (this.item) {\n            elements.push(this.item[\"el\"]);\n        }\n\n        for (const e of elements) {\n            for (const c in classes) {\n                if (classes[c]) {\n                    e.classList.add(c);\n                } else {\n                    e.classList.remove(c);\n                }\n            }\n        }\n    }\n\n    private updateItemClasses() {\n\n        if (!this.item) {\n            return;\n        }\n\n        const item: HTMLElement = this.item[\"el\"];\n\n        if (this.disabled) {\n            item.classList.remove(\"item-interactive\");\n        } else {\n            item.classList.add(\"item-interactive\");\n        }\n\n        if (this.focused) {\n            item.classList.add(\"item-has-focus\");\n        } else {\n            item.classList.remove(\"item-has-focus\");\n        }\n    }\n\n    private async fixItemOverflow() {\n\n        if (this.item) {\n            const item: HTMLElement = this.item[\"el\"];\n            await waitTill(() => !!item.shadowRoot && !!item.shadowRoot.querySelector(\".item-inner\"));\n\n            item.style.overflow = \"initial\";\n\n            const style = document.createElement(\"style\");\n            style.innerHTML = `.item-native, .item-inner, .input-wrapper { overflow: initial !important; }`;\n            item.shadowRoot.appendChild(style);\n        }\n\n    }\n\n    private editorTransaction(transaction: Transaction) {\n\n        (this.view.dom as HTMLElement).focus({preventScroll: true});\n\n        this.view.updateState(this.view.state.apply(transaction));\n\n        this.focus();\n\n        this.selectionChange.next();\n\n        if (transaction.docChanged) {\n            this.change.next();\n\n            if (this.controlOnChange && !this.silentChanges) {\n                this.controlOnChange(this.value);\n            }\n        }\n\n        this.silentChanges = false;\n    }\n\n    private readonlyChanged() {\n\n        if (this.view) {\n            this.view.dom[\"contentEditable\"] = !this.readonly && !this.disabled ? \"true\" : \"false\";\n        }\n\n    }\n\n    ngAfterViewInit(): void {\n        this.fixItemOverflow();\n        this.updateItemClasses();\n    }\n\n    ngAfterContentChecked() {\n        this.resetControlCss();\n    }\n\n    ngOnDestroy() {\n\n        for (const unlisten of this.eventUnlisteners) {\n            unlisten();\n        }\n\n        this.view.destroy();\n        this.view = undefined;\n    }\n\n    ngOnInit() {\n\n        this.schema = schema;\n\n        this.plugins = [\n            keymap(buildKeymap(schema)),\n            keymap(baseKeymap),\n            gapCursor(),\n            history()\n        ];\n\n        const state = EditorState.create({\n            schema: this.schema,\n            plugins: this.plugins,\n            doc: this.editorDoc(this.uninitializedValue ? this.uninitializedValue : \"<div></div>\")\n        });\n\n        this.view = new EditorView(this.element.nativeElement, {\n            state: state,\n            dispatchTransaction: (transaction) => this.editorTransaction(transaction),\n            handleScrollToSelection: (view) => this.handleScroll(view),\n\n            nodeViews: {\n                youtube: (node, view) => new YoutubeNodeView(node, view, this.eventManager)\n            }\n        });\n\n        this.silentChanges = false;\n\n        if (this.readonly || this.disabled) {\n            this.readonlyChanged();\n        }\n    }\n\n    ngOnChanges(changes: SimpleChanges): void {\n\n        if (changes[\"readonly\"] || changes[\"disabled\"]) {\n            this.readonlyChanged();\n        }\n\n    }\n}\n","import {Component, Input, OnInit} from \"@angular/core\";\nimport {PopoverController} from \"@ionic/angular\";\nimport {HtmlEditor} from \"./editor\";\nimport {schema} from \"./prosemirror/schema\";\nimport {setBlockType} from \"prosemirror-commands\";\nimport {findParentNodeOfType} from \"prosemirror-utils\";\n\n@Component({\n    styles: [\n        `:host ion-list { margin: 0px; padding: 0px }`,\n        `:host ion-item:last-child { --border-width: 0px; }`,\n    ],\n    template: `\n        <ion-list lines=\"full\">\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(0)\" *ngIf=\"activeHeading > 0\">\n                <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#Plain text\" | intlMessage}}</ion-label>\n            </ion-item>\n            \n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(1)\">\n                <ion-label style=\"font-size: 130%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 1</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 1\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(2)\">\n                <ion-label style=\"font-size: 125%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 2</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 2\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(3)\">\n                <ion-label style=\"font-size: 120%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 3</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 3\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(4)\">\n                <ion-label style=\"font-size: 115%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 4</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 4\"></ion-icon>\n            </ion-item>\n            \n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(5)\">\n                <ion-label style=\"font-size: 110%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 5</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 5\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(6)\">\n                <ion-label style=\"font-size: 105%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 6</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 6\"></ion-icon>\n            </ion-item>\n            \n        </ion-list>\n    `\n})\nexport class HeadingMenu implements OnInit {\n\n    constructor(private popoverController: PopoverController) {\n    }\n\n    activeHeading: number;\n\n    @Input()\n    editor: HtmlEditor;\n\n\n    toggleHeading(heading: number) {\n\n        if (heading > 0 && this.activeHeading !== heading) {\n\n            const command = setBlockType(schema.nodes.heading, {level: heading});\n            if (command(this.editor.state)) {\n                command(this.editor.state, (tr) => {\n                    this.editor.view.dispatch(tr);\n                });\n            }\n\n        } else {\n            setBlockType(schema.nodes.paragraph)(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        }\n\n        this.popoverController.dismiss();\n    }\n\n    ngOnInit() {\n\n        const active = findParentNodeOfType(schema.nodes.heading)(this.editor.state.selection);\n        if (active) {\n            this.activeHeading = active.node.attrs.level;\n        }\n    }\n\n    ionViewWillLeave() {\n        this.editor.focus();\n    }\n}\n","import {AbstractControl, ValidationErrors, ValidatorFn, Validators} from \"@angular/forms\";\nimport {MessageRef} from \"@co.mmons/js-intl\";\n\nexport abstract class LinkType {\n\n    protected constructor(public readonly type: string) {\n    }\n\n    abstract get label(): MessageRef;\n\n    abstract get inputType(): string;\n\n    abstract get inputComponent(): any;\n\n    abstract get inputValidators(): ValidatorFn[];\n\n    abstract get inputHint(): MessageRef;\n\n    abstract get inputLabel(): MessageRef;\n\n    abstract uri(fromLink: string): string;\n\n    toString() {\n        return this.type;\n    }\n}\n\nexport class DefaultLinkType extends LinkType {\n\n    static readonly www = new DefaultLinkType(\"www\");\n    static readonly email = new DefaultLinkType(\"email\");\n    static readonly tel = new DefaultLinkType(\"tel\");\n    static readonly sms = new DefaultLinkType(\"sms\");\n    static readonly other = new DefaultLinkType(\"other\");\n\n    constructor(type: string) {\n        super(type);\n\n        this.label = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/type/\" + type);\n\n        if (type === \"www\") {\n            this.inputType = \"url\";\n        } else if (type === \"other\") {\n            this.inputType = \"text\";\n        } else if (type === \"sms\") {\n            this.inputType = \"sms\";\n        } else {\n            this.inputType = type;\n        }\n\n        if (type === \"www\") {\n            this.inputValidators = [urlValidator];\n            this.inputLabel = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/Web page url\");\n        }\n\n        if (type === \"email\") {\n            this.inputValidators = [Validators.email];\n            this.inputLabel = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/E-mail address\");\n        }\n\n        if (type === \"tel\" || type === \"sms\") {\n            this.inputLabel = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/Phone number\");\n            this.inputHint = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/phoneNumberHint\");\n        }\n    }\n\n\n    readonly label: MessageRef;\n\n    readonly inputType: string;\n\n    readonly inputValidators: ValidatorFn[];\n\n    readonly inputComponent = undefined;\n\n    readonly inputLabel: MessageRef;\n\n    readonly inputHint: MessageRef;\n\n    uri(fromLink: string) {\n\n        if (this.type === \"www\" || this.type === \"other\") {\n            return fromLink;\n        } else if (this.type === \"tel\") {\n            return `tel:${fromLink}`;\n        } else if (this.type === \"sms\") {\n            return `sms:${fromLink}`;\n        } else if (this.type === \"email\") {\n            return `mailto:${fromLink}`;\n        }\n\n        return fromLink;\n    }\n\n}\n\nconst urlValidatorRegex = /^(?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:[a-z\\u00a1-\\uffff]{2,}\\.?))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i;\n\nfunction urlValidator(control: AbstractControl): ValidationErrors {\n\n    const value = control.value;\n\n    if (urlValidatorRegex.test(value)) {\n        return undefined;\n    }\n\n    return {\n        invalidUrl: new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/invalidUrlError\")\n    };\n}\n","import {deepEqual} from \"fast-equals\";\nimport {Mark, MarkType, Node} from \"prosemirror-model\";\n\nexport function findMarks(doc: Node, from: number, to: number, markType: MarkType, attrs?: {[key: string]: any}) {\n\n    const marks: Mark[] = [];\n\n    doc.nodesBetween(from, to, node => {\n\n        for (let i = 0; i < node.marks.length; i++) {\n            if (node.marks[i].type === markType && (!attrs || deepEqual(node.marks[i].attrs, attrs))) {\n                marks.push(node.marks[i]);\n            }\n        }\n\n    });\n\n    return marks;\n}\n","import {findMarks} from \"./find-marks\";\nimport {MarkType} from \"prosemirror-model\";\nimport {EditorState} from \"prosemirror-state\";\n\nexport function findMarksInSelection(state: EditorState, markType: MarkType, attrs?: {[key: string]: any}) {\n    const doc = state.doc;\n    const {from, to} = state.selection;\n    return findMarks(doc, from, to, markType, attrs);\n}\n","import {Node} from \"prosemirror-model\";\n\nexport function findNodeStartEnd(doc: Node, pos: number) {\n\n    const $pos = doc.resolve(pos);\n    const start = pos - $pos.textOffset;\n    const end = start + $pos.parent.child($pos.index()).nodeSize;\n\n    return {start, end};\n}\n","import {Component, Input, OnDestroy, OnInit, ViewChild} from \"@angular/core\";\nimport {AbstractControl, FormControl, FormGroup, ValidationErrors, Validators} from \"@angular/forms\";\nimport {FormHelper} from \"@co.mmons/ionic-extensions/form-helper\";\nimport {sleep, waitTill} from \"@co.mmons/js-utils/core\";\nimport {unsubscribe} from \"@co.mmons/rxjs-utils\";\nimport {ModalController} from \"@ionic/angular\";\nimport {toggleMark} from \"prosemirror-commands\";\nimport {Subscription} from \"rxjs\";\nimport {HtmlEditor} from \"./editor\";\nimport {DefaultLinkType, LinkType} from \"./link-type\";\nimport {schema} from \"./prosemirror/schema\";\nimport {findMarksInSelection} from \"./prosemirror/utils/find-marks-in-selection\";\nimport {findNodeStartEnd} from \"./prosemirror/utils/find-node-start-end\";\n\n@Component({\n    templateUrl: \"link-modal.html\",\n    styles: [\n        `:host ion-item:not(.ion-dirty) { --highlight-height: 0px; }`\n    ]\n})\nexport class LinkModal implements OnDestroy, OnInit {\n\n    static async present(modalController: ModalController, editor: HtmlEditor) {\n\n        const modal = await modalController.create({component: LinkModal, componentProps: {editor: editor}});\n        modal.present();\n    }\n\n    constructor(private modalController: ModalController) {\n    }\n\n    @Input()\n    private editor: HtmlEditor;\n\n    existing: boolean;\n\n    private existingType: LinkType;\n\n    private existingLink: string;\n\n    types: LinkType[];\n\n    form: FormGroup;\n\n    @ViewChild(FormHelper, {static: false})\n    formHelper: FormHelper;\n\n    async close() {\n        await this.modalController.dismiss();\n        this.editor.focus();\n    }\n\n    async unlink() {\n\n        await this.modalController.dismiss();\n\n        const selection = this.editor.state.selection;\n\n        if (selection.empty) {\n\n            const tr = this.editor.state.tr;\n\n            tr.doc.nodesBetween(selection.from, selection.to, (node, pos) => {\n\n                if (node.isText) {\n                    const $pos = tr.doc.resolve(pos);\n                    const start = pos - $pos.textOffset;\n                    const end = start + $pos.parent.child($pos.index()).nodeSize;\n\n                    tr.removeMark(start, end, schema.marks.link);\n                }\n            });\n\n            this.editor.view.dispatch(tr);\n\n        } else {\n            toggleMark(schema.marks.link)(this.editor.state, tr => this.editor.view.dispatch(tr));\n        }\n    }\n\n    async ok() {\n        this.formHelper.validateAll(\"dirty\");\n\n        if (this.form.valid) {\n            await this.modalController.dismiss();\n\n            const linkType = this.form.controls.type.value as LinkType;\n            const selection = this.editor.state.selection;\n\n            const tr = this.editor.state.tr;\n\n            if (selection.empty) {\n\n                tr.doc.nodesBetween(selection.from, selection.to, (node, pos) => {\n\n                    if (node.isText) {\n                        const {start, end} = findNodeStartEnd(tr.doc, pos);\n                        tr.addMark(start, end, schema.mark(schema.marks.link, {href: linkType.uri(this.form.controls.link.value)}));\n                    }\n                });\n\n            } else {\n\n                // usuwamy poprzedni link\n                tr.doc.nodesBetween(selection.from, selection.to, (node, pos) => {\n\n                    if (node.isText) {\n                        const {start, end} = findNodeStartEnd(tr.doc, pos);\n                        tr.removeMark(start, end, schema.marks.link);\n                    }\n                });\n\n                tr.addMark(selection.from, selection.to, schema.mark(schema.marks.link, {href: linkType.uri(this.form.controls.link.value)}));\n            }\n\n            this.editor.view.dispatch(tr);\n        }\n    }\n\n    private async typeChanged() {\n\n        if (this.form.controls.link.value) {\n            this.form.controls.link.markAsDirty();\n            this.form.controls.link.updateValueAndValidity();\n        }\n\n        await sleep(50); // we must wait for closing type selector\n\n        if (this.formHelper) {\n            this.formHelper.focus(\"link\", false);\n        }\n    }\n\n    private parseLink(uri: string): {type: LinkType, link: string} {\n\n        const prefixes = {\n            \"http:\": DefaultLinkType.www,\n            \"https:\": DefaultLinkType.www,\n            \"tel:\": DefaultLinkType.tel,\n            \"sms:\": DefaultLinkType.sms,\n            \"mailto:\": DefaultLinkType.email\n        };\n\n        const lowerCasedUri = uri.trim().toLowerCase();\n\n        for (const prefix of Object.keys(prefixes)) {\n            if (lowerCasedUri.startsWith(prefix)) {\n\n                const link = {type: prefixes[prefix], link: uri.trim()};\n\n                if (prefixes[prefix] !== DefaultLinkType.www) {\n                    link.link = uri.substring(prefix.length).trim();\n                }\n\n                return link;\n            }\n        }\n\n        return {type: DefaultLinkType.other, link: uri};\n    }\n\n    private linkValidator(control: AbstractControl): ValidationErrors {\n\n        const required = Validators.required(control);\n        if (required) {\n            return required;\n        }\n\n        const type = this.form.controls.type.value as LinkType;\n        const validators = type.inputValidators;\n\n        if (validators) {\n            for (const validator of validators) {\n                const r = validator(control);\n                if (r) {\n                    return r;\n                }\n            }\n        }\n    }\n\n    async ionViewDidEnter() {\n\n        this.types = [DefaultLinkType.www, DefaultLinkType.email, DefaultLinkType.tel, DefaultLinkType.sms, DefaultLinkType.other];\n\n        this.form = new FormGroup({\n            type: new FormControl(this.existingType || DefaultLinkType.www),\n            link: new FormControl(this.existingLink)\n        });\n\n        this.form.controls.link.setValidators(control => this.linkValidator(control));\n\n        this.typeChangesSubscription = this.form.controls[\"type\"].valueChanges.subscribe(() => this.typeChanged());\n        this.typeChanged();\n\n        await waitTill(() => !!this.formHelper);\n\n        this.formHelper.focus(\"link\", false);\n    }\n\n    async ionViewWillLeave() {\n        this.editor.focus();\n    }\n\n    ngOnInit() {\n\n        MARKS: for (const mark of findMarksInSelection(this.editor.state, schema.marks.link)) {\n            const parsed = this.parseLink(mark.attrs.href);\n            if (parsed) {\n                this.existingType = parsed.type;\n                this.existingLink = parsed.link;\n                this.existing = true;\n                break MARKS;\n            }\n        }\n    }\n\n    private typeChangesSubscription: Subscription;\n\n    ngOnDestroy() {\n        unsubscribe(this.typeChangesSubscription);\n    }\n\n}\n","import {Component, Input, OnInit, ViewChild} from \"@angular/core\";\nimport {sleep, waitTill} from \"@co.mmons/js-utils/core\";\nimport {IonInput, ModalController, PopoverController} from \"@ionic/angular\";\nimport {OverlayEventDetail} from \"@ionic/core\";\nimport {HtmlEditor} from \"./editor\";\nimport {LinkModal} from \"./link-modal\";\n\n@Component({\n    styles: [\n        `:host ion-list { margin: 0px; padding: 0px }`,\n        `:host ion-item:last-child { --border-width: 0px; }`,\n        `:host ion-item { --highlight-height: 0px; }`\n    ],\n    template: `\n        <ion-list lines=\"full\">\n            \n            <ng-template [ngIf]=\"!inputView\">\n                \n                <ion-item button=\"true\" detail=\"false\" (click)=\"insertLink()\">\n                    <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#link/Link\" | intlMessage}}</ion-label>\n                    <ion-icon name=\"link\" slot=\"start\"></ion-icon>\n                </ion-item>\n    \n                <ion-item button=\"true\" detail=\"false\" (click)=\"insertYoutube()\">\n                    <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#youtube/YouTube video\" | intlMessage}}</ion-label>\n                    <ion-icon name=\"logo-youtube\" slot=\"start\"></ion-icon>\n                </ion-item>\n                \n            </ng-template>\n            \n            <ng-template [ngIf]=\"inputView == 'youtube'\">\n\n                <ion-item>\n                    <ion-icon name=\"logo-youtube\" slot=\"start\"></ion-icon>\n                    <ion-input #youtubeInput [placeholder]=\"'@co.mmons/ionic-extensions/html-editor#youtube/Paste YouTube video url' | intlMessage\" (keydown.enter)=\"applyYoutube()\"></ion-input>\n                </ion-item>\n                \n                <ion-item>\n                    <ionx-buttons slot=\"end\">\n                        <ion-button fill=\"clear\" color=\"dark\" (click)=\"cancel()\">\n                            <ion-label>{{\"@co.mmons/js-intl#Cancel\" | intlMessage}}</ion-label>\n                        </ion-button>\n                        \n                        <ion-button fill=\"clear\" color=\"primary\" (click)=\"applyYoutube()\">\n                            <ion-label>{{\"@co.mmons/js-intl#Ok\" | intlMessage}}</ion-label>\n                        </ion-button>\n                    </ionx-buttons>\n                </ion-item>\n    \n            </ng-template>\n            \n        </ion-list>\n    `\n})\nexport class InsertMenu implements OnInit {\n\n    // @ts-ignore\n    constructor(private popoverController: PopoverController, private modalController: ModalController) {\n    }\n\n    @Input()\n    private editor: HtmlEditor;\n\n    inputView: \"youtube\";\n\n    // @ts-ignore\n    private editorLastSelection: [number, number];\n\n\n    async insertLink() {\n\n        this.popoverController.dismiss(undefined, \"link\");\n\n        LinkModal.present(this.modalController, this.editor);\n    }\n\n    @ViewChild(\"youtubeInput\", {static: false})\n    private youtubeInput: IonInput;\n\n    async insertYoutube() {\n\n        this.inputView = \"youtube\";\n\n        await waitTill(() => !!this.youtubeInput, undefined, 2000);\n        this.youtubeInput.setFocus();\n    }\n\n    // @ts-ignore\n    private parseYoutube(value: string): {id: string, start?: string} {\n        // https://www.youtube.com/watch?v=NqMgaHUNSQc\n        // https://youtu.be/NqMgaHUNSQc\n        // https://www.youtube.com/embed/NqMgaHUNSQc\n        // https://www.youtube-nocookie.com/embed/NqMgaHUNSQc\n        // https://youtu.be/NqMgaHUNSQc?t=17\n\n        value = value.replace(\"-nocookie.com/\", \".com/\");\n        value = value.replace(\"/embed/\", \"/\");\n        value = value.replace(\"youtu.be/\", \"youtube.com/\");\n        value = value.replace(\"watch?v=\", \"\");\n        value = value.replace(\"?\", \"&\");\n\n        const info = {id: undefined, start: undefined};\n\n        if (value.indexOf(\"youtube.com/\") > -1) {\n            value = value.split(\"youtube.com/\").splice(1, 1)[0];\n\n            for (const param of value.split(\"&\")) {\n                if (param.indexOf(\"=\") < 0) {\n                    info.id = param;\n                } else if (param.startsWith(\"t=\")) {\n                    info.start = param.substring(2);\n                } else if (param.startsWith(\"start=\")) {\n                    info.start = param.substring(6);\n                }\n            }\n\n        } else  {\n        }\n\n        if (info.id) {\n            return info;\n        }\n    }\n\n\n    applyYoutube() {\n\n\n        const info = this.parseYoutube(this.youtubeInput.value as string);\n        if (info) {\n            const tr = this.editor.state.tr.replaceSelectionWith(this.editor.state.schema.nodes.youtube.create({id: info.id, start: info.start || 0}));\n            this.editor.view.dispatch(tr);\n        }\n\n        this.popoverController.dismiss(undefined, \"youtube\");\n    }\n\n    cancel() {\n        this.popoverController.dismiss();\n    }\n\n    ngOnInit() {\n    }\n\n    async ionViewWillLeave(event: OverlayEventDetail<any>) {\n\n        if (!this.inputView && !event.role) {\n            this.editor.focus();\n        }\n    }\n\n    async ionViewDidLeave(event: OverlayEventDetail<any>) {\n\n        if (this.inputView) {\n            await sleep(50);\n            this.editor.focus();\n\n        } else if (!event.role) {\n            this.editor.focus();\n        }\n    }\n}\n","import {Command} from \"../command\";\nimport {Predicate} from \"../predicate\";\n\nexport const filter = (predicates: Predicate[] | Predicate, cmd: Command): Command => {\n\n    return function(state, dispatch, view): boolean {\n        if (!Array.isArray(predicates)) {\n            predicates = [predicates];\n        }\n\n        if (predicates.some(pred => !pred(state, view))) {\n            return false;\n        }\n\n        return cmd(state, dispatch, view) || false;\n    };\n};\n","import {GapCursor} from \"prosemirror-gapcursor\";\nimport {EditorState} from \"prosemirror-state\";\n\nexport const isEmptySelectionAtStart = (state: EditorState): boolean => {\n    const {empty, $from} = state.selection;\n    return (\n        empty &&\n        ($from.parentOffset === 0 || state.selection instanceof GapCursor)\n    );\n};\n\n","import {GapCursor} from \"prosemirror-gapcursor\";\nimport {EditorState} from \"prosemirror-state\";\n\nexport const isFirstChildOfParent = (state: EditorState): boolean => {\n    const {$from} = state.selection;\n    return $from.depth > 1\n        ? (state.selection instanceof GapCursor &&\n        $from.parentOffset === 0) ||\n        $from.index($from.depth - 1) === 0\n        : true;\n};\n","import {Node} from \"prosemirror-model\";\nimport {EditorState, Selection, Transaction} from \"prosemirror-state\";\nimport {ContentNodeWithPos} from \"prosemirror-utils\";\n\n/**\n * Checks if node is an empty paragraph.\n */\nexport function isEmptyParagraph(node?: Node | null): boolean {\n    return (\n        !node ||\n        (node.type.name === \"paragraph\" && !node.textContent && !node.childCount)\n    );\n}\n\n/**\n * Returns false if node contains only empty inline nodes and hardBreaks.\n */\nexport function hasVisibleContent(node: Node): boolean {\n    const isInlineNodeHasVisibleContent = (inlineNode: Node) => {\n        return inlineNode.isText\n            ? !!inlineNode.textContent.trim()\n            : inlineNode.type.name !== \"hardBreak\";\n    };\n\n    if (node.isInline) {\n        return isInlineNodeHasVisibleContent(node);\n    } else if (node.isBlock && (node.isLeaf || node.isAtom)) {\n        return true;\n    } else if (!node.childCount) {\n        return false;\n    }\n\n    for (let index = 0; index < node.childCount; index++) {\n        const child = node.child(index);\n\n        if (hasVisibleContent(child)) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\n/**\n * Checks if a node has any content. Ignores node that only contain empty block nodes.\n */\nexport function isNodeEmpty(node?: Node): boolean {\n    if (node && node.textContent) {\n        return false;\n    }\n\n    if (\n        !node ||\n        !node.childCount ||\n        (node.childCount === 1 && isEmptyParagraph(node.firstChild))\n    ) {\n        return true;\n    }\n\n    const block: Node[] = [];\n    const nonBlock: Node[] = [];\n\n    node.forEach(child => {\n        child.isInline ? nonBlock.push(child) : block.push(child);\n    });\n\n    return (\n        !nonBlock.length &&\n        !block.filter(\n            childNode =>\n                (!!childNode.childCount &&\n                    !(\n                        childNode.childCount === 1 && isEmptyParagraph(childNode.firstChild)\n                    )) ||\n                childNode.isAtom,\n        ).length\n    );\n}\n\n/**\n * Checks if a node looks like an empty document\n */\nexport function isEmptyDocument(node: Node): boolean {\n    const nodeChild = node.content.firstChild;\n\n    if (node.childCount !== 1 || !nodeChild) {\n        return false;\n    }\n    return (\n        nodeChild.type.name === \"paragraph\" &&\n        !nodeChild.childCount &&\n        nodeChild.nodeSize === 2 &&\n        (!nodeChild.marks || nodeChild.marks.length === 0)\n    );\n}\n\nexport const getStepRange = (\n    transaction: Transaction,\n): { from: number; to: number } | null => {\n    let from = -1;\n    let to = -1;\n\n    transaction.steps.forEach(step => {\n        step.getMap().forEach((_oldStart, _oldEnd, newStart, newEnd) => {\n            from = newStart < from || from === -1 ? newStart : from;\n            to = newEnd < to || to === -1 ? newEnd : to;\n        });\n    });\n\n    if (from !== -1) {\n        return { from, to };\n    }\n\n    return null;\n};\n\n/**\n * Find the farthest node given a condition\n * @param predicate Function to check the node\n */\nexport const findFarthestParentNode = (predicate: (node: Node) => boolean) => (\n    selection: Selection,\n): ContentNodeWithPos | null => {\n    const { $from } = selection;\n\n    let candidate: ContentNodeWithPos | null = null;\n\n    for (let i = $from.depth; i > 0; i--) {\n        const node = $from.node(i);\n        if (predicate(node)) {\n            candidate = {\n                pos: i > 0 ? $from.before(i) : 0,\n                start: $from.start(i),\n                depth: i,\n                node,\n            };\n        }\n    }\n    return candidate;\n};\n\nexport const isSelectionEndOfParagraph = (state: EditorState): boolean =>\n    state.selection.$to.parent.type === state.schema.nodes.paragraph &&\n    state.selection.$to.pos === state.doc.resolve(state.selection.$to.pos).end();\n\nexport function nodesBetweenChanged(\n    tr: Transaction,\n    f: (\n        node: Node<any>,\n        pos: number,\n        parent: Node<any>,\n        index: number,\n    ) => boolean | null | undefined | void,\n    startPos?: number,\n) {\n    const stepRange = getStepRange(tr);\n    if (!stepRange) {\n        return;\n    }\n\n    tr.doc.nodesBetween(stepRange.from, stepRange.to, f, startPos);\n}\n\nexport function getNodesCount(node: Node): Record<string, number> {\n    const count: Record<string, number> = {};\n\n    node.nodesBetween(0, node.nodeSize - 2, node => {\n        count[node.type.name] = (count[node.type.name] || 0) + 1;\n    });\n\n    return count;\n}\n","import {Fragment, NodeRange, Slice} from \"prosemirror-model\";\nimport {EditorState, Selection, TextSelection, Transaction,} from \"prosemirror-state\";\nimport {liftTarget, ReplaceAroundStep} from \"prosemirror-transform\";\n\nfunction liftListItem(\n    state: EditorState,\n    selection: Selection,\n    tr: Transaction,\n): Transaction {\n    const { $from, $to } = selection;\n    const nodeType = state.schema.nodes.listItem;\n    let range = $from.blockRange(\n        $to,\n        node =>\n            !!node.childCount &&\n            !!node.firstChild &&\n            node.firstChild.type === nodeType,\n    );\n    if (\n        !range ||\n        range.depth < 2 ||\n        $from.node(range.depth - 1).type !== nodeType\n    ) {\n        return tr;\n    }\n    const end = range.end;\n    const endOfList = $to.end(range.depth);\n    if (end < endOfList) {\n        tr.step(\n            new ReplaceAroundStep(\n                end - 1,\n                endOfList,\n                end,\n                endOfList,\n                new Slice(\n                    Fragment.from(nodeType.create(undefined, range.parent.copy())),\n                    1,\n                    0,\n                ),\n                1,\n                true,\n            ),\n        );\n\n        range = new NodeRange(\n            tr.doc.resolve($from.pos),\n            tr.doc.resolve(endOfList),\n            range.depth,\n        );\n    }\n    return tr.lift(range, liftTarget(range) as number).scrollIntoView();\n}\n\nexport function liftFollowingList(\n    state: EditorState,\n    from: number,\n    to: number,\n    rootListDepth: number,\n    tr: Transaction,\n): Transaction {\n    const { listItem } = state.schema.nodes;\n    let lifted = false;\n    tr.doc.nodesBetween(from, to, (node, pos) => {\n        if (!lifted && node.type === listItem && pos > from) {\n            lifted = true;\n            let listDepth = rootListDepth + 3;\n            while (listDepth > rootListDepth + 2) {\n                const start = tr.doc.resolve(tr.mapping.map(pos));\n                listDepth = start.depth;\n                const end = tr.doc.resolve(\n                    tr.mapping.map(pos + node.textContent.length),\n                );\n                const sel = new TextSelection(start, end);\n                tr = liftListItem(state, sel, tr);\n            }\n        }\n    });\n    return tr;\n}\n","import {ResolvedPos, Schema} from \"prosemirror-model\";\n\n// This will return (depth - 1) for root list parent of a list.\nexport const getListLiftTarget = (\n    schema: Schema,\n    resPos: ResolvedPos,\n): number => {\n    let target = resPos.depth;\n    const { bulletList, orderedList, listItem } = schema.nodes;\n    for (let i = resPos.depth; i > 0; i--) {\n        const node = resPos.node(i);\n        if (node.type === bulletList || node.type === orderedList) {\n            target = i;\n        }\n        if (\n            node.type !== bulletList &&\n            node.type !== orderedList &&\n            node.type !== listItem\n        ) {\n            break;\n        }\n    }\n    return target - 1;\n};\n","import {EditorState, Transaction} from \"prosemirror-state\";\nimport {getListLiftTarget} from \"../utils/get-list-lift-target\";\n\n// The function will list paragraphs in selection out to level 1 below root list.\nexport function liftSelectionList(\n    state: EditorState,\n    tr: Transaction,\n): Transaction {\n    const {from, to} = state.selection;\n    const {paragraph} = state.schema.nodes;\n    const listCol: any[] = [];\n    tr.doc.nodesBetween(from, to, (node, pos) => {\n        if (node.type === paragraph) {\n            listCol.push({node, pos});\n        }\n    });\n    for (let i = listCol.length - 1; i >= 0; i--) {\n        const paragraph = listCol[i];\n        const start = tr.doc.resolve(tr.mapping.map(paragraph.pos));\n        if (start.depth > 0) {\n            let end;\n            if (paragraph.node.textContent && paragraph.node.textContent.length > 0) {\n                end = tr.doc.resolve(\n                    tr.mapping.map(paragraph.pos + paragraph.node.textContent.length),\n                );\n            } else {\n                end = tr.doc.resolve(tr.mapping.map(paragraph.pos + 1));\n            }\n            const range = start.blockRange(end);\n            if (range) {\n                tr.lift(range, getListLiftTarget(state.schema, start));\n            }\n        }\n    }\n    return tr;\n}\n","import { Node, Mark, MarkType } from \"prosemirror-model\";\nimport { SelectionRange, EditorState, Transaction } from \"prosemirror-state\";\n\nexport const isMarkAllowedInRange = (\n    doc: Node,\n    ranges: Array<SelectionRange>,\n    type: MarkType,\n): boolean => {\n    for (let i = 0; i < ranges.length; i++) {\n        const { $from, $to } = ranges[i];\n        let can = $from.depth === 0 ? doc.type.allowsMarkType(type) : false;\n        doc.nodesBetween($from.pos, $to.pos, node => {\n            if (can) {\n                return false;\n            }\n            can = node.inlineContent && node.type.allowsMarkType(type);\n            return;\n        });\n        if (can) {\n            return can;\n        }\n    }\n    return false;\n};\n\nexport const isMarkExcluded = (\n    type: MarkType,\n    marks?: Array<Mark> | null,\n): boolean => {\n    if (marks) {\n        return marks.some(mark => mark.type !== type && mark.type.excludes(type));\n    }\n    return false;\n};\n\nconst not = <T>(fn: ((args: T) => boolean)) => (arg: T) => !fn(arg);\n\nexport const removeBlockMarks = (\n    state: EditorState,\n    marks: Array<MarkType | undefined>,\n): Transaction | undefined => {\n    const { selection, schema } = state;\n    let { tr } = state;\n\n    // Marks might not exist in Schema\n    const marksToRemove = marks.filter(Boolean);\n    if (marksToRemove.length === 0) {\n        return undefined;\n    }\n\n    /** Saves an extra dispatch */\n    let blockMarksExists = false;\n\n    const hasMark = (mark: Mark) => marksToRemove.indexOf(mark.type) > -1;\n    /**\n     * When you need to toggle the selection\n     * when another type which does not allow alignment is applied\n     */\n    state.doc.nodesBetween(selection.from, selection.to, (node, pos) => {\n        if (node.type === schema.nodes.paragraph && node.marks.some(hasMark)) {\n            blockMarksExists = true;\n            const resolvedPos = state.doc.resolve(pos);\n            const withoutBlockMarks = node.marks.filter(not(hasMark));\n            tr = tr.setNodeMarkup(\n                resolvedPos.pos,\n                undefined,\n                node.attrs,\n                withoutBlockMarks,\n            );\n        }\n    });\n    return blockMarksExists ? tr : undefined;\n};\n\n/**\n * Removes marks from nodes in the current selection that are not supported\n */\nexport const sanitizeSelectionMarks = (\n    state: EditorState,\n): Transaction | undefined => {\n    let tr: Transaction | undefined;\n    const { $from, $to } = state.tr.selection;\n    state.doc.nodesBetween($from.pos, $to.pos, (node, pos) => {\n        node.marks.forEach(mark => {\n            if (!node.type.allowsMarkType(mark.type)) {\n                const filteredMarks = node.marks.filter(m => m.type !== mark.type);\n                const position = pos > 0 ? pos - 1 : 0;\n                tr = (tr || state.tr).setNodeMarkup(\n                    position,\n                    undefined,\n                    node.attrs,\n                    filteredMarks,\n                );\n            }\n        });\n    });\n    return tr;\n};\n","import { toggleMark } from \"prosemirror-commands\";\nimport {GapCursor} from \"prosemirror-gapcursor\";\nimport {\n    Fragment,\n    Mark as PMMark,\n    MarkType,\n    Node,\n    NodeType,\n    ResolvedPos,\n    Slice,\n    Schema,\n    NodeRange,\n    Mark,\n} from \"prosemirror-model\";\nimport { EditorView } from \"prosemirror-view\";\nimport {\n    EditorState,\n    NodeSelection,\n    Selection,\n    TextSelection,\n    Transaction,\n} from \"prosemirror-state\";\nimport { liftTarget, findWrapping } from \"prosemirror-transform\";\nimport { hasParentNodeOfType } from \"prosemirror-utils\";\nimport { isNodeEmpty } from \"./document-utils\";\n\nexport {\n    isEmptyParagraph,\n    hasVisibleContent,\n    isNodeEmpty,\n    isEmptyDocument,\n    getStepRange,\n    findFarthestParentNode,\n    isSelectionEndOfParagraph,\n    nodesBetweenChanged,\n} from \"./document-utils\";\n\n\nexport const ZeroWidthSpace = \"\\u200b\";\n\nfunction validateNode(_node: Node): boolean {\n    return false;\n}\n\nfunction isMarkTypeCompatibleWithMark(\n    markType: MarkType,\n    mark: PMMark,\n): boolean {\n    return !mark.type.excludes(markType) && !markType.excludes(mark.type);\n}\n\nfunction isMarkTypeAllowedInNode(\n    markType: MarkType,\n    state: EditorState,\n): boolean {\n    return toggleMark(markType)(state);\n}\n\nfunction closest(\n    node: HTMLElement | null | undefined,\n    s: string,\n): HTMLElement | null {\n    let el = node as HTMLElement;\n    if (!el) {\n        return null;\n    }\n    if (!document.documentElement || !document.documentElement.contains(el)) {\n        return null;\n    }\n    const matches = el.matches ? \"matches\" : \"msMatchesSelector\";\n\n    do {\n        // @ts-ignore\n        if (el[matches] && el[matches](s)) {\n            return el;\n        }\n        el = (el.parentElement || el.parentNode) as HTMLElement;\n    } while (el !== null && el.nodeType === 1);\n    return null;\n}\n\nexport const isImage = (fileType?: string): boolean => {\n    return (\n        !!fileType &&\n        (fileType.indexOf(\"image/\") > -1 || fileType.indexOf(\"video/\") > -1)\n    );\n};\n\nexport function canMoveUp(state: EditorState): boolean {\n    const { selection, doc } = state;\n\n    /**\n     * If there\"s a media element on the selection,\n     * add text blocks with arrow navigation.\n     * Also, the selection could be media | mediaGroup.\n     */\n    if (selection instanceof NodeSelection) {\n        if (selection.node.type.name === \"media\") {\n            /** Weird way of checking if the previous element is a paragraph */\n            const mediaAncestorNode = doc.nodeAt(selection.anchor - 3);\n            return !!(\n                mediaAncestorNode && mediaAncestorNode.type.name === \"paragraph\"\n            );\n        } else if (selection.node.type.name === \"mediaGroup\") {\n            const mediaGroupAncestorNode = selection.$anchor.nodeBefore;\n            return !!(\n                mediaGroupAncestorNode &&\n                mediaGroupAncestorNode.type.name === \"paragraph\"\n            );\n        }\n    }\n\n    if (selection instanceof TextSelection) {\n        if (!selection.empty) {\n            return true;\n        }\n    }\n\n    return !atTheBeginningOfDoc(state);\n}\n\nexport function canMoveDown(state: EditorState): boolean {\n    const { selection, doc } = state;\n\n    /**\n     * If there\"s a media element on the selection,\n     * add text blocks with arrow navigation.\n     * Also, the selection could be media | mediaGroup.\n     */\n    if (selection instanceof NodeSelection) {\n        if (selection.node.type.name === \"media\") {\n            const nodeAfter = doc.nodeAt(selection.$head.after());\n            return !!(nodeAfter && nodeAfter.type.name === \"paragraph\");\n        } else if (selection.node.type.name === \"mediaGroup\") {\n            return !(\n                selection.$head.parentOffset === selection.$anchor.parent.content.size\n            );\n        }\n    }\n    if (selection instanceof TextSelection) {\n        if (!selection.empty) {\n            return true;\n        }\n    }\n\n    return !atTheEndOfDoc(state);\n}\n\nexport function isSelectionInsideLastNodeInDocument(\n    selection: Selection,\n): boolean {\n    const docNode = selection.$anchor.node(0);\n    const rootNode = selection.$anchor.node(1);\n\n    return docNode.lastChild === rootNode;\n}\n\nexport function atTheEndOfDoc(state: EditorState): boolean {\n    const { selection, doc } = state;\n    return doc.nodeSize - selection.$to.pos - 2 === selection.$to.depth;\n}\n\nexport function atTheBeginningOfDoc(state: EditorState): boolean {\n    const { selection } = state;\n    return selection.$from.pos === selection.$from.depth;\n}\n\nexport function atTheEndOfBlock(state: EditorState): boolean {\n    const { selection } = state;\n    const { $to } = selection;\n    if (selection instanceof GapCursor) {\n        return false;\n    }\n    if (selection instanceof NodeSelection && selection.node.isBlock) {\n        return true;\n    }\n    return endPositionOfParent($to) === $to.pos + 1;\n}\n\nexport function atTheBeginningOfBlock(state: EditorState): boolean {\n    const { selection } = state;\n    const { $from } = selection;\n    if (selection instanceof GapCursor) {\n        return false;\n    }\n    if (selection instanceof NodeSelection && selection.node.isBlock) {\n        return true;\n    }\n    return startPositionOfParent($from) === $from.pos;\n}\n\nexport function startPositionOfParent(resolvedPos: ResolvedPos): number {\n    return resolvedPos.start(resolvedPos.depth);\n}\n\nexport function endPositionOfParent(resolvedPos: ResolvedPos): number {\n    return resolvedPos.end(resolvedPos.depth) + 1;\n}\n\nexport function getCursor(selection: Selection): ResolvedPos | undefined {\n    return (selection as TextSelection).$cursor || undefined;\n}\n\n/**\n * Check if a mark is allowed at the current selection / cursor based on a given state.\n * This method looks at both the currently active marks on the transaction, as well as\n * the node and marks at the current selection to determine if the given mark type is\n * allowed.\n */\nexport function isMarkTypeAllowedInCurrentSelection(\n    markType: MarkType,\n    state: EditorState,\n) {\n\n    if (!isMarkTypeAllowedInNode(markType, state)) {\n        return false;\n    }\n\n    const { empty, $cursor, ranges } = state.selection as TextSelection;\n    if (empty && !$cursor) {\n        return false;\n    }\n\n    const isCompatibleMarkType = (mark: PMMark) =>\n        isMarkTypeCompatibleWithMark(markType, mark);\n\n    // Handle any new marks in the current transaction\n    if (\n        state.tr.storedMarks &&\n        !state.tr.storedMarks.every(isCompatibleMarkType)\n    ) {\n        return false;\n    }\n\n    if ($cursor) {\n        return $cursor.marks().every(isCompatibleMarkType);\n    }\n\n    // Check every node in a selection - ensuring that it is compatible with the current mark type\n    return ranges.every(({ $from, $to }) => {\n        let allowedInActiveMarks =\n            $from.depth === 0 ? state.doc.marks.every(isCompatibleMarkType) : true;\n\n        state.doc.nodesBetween($from.pos, $to.pos, node => {\n            allowedInActiveMarks =\n                allowedInActiveMarks && node.marks.every(isCompatibleMarkType);\n        });\n\n        return allowedInActiveMarks;\n    });\n}\n\n/**\n * Step through block-nodes between $from and $to and returns false if a node is\n * found that isn\"t of the specified type\n */\nexport function isRangeOfType(\n    doc: Node,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n    nodeType: NodeType,\n): boolean {\n    return (\n        getAncestorNodesBetween(doc, $from, $to).filter(\n            node => node.type !== nodeType,\n        ).length === 0\n    );\n}\n\nexport function createSliceWithContent(content: string, state: EditorState) {\n    return new Slice(Fragment.from(state.schema.text(content)), 0, 0);\n}\n\n/**\n * Determines if content inside a selection can be joined with the next block.\n * We need this check since the built-in method for \"joinDown\" will join a orderedList with bulletList.\n */\nexport function canJoinDown(\n    selection: Selection,\n    doc: any,\n    nodeType: NodeType,\n): boolean {\n    return checkNodeDown(selection, doc, node => node.type === nodeType);\n}\n\nexport function checkNodeDown(\n    selection: Selection,\n    doc: Node,\n    filter: (node: Node) => boolean,\n): boolean {\n    const res = doc.resolve(\n        selection.$to.after(findAncestorPosition(doc, selection.$to).depth),\n    );\n    return res.nodeAfter ? filter(res.nodeAfter) : false;\n}\n\nexport const setNodeSelection = (view: EditorView, pos: number) => {\n    const { state, dispatch } = view;\n\n    if (!isFinite(pos)) {\n        return;\n    }\n\n    const tr = state.tr.setSelection(NodeSelection.create(state.doc, pos));\n    dispatch(tr);\n};\n\nexport function setTextSelection(\n    view: EditorView,\n    anchor: number,\n    head?: number,\n) {\n    const { state } = view;\n    const tr = state.tr.setSelection(\n        TextSelection.create(state.doc, anchor, head),\n    );\n    view.dispatch(tr);\n}\n\n/**\n * Determines if content inside a selection can be joined with the previous block.\n * We need this check since the built-in method for \"joinUp\" will join a orderedList with bulletList.\n */\nexport function canJoinUp(\n    selection: Selection,\n    doc: any,\n    nodeType: NodeType,\n): boolean {\n    const res = doc.resolve(\n        selection.$from.before(findAncestorPosition(doc, selection.$from).depth),\n    );\n    return res.nodeBefore && res.nodeBefore.type === nodeType;\n}\n\n/**\n * Returns all top-level ancestor-nodes between $from and $to\n */\nexport function getAncestorNodesBetween(\n    doc: Node,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n): Node[] {\n    const nodes = Array<Node>();\n    const maxDepth = findAncestorPosition(doc, $from).depth;\n    let current = doc.resolve($from.start(maxDepth));\n\n    while (current.pos <= $to.start($to.depth)) {\n        const depth = Math.min(current.depth, maxDepth);\n        const node = current.node(depth);\n\n        if (node) {\n            nodes.push(node);\n        }\n\n        if (depth === 0) {\n            break;\n        }\n\n        let next: ResolvedPos = doc.resolve(current.after(depth));\n        if (next.start(depth) >= doc.nodeSize - 2) {\n            break;\n        }\n\n        if (next.depth !== current.depth) {\n            next = doc.resolve(next.pos + 2);\n        }\n\n        if (next.depth) {\n            current = doc.resolve(next.start(next.depth));\n        } else {\n            current = doc.resolve(next.end(next.depth));\n        }\n    }\n\n    return nodes;\n}\n\n/**\n * Finds all \"selection-groups\" within a range. A selection group is based on ancestors.\n *\n * Example:\n * Given the following document and selection ({<} = start of selection and {>} = end)\n *  doc\n *    blockquote\n *      ul\n *        li\n *        li{<}\n *        li\n *     p\n *     p{>}\n *\n * The output will be two selection-groups. One within the ul and one with the two paragraphs.\n */\nexport function getGroupsInRange(\n    doc: Node,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n    isNodeValid: (node: Node) => boolean = validateNode,\n): Array<{ $from: ResolvedPos; $to: ResolvedPos }> {\n    const groups = Array<{ $from: ResolvedPos; $to: ResolvedPos }>();\n    const commonAncestor = hasCommonAncestor(doc, $from, $to);\n    const fromAncestor = findAncestorPosition(doc, $from);\n\n    if (\n        commonAncestor ||\n        (fromAncestor.depth === 1 && isNodeValid($from.node(1)))\n    ) {\n        groups.push({ $from, $to });\n    } else {\n        let current = $from;\n\n        while (current.pos < $to.pos) {\n            let ancestorPos = findAncestorPosition(doc, current);\n            while (ancestorPos.depth > 1) {\n                ancestorPos = findAncestorPosition(doc, ancestorPos);\n            }\n\n            const endPos = doc.resolve(\n                Math.min(\n                    // should not be smaller then start position in case of an empty paragraph for example.\n                    Math.max(\n                        ancestorPos.start(ancestorPos.depth),\n                        ancestorPos.end(ancestorPos.depth) - 3,\n                    ),\n                    $to.pos,\n                ),\n            );\n\n            groups.push({\n                $from: current,\n                $to: endPos,\n            });\n\n            current = doc.resolve(Math.min(endPos.after(1) + 1, doc.nodeSize - 2));\n        }\n    }\n\n    return groups;\n}\n\n/**\n * Traverse the document until an \"ancestor\" is found. Any nestable block can be an ancestor.\n */\nexport function findAncestorPosition(doc: Node, pos: any): any {\n    const nestableBlocks = [\"blockquote\", \"bulletList\", \"orderedList\"];\n\n    if (pos.depth === 1) {\n        return pos;\n    }\n\n    let node: Node | undefined = pos.node(pos.depth);\n    let newPos = pos;\n    while (pos.depth >= 1) {\n        pos = doc.resolve(pos.before(pos.depth));\n        node = pos.node(pos.depth);\n\n        if (node && nestableBlocks.indexOf(node.type.name) !== -1) {\n            newPos = pos;\n        }\n    }\n\n    return newPos;\n}\n\n/**\n * Determine if two positions have a common ancestor.\n */\nexport function hasCommonAncestor(\n    doc: Node,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n): boolean {\n    let current;\n    let target;\n\n    if ($from.depth > $to.depth) {\n        current = findAncestorPosition(doc, $from);\n        target = findAncestorPosition(doc, $to);\n    } else {\n        current = findAncestorPosition(doc, $to);\n        target = findAncestorPosition(doc, $from);\n    }\n\n    while (current.depth > target.depth && current.depth > 1) {\n        current = findAncestorPosition(doc, current);\n    }\n\n    return current.node(current.depth) === target.node(target.depth);\n}\n\n/**\n * Takes a selection $from and $to and lift all text nodes from their parents to document-level\n */\nexport function liftSelection(\n    tr: Transaction,\n    doc: Node,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n) {\n    let startPos = $from.start($from.depth);\n    let endPos = $to.end($to.depth);\n    const target = Math.max(0, findAncestorPosition(doc, $from).depth - 1);\n\n    tr.doc.nodesBetween(startPos, endPos, (node, pos) => {\n        if (\n            node.isText || // Text node\n            (node.isTextblock && !node.textContent) // Empty paragraph\n        ) {\n            const res = tr.doc.resolve(tr.mapping.map(pos));\n            const sel = new NodeSelection(res);\n            const range = sel.$from.blockRange(sel.$to);\n\n            if (liftTarget(range as NodeRange) !== undefined) {\n                tr.lift(range, target);\n            }\n        }\n    });\n\n    startPos = tr.mapping.map(startPos);\n    endPos = tr.mapping.map(endPos);\n    endPos = tr.doc.resolve(endPos).end(tr.doc.resolve(endPos).depth); // We want to select the entire node\n\n    tr.setSelection(\n        new TextSelection(tr.doc.resolve(startPos), tr.doc.resolve(endPos)),\n    );\n\n    return {\n        tr: tr,\n        $from: tr.doc.resolve(startPos),\n        $to: tr.doc.resolve(endPos),\n    };\n}\n\n/**\n * Lift nodes in block to one level above.\n */\nexport function liftSiblingNodes(view: EditorView) {\n    const { tr } = view.state;\n    const { $from, $to } = view.state.selection;\n    const blockStart = tr.doc.resolve($from.start($from.depth - 1));\n    const blockEnd = tr.doc.resolve($to.end($to.depth - 1));\n    const range = blockStart.blockRange(blockEnd);\n    view.dispatch(tr.lift(range as NodeRange, blockStart.depth - 1));\n}\n\n/**\n * Lift sibling nodes to document-level and select them.\n */\nexport function liftAndSelectSiblingNodes(view: EditorView): Transaction {\n    const { tr } = view.state;\n    const { $from, $to } = view.state.selection;\n    const blockStart = tr.doc.resolve($from.start($from.depth - 1));\n    const blockEnd = tr.doc.resolve($to.end($to.depth - 1));\n    // TODO: [ts30] handle void and null properly\n    const range = blockStart.blockRange(blockEnd) as NodeRange;\n    tr.setSelection(new TextSelection(blockStart, blockEnd));\n    tr.lift(range as NodeRange, blockStart.depth - 1);\n    return tr;\n}\n\nexport function wrapIn(\n    nodeType: NodeType,\n    tr: Transaction,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n): Transaction {\n    const range = $from.blockRange($to) as any;\n    const wrapping = range && (findWrapping(range, nodeType) as any);\n    if (wrapping) {\n        tr = tr.wrap(range, wrapping).scrollIntoView();\n    }\n    return tr;\n}\n\n/**\n * Repeating string for multiple times\n */\nexport function stringRepeat(text: string, length: number): string {\n    let result = \"\";\n    for (let x = 0; x < length; x++) {\n        result += text;\n    }\n    return result;\n}\n\n/**\n * A replacement for `Array.from` until it becomes widely implemented.\n */\nexport function arrayFrom(obj: any): any[] {\n    return Array.prototype.slice.call(obj);\n}\n\n/**\n * Replacement for Element.closest, until it becomes widely implemented\n * Returns the ancestor element of a particular type if exists or null\n */\nexport function closestElement(\n    node: HTMLElement | null | undefined,\n    s: string,\n): HTMLElement | null {\n    return closest(node, s);\n}\n\n/*\n * From Modernizr\n * Returns the kind of transitionevent available for the element\n */\nexport function whichTransitionEvent<TransitionEventName extends string>() {\n    const el = document.createElement(\"fakeelement\");\n    const transitions: Record<string, string> = {\n        transition: \"transitionend\",\n        MozTransition: \"transitionend\",\n        OTransition: \"oTransitionEnd\",\n        WebkitTransition: \"webkitTransitionEnd\",\n    };\n\n    for (const t in transitions) {\n        if (el.style[t as keyof CSSStyleDeclaration] !== undefined) {\n            // Use a generic as the return type because TypeScript doesnt know\n            // about cross browser features, so we cast here to align to the\n            // standard Event spec and propagate the type properly to the callbacks\n            // of `addEventListener` and `removeEventListener`.\n            return transitions[t] as TransitionEventName;\n        }\n    }\n\n    return;\n}\n\n/**\n * Function will create a list of wrapper blocks present in a selection.\n */\nfunction getSelectedWrapperNodes(state: EditorState): NodeType[] {\n    const nodes: Array<NodeType> = [];\n    if (state.selection) {\n        const { $from, $to } = state.selection;\n        const {\n            blockquote,\n            panel,\n            orderedList,\n            bulletList,\n            listItem,\n            codeBlock,\n        } = state.schema.nodes;\n        state.doc.nodesBetween($from.pos, $to.pos, node => {\n            if (\n                (node.isBlock &&\n                    [blockquote, panel, orderedList, bulletList, listItem].indexOf(\n                        node.type,\n                    ) >= 0) ||\n                node.type === codeBlock\n            ) {\n                nodes.push(node.type);\n            }\n        });\n    }\n    return nodes;\n}\n\n/**\n * Function will check if changing block types: Paragraph, Heading is enabled.\n */\nexport function areBlockTypesDisabled(state: EditorState): boolean {\n    const nodesTypes: NodeType[] = getSelectedWrapperNodes(state);\n    const { panel } = state.schema.nodes;\n    return nodesTypes.filter(type => type !== panel).length > 0;\n}\n\nexport const isTemporary = (id: string): boolean => {\n    return id.indexOf(\"temporary:\") === 0;\n};\n\n\nexport const isEmptyNode = (schema: Schema) => {\n    const {\n        doc,\n        paragraph,\n        codeBlock,\n        blockquote,\n        panel,\n        heading,\n        listItem,\n        bulletList,\n        orderedList,\n        taskList,\n        taskItem,\n        decisionList,\n        decisionItem,\n        media,\n        mediaGroup,\n        mediaSingle,\n    } = schema.nodes;\n    const innerIsEmptyNode = (node: Node): boolean => {\n        switch (node.type) {\n            case media:\n            case mediaGroup:\n            case mediaSingle:\n                return false;\n            case paragraph:\n            case codeBlock:\n            case heading:\n            case taskItem:\n            case decisionItem:\n                return node.content.size === 0;\n            case blockquote:\n            case panel:\n            case listItem:\n                return (\n                    node.content.size === 2 && innerIsEmptyNode(node.content.firstChild)\n                );\n            case bulletList:\n            case orderedList:\n                return (\n                    node.content.size === 4 && innerIsEmptyNode(node.content.firstChild)\n                );\n            case taskList:\n            case decisionList:\n                return (\n                    node.content.size === 2 && innerIsEmptyNode(node.content.firstChild)\n                );\n            case doc:\n                let isEmpty = true;\n                node.content.forEach(child => {\n                    isEmpty = isEmpty && innerIsEmptyNode(child);\n                });\n                return isEmpty;\n            default:\n                return isNodeEmpty(node);\n        }\n    };\n    return innerIsEmptyNode;\n};\n\nexport const insideTable = (state: EditorState): Boolean => {\n    const { table, tableCell } = state.schema.nodes;\n\n    return hasParentNodeOfType([table, tableCell])(state.selection);\n};\n\nexport const insideTableCell = (state: EditorState) => {\n    const { tableCell, tableHeader } = state.schema.nodes;\n    return hasParentNodeOfType([tableCell, tableHeader])(state.selection);\n};\n\nexport const isElementInTableCell = (\n    element: HTMLElement | null,\n): HTMLElement | null => {\n    return closest(element, \"td\") || closest(element, \"th\");\n};\n\nexport const isLastItemMediaGroup = (node: Node): boolean => {\n    const { content } = node;\n    return !!content.lastChild && content.lastChild.type.name === \"mediaGroup\";\n};\n\nexport const isInListItem = (state: EditorState): boolean => {\n    return hasParentNodeOfType(state.schema.nodes.listItem)(state.selection);\n};\n\nexport const hasOpenEnd = (slice: Slice): boolean => {\n    return slice.openStart > 0 || slice.openEnd > 0;\n};\n\nexport function filterChildrenBetween(\n    doc: Node,\n    from: number,\n    to: number,\n    predicate: (node: Node, pos: number, parent: Node) => boolean | undefined,\n) {\n    const results = [] as { node: Node; pos: number }[];\n    doc.nodesBetween(from, to, (node, pos, parent) => {\n        if (predicate(node, pos, parent)) {\n            results.push({ node, pos });\n        }\n    });\n    return results;\n}\n\nexport function dedupe<T>(\n    list: T[] = [],\n    iteratee?: (p: T) => T[keyof T] | T,\n): T[] {\n    const transformed = iteratee ? list.map(iteratee) : list;\n\n    return transformed\n        .map((item, index, list) => (list.indexOf(item) === index ? item : null))\n        .reduce<T[]>(\n            (acc, item, index) => (!!item ? acc.concat(list[index]) : acc),\n            [],\n        );\n}\n\nexport const isTextSelection = (\n    selection: Selection,\n): selection is TextSelection => selection instanceof TextSelection;\n\n/** Helper type for single arg function */\ntype Func<A, B> = (a: A) => B;\ntype FuncN<A extends any[], B> = (...args: A) => B;\n\n/**\n * Compose 1 to n functions.\n * @param func first function\n * @param funcs additional functions\n */\nexport function compose<\n    F1 extends Func<any, any>,\n    FN extends Array<Func<any, any>>,\n    R extends FN extends []\n        ? F1\n        : FN extends [Func<infer A, any>]\n            ? (a: A) => ReturnType<F1>\n            : FN extends [any, Func<infer A, any>]\n                ? (a: A) => ReturnType<F1>\n                : FN extends [any, any, Func<infer A, any>]\n                    ? (a: A) => ReturnType<F1>\n                    : FN extends [any, any, any, Func<infer A, any>]\n                        ? (a: A) => ReturnType<F1>\n                        : FN extends [any, any, any, any, Func<infer A, any>]\n                            ? (a: A) => ReturnType<F1>\n                            : Func<any, ReturnType<F1>> // Doubtful we\"d ever want to pipe this many functions, but in the off chance someone does, we can still infer the return type\n    >(func: F1, ...funcs: FN): R {\n    const allFuncs = [func, ...funcs];\n    return function composed(raw: any) {\n        return allFuncs.reduceRight((memo, func) => func(memo), raw);\n    } as R;\n}\n\nexport function pipe(): <R>(a: R) => R;\n\nexport function pipe<F extends Function>(f: F): F;\n\n// one function\nexport function pipe<F1 extends FuncN<any, any>>(\n    f1: F1,\n): (...args: Parameters<F1>) => ReturnType<F1>;\n\n// two function\nexport function pipe<\n    F1 extends FuncN<any, any>,\n    F2 extends Func<ReturnType<F1>, any>\n    >(f1: F1, f2: F2): (...args: Parameters<F1>) => ReturnType<F2>;\n\n// three function\nexport function pipe<\n    F1 extends FuncN<any, any>,\n    F2 extends Func<ReturnType<F1>, any>,\n    F3 extends Func<ReturnType<F2>, any>\n    >(f1: F1, f2: F2, f3: F3): (...args: Parameters<F1>) => ReturnType<F3>;\n// If needed add more than 3 function\n// Generic\nexport function pipe<\n    F1 extends FuncN<any, any>,\n    F2 extends Func<ReturnType<F1>, any>,\n    F3 extends Func<ReturnType<F2>, any>,\n    FN extends Array<Func<any, any>>\n    >(f1: F1, f2: F2, f3: F3, ...fn: FN): (...args: Parameters<F1>) => any;\n\n// rest\nexport function pipe(...fns: Function[]) {\n    if (fns.length === 0) {\n        return (a: any) => a;\n    }\n\n    if (fns.length === 1) {\n        return fns[0];\n    }\n\n    return fns.reduce((prevFn, nextFn) => (...args: any[]) =>\n        nextFn(prevFn(...args)),\n    );\n}\n\nexport const normaliseNestedLayout = (state: EditorState, node: Node) => {\n    if (state.selection.$from.depth > 1) {\n        if (node.attrs.layout && node.attrs.layout !== \"default\") {\n            return node.type.createChecked(\n                {\n                    ...node.attrs,\n                    layout: \"default\",\n                },\n                node.content,\n                node.marks,\n            );\n        }\n\n        // If its a breakout layout, we can remove the mark\n        // Since default isn\"t a valid breakout mode.\n        const breakoutMark: Mark = state.schema.marks.breakout;\n        if (breakoutMark && breakoutMark.isInSet(node.marks)) {\n            const newMarks = breakoutMark.removeFromSet(node.marks);\n            return node.type.createChecked(node.attrs, node.content, newMarks);\n        }\n    }\n\n    return node;\n};\n","// https://github.com/ProseMirror/prosemirror-commands/blob/master/src/commands.js#L90\n// Keep going left up the tree, without going across isolating boundaries, until we\n// can go along the tree at that same level\n//\n// You can think of this as, if you could construct each document like we do in the tests,\n// return the position of the first ) backwards from the current selection.\nimport {ResolvedPos} from \"prosemirror-model\";\n\nexport function findCutBefore($pos: ResolvedPos): ResolvedPos | null {\n\n    // parent is non-isolating, so we can look across this boundary\n    if (!$pos.parent.type.spec.isolating) {\n        // search up the tree from the pos\"s *parent*\n        for (let i = $pos.depth - 1; i >= 0; i--) {\n            // starting from the inner most node\"s parent, find out\n            // if we\"re not its first child\n            if ($pos.index(i) > 0) {\n                return $pos.doc.resolve($pos.before(i + 1));\n            }\n\n            if ($pos.node(i).type.spec.isolating) {\n                break;\n            }\n        }\n    }\n\n    return null;\n}\n","import * as baseCommand from \"prosemirror-commands\";\nimport {GapCursor} from \"prosemirror-gapcursor\";\nimport {Fragment, Node, NodeRange, NodeType, ResolvedPos, Slice} from \"prosemirror-model\";\nimport * as baseListCommand from \"prosemirror-schema-list\";\nimport {EditorState, NodeSelection, TextSelection, Transaction} from \"prosemirror-state\";\nimport {liftTarget, ReplaceAroundStep} from \"prosemirror-transform\";\nimport {findPositionOfNodeBefore, hasParentNodeOfType} from \"prosemirror-utils\";\nimport {EditorView} from \"prosemirror-view\";\nimport {Command} from \"./command\";\nimport {filter} from \"./commands/filter\";\nimport {isEmptySelectionAtStart} from \"./commands/is-empty-selection-at-start\";\nimport {isFirstChildOfParent} from \"./commands/is-first-child-of-parent\";\nimport {hasVisibleContent, isNodeEmpty} from \"./document-utils\";\nimport {liftFollowingList} from \"./list/transforms/lift-following-list\";\nimport {liftSelectionList} from \"./list/transforms/lift-selection-list\";\nimport {sanitizeSelectionMarks} from \"./mark-utils\";\nimport {compose, isRangeOfType} from \"./utils\";\nimport {findCutBefore} from \"./utils/find-cut-before\";\n\nconst maxIndentation = 5;\n\nconst deletePreviousEmptyListItem: Command = (state, dispatch) => {\n    const { $from } = state.selection;\n    const { listItem } = state.schema.nodes;\n\n    const $cut = findCutBefore($from);\n    if (!$cut || !$cut.nodeBefore || !($cut.nodeBefore.type === listItem)) {\n        return false;\n    }\n\n    const previousListItemEmpty = $cut.nodeBefore.childCount === 1 && $cut.nodeBefore.firstChild && $cut.nodeBefore.firstChild.nodeSize <= 2;\n\n    if (previousListItemEmpty) {\n        const { tr } = state;\n\n        if (dispatch) {\n            dispatch(\n                tr\n                    .delete($cut.pos - $cut.nodeBefore.nodeSize, $from.pos)\n                    .scrollIntoView(),\n            );\n        }\n        return true;\n    }\n\n    return false;\n};\n\nconst joinToPreviousListItem: Command = (state, dispatch) => {\n    const { $from } = state.selection;\n    const {\n        paragraph,\n        listItem,\n        codeBlock,\n        bulletList,\n        orderedList,\n    } = state.schema.nodes;\n    const isGapCursorShown = state.selection instanceof GapCursor;\n    const $cutPos = isGapCursorShown ? state.doc.resolve($from.pos + 1) : $from;\n    const $cut = findCutBefore($cutPos);\n    if (!$cut) {\n        return false;\n    }\n\n    // see if the containing node is a list\n    if (\n        $cut.nodeBefore &&\n        [bulletList, orderedList].indexOf($cut.nodeBefore.type) > -1\n    ) {\n        // and the node after this is a paragraph or a codeBlock\n        if (\n            $cut.nodeAfter &&\n            ($cut.nodeAfter.type === paragraph || $cut.nodeAfter.type === codeBlock)\n        ) {\n            // find the nearest paragraph that precedes this node\n            let $lastNode = $cut.doc.resolve($cut.pos - 1);\n\n            while ($lastNode.parent.type !== paragraph) {\n                $lastNode = state.doc.resolve($lastNode.pos - 1);\n            }\n\n            let { tr } = state;\n            if (isGapCursorShown) {\n                const nodeBeforePos = findPositionOfNodeBefore(tr.selection);\n                if (typeof nodeBeforePos !== \"number\") {\n                    return false;\n                }\n                // append the codeblock to the list node\n                const list = $cut.nodeBefore.copy(\n                    $cut.nodeBefore.content.append(\n                        Fragment.from(listItem.createChecked({}, $cut.nodeAfter)),\n                    ),\n                );\n                tr.replaceWith(\n                    nodeBeforePos,\n                    $from.pos + $cut.nodeAfter.nodeSize,\n                    list,\n                );\n            } else {\n                // take the text content of the paragraph and insert after the paragraph up until before the the cut\n                tr = state.tr.step(\n                    new ReplaceAroundStep(\n                        $lastNode.pos,\n                        $cut.pos + $cut.nodeAfter.nodeSize,\n                        $cut.pos + 1,\n                        $cut.pos + $cut.nodeAfter.nodeSize - 1,\n                        state.tr.doc.slice($lastNode.pos, $cut.pos),\n                        0,\n                        true,\n                    ),\n                );\n            }\n\n            // find out if there\"s now another list following and join them\n            // as in, [list, p, list] => [list with p, list], and we want [joined list]\n            const $postCut = tr.doc.resolve(\n                tr.mapping.map($cut.pos + $cut.nodeAfter.nodeSize),\n            );\n            if (\n                $postCut.nodeBefore &&\n                $postCut.nodeAfter &&\n                $postCut.nodeBefore.type === $postCut.nodeAfter.type &&\n                [bulletList, orderedList].indexOf($postCut.nodeBefore.type) > -1\n            ) {\n                tr = tr.join($postCut.pos);\n            }\n\n            if (dispatch) {\n                dispatch(tr.scrollIntoView());\n            }\n            return true;\n        }\n    }\n\n    return false;\n};\n\nconst isInsideListItem = (state: EditorState): boolean => {\n    const { $from } = state.selection;\n    const { listItem, paragraph } = state.schema.nodes;\n\n    if (state.selection instanceof GapCursor) {\n        return $from.parent.type === listItem;\n    }\n\n    return (\n        hasParentNodeOfType(listItem)(state.selection) &&\n        $from.parent.type === paragraph\n    );\n};\n\nconst canToJoinToPreviousListItem = (state: EditorState): boolean => {\n    const { $from } = state.selection;\n    const { bulletList, orderedList } = state.schema.nodes;\n\n    const $before = state.doc.resolve($from.pos - 1);\n    let nodeBefore = $before ? $before.nodeBefore : null;\n\n    if (state.selection instanceof GapCursor) {\n        nodeBefore = $from.nodeBefore;\n    }\n\n    return (\n        !!nodeBefore && [bulletList, orderedList].indexOf(nodeBefore.type) > -1\n    );\n};\n\nconst canOutdent = (state: EditorState): boolean => {\n    const { parent } = state.selection.$from;\n    const { listItem, paragraph } = state.schema.nodes;\n\n    if (state.selection instanceof GapCursor) {\n        return parent.type === listItem;\n    }\n\n    return (\n        parent.type === paragraph && hasParentNodeOfType(listItem)(state.selection)\n    );\n};\n\nexport const enterKeyCommand: Command = (state, dispatch): boolean => {\n    const { selection } = state;\n    if (selection.empty) {\n        const { $from } = selection;\n        const { listItem, codeBlock } = state.schema.nodes;\n        const node = $from.node($from.depth);\n        const wrapper = $from.node($from.depth - 1);\n\n        if (wrapper && wrapper.type === listItem) {\n            /** Check if the wrapper has any visible content */\n            const wrapperHasContent = hasVisibleContent(wrapper);\n            if (isNodeEmpty(node) && !wrapperHasContent) {\n                return outdentList()(state, dispatch);\n            } else if (!hasParentNodeOfType(codeBlock)(selection)) {\n                return splitListItem(listItem)(state, dispatch);\n            }\n        }\n    }\n    return false;\n};\n\nexport const backspaceKeyCommand = baseCommand.chainCommands(\n    // if we\"re at the start of a list item, we need to either backspace\n    // directly to an empty list item above, or outdent this node\n    filter(\n        [\n            isEmptySelectionAtStart,\n\n            // list items might have multiple paragraphs; only do this at the first one\n            isFirstChildOfParent,\n            canOutdent,\n        ],\n        baseCommand.chainCommands(deletePreviousEmptyListItem, outdentList()),\n    ),\n\n    // if we\"re just inside a paragraph node (or gapcursor is shown) and backspace, then try to join\n    // the text to the previous list item, if one exists\n    filter(\n        [isEmptySelectionAtStart, canToJoinToPreviousListItem],\n        joinToPreviousListItem,\n    ),\n);\n\n/**\n * Implemetation taken and modified for our needs from PM\n * @param itemType Node\n * Splits the list items, specific implementation take from PM\n */\nfunction splitListItem(itemType: NodeType): Command {\n    return function(state, dispatch) {\n        const ref = state.selection as NodeSelection;\n        const $from = ref.$from;\n        const $to = ref.$to;\n        const node = ref.node;\n        if ((node && node.isBlock) || $from.depth < 2 || !$from.sameParent($to)) {\n            return false;\n        }\n        const grandParent = $from.node(-1);\n        if (grandParent.type !== itemType) {\n            return false;\n        }\n        /** --> The following line changed from the original PM implementation to allow list additions with multiple paragraphs */\n        if (\n            (grandParent.content as any).content.length <= 1 &&\n            $from.parent.content.size === 0 &&\n            !(grandParent.content.size === 0)\n        ) {\n            // In an empty block. If this is a nested list, the wrapping\n            // list item should be split. Otherwise, bail out and let next\n            // command handle lifting.\n            if (\n                $from.depth === 2 ||\n                $from.node(-3).type !== itemType ||\n                $from.index(-2) !== $from.node(-2).childCount - 1\n            ) {\n                return false;\n            }\n            if (dispatch) {\n                let wrap = Fragment.empty;\n                const keepItem = $from.index(-1) > 0;\n                // Build a fragment containing empty versions of the structure\n                // from the outer list item to the parent node of the cursor\n                for (\n                    let d = $from.depth - (keepItem ? 1 : 2);\n                    d >= $from.depth - 3;\n                    d--\n                ) {\n                    wrap = Fragment.from($from.node(d).copy(wrap));\n                }\n                // Add a second list item with an empty default start node\n                wrap = wrap.append(Fragment.from(itemType.createAndFill()));\n                const tr$1 = state.tr.replace(\n                    $from.before(keepItem ? undefined : -1),\n                    $from.after(-3),\n                    new Slice(wrap, keepItem ? 3 : 2, 2),\n                );\n                tr$1.setSelection(\n                    (state.selection.constructor as any).near(\n                        tr$1.doc.resolve($from.pos + (keepItem ? 3 : 2)),\n                    ),\n                );\n                dispatch(tr$1.scrollIntoView());\n            }\n            return true;\n        }\n        const nextType =\n            $to.pos === $from.end()\n                ? grandParent.contentMatchAt(0).defaultType\n                : undefined;\n        const tr = state.tr.delete($from.pos, $to.pos);\n        const types = nextType && [undefined, { type: nextType }];\n\n        if (dispatch) {\n            dispatch(tr.split($from.pos, 2, types as any).scrollIntoView());\n        }\n        return true;\n    };\n}\n\n/**\n * Merge closest bullet list blocks into one\n */\nfunction mergeLists(listItem: NodeType, range: NodeRange) {\n    return (command: Command): Command => {\n        return (state, dispatch) =>\n            command(state, tr => {\n                /* we now need to handle the case that we lifted a sublist out,\n                 * and any listItems at the current level get shifted out to\n                 * their own new list; e.g.:\n                 *\n                 * unorderedList\n                 *  listItem(A)\n                 *  listItem\n                 *    unorderedList\n                 *      listItem(B)\n                 *  listItem(C)\n                 *\n                 * becomes, after unindenting the first, top level listItem, A:\n                 *\n                 * content of A\n                 * unorderedList\n                 *  listItem(B)\n                 * unorderedList\n                 *  listItem(C)\n                 *\n                 * so, we try to merge these two lists if they\"re of the same type, to give:\n                 *\n                 * content of A\n                 * unorderedList\n                 *  listItem(B)\n                 *  listItem(C)\n                 */\n\n                const $start: ResolvedPos = state.doc.resolve(range.start);\n                const $end: ResolvedPos = state.doc.resolve(range.end);\n                const $join = tr.doc.resolve(tr.mapping.map(range.end - 1));\n\n                if (\n                    $join.nodeBefore &&\n                    $join.nodeAfter &&\n                    $join.nodeBefore.type === $join.nodeAfter.type\n                ) {\n                    if (\n                        $end.nodeAfter &&\n                        $end.nodeAfter.type === listItem &&\n                        $end.parent.type === $start.parent.type\n                    ) {\n                        tr.join($join.pos);\n                    }\n                }\n\n                if (dispatch) {\n                    dispatch(tr.scrollIntoView());\n                }\n            });\n    };\n}\n\nexport function outdentList(): Command {\n    return function(state, dispatch) {\n        const { listItem } = state.schema.nodes;\n        const { $from, $to } = state.selection;\n        if (isInsideListItem(state)) {\n            // if we\"re backspacing at the start of a list item, unindent it\n            // take the the range of nodes we might be lifting\n\n            // the predicate is for when you\"re backspacing a top level list item:\n            // we don\"t want to go up past the doc node, otherwise the range\n            // to clear will include everything\n            const range = $from.blockRange(\n                $to,\n                node => node.childCount > 0 && node.firstChild && node.firstChild.type === listItem,\n            );\n\n            if (!range) {\n                return false;\n            }\n            return compose(\n                mergeLists(listItem, range), // 2. Check if I need to merge nearest list\n                baseListCommand.liftListItem, // 1. First lift list item\n            )(listItem)(state, dispatch);\n        }\n\n        return false;\n    };\n}\n\n/**\n * Check if we can sink the list.\n *\n * @returns true if we can sink the list, false if we reach the max indentation level\n */\nfunction canSink(initialIndentationLevel: number, state: EditorState): boolean {\n    /*\n        - Keep going forward in document until indentation of the node is < than the initial\n        - If indentation is EVER > max indentation, return true and don\"t sink the list\n        */\n    let currentIndentationLevel: number;\n    let currentPos = state.tr.selection.$to.pos;\n    do {\n        const resolvedPos = state.doc.resolve(currentPos);\n        currentIndentationLevel = numberNestedLists(\n            resolvedPos,\n            state.schema.nodes,\n        );\n        if (currentIndentationLevel > maxIndentation) {\n            // Cancel sink list.\n            // If current indentation less than the initial, it won\"t be\n            // larger than the max, and the loop will terminate at end of this iteration\n            return false;\n        }\n        currentPos++;\n    } while (currentIndentationLevel >= initialIndentationLevel);\n\n    return true;\n}\n\nexport function indentList(): Command {\n    return function(state, dispatch) {\n        const { listItem } = state.schema.nodes;\n        if (isInsideListItem(state)) {\n            // Record initial list indentation\n            const initialIndentationLevel = numberNestedLists(\n                state.selection.$from,\n                state.schema.nodes,\n            );\n\n            if (canSink(initialIndentationLevel, state)) {\n                compose(\n                    baseListCommand.sinkListItem,\n                )(listItem)(state, dispatch);\n            }\n            return true;\n        }\n        return false;\n    };\n}\n\nexport function liftListItems(): Command {\n    return function(state, dispatch) {\n        const { tr } = state;\n        const { $from, $to } = state.selection;\n\n        tr.doc.nodesBetween($from.pos, $to.pos, (node, pos) => {\n            // Following condition will ensure that block types paragraph, heading, codeBlock, blockquote, panel are lifted.\n            // isTextblock is true for paragraph, heading, codeBlock.\n            if (\n                node.isTextblock ||\n                node.type.name === \"blockquote\" ||\n                node.type.name === \"panel\"\n            ) {\n                const sel = new NodeSelection(tr.doc.resolve(tr.mapping.map(pos)));\n                const range = sel.$from.blockRange(sel.$to);\n\n                if (!range || sel.$from.parent.type !== state.schema.nodes.listItem) {\n                    return false;\n                }\n\n                const target = range && liftTarget(range);\n\n                if (target === undefined || target === null) {\n                    return false;\n                }\n\n                tr.lift(range, target);\n            }\n            return;\n        });\n\n        if (dispatch) {\n            dispatch(tr);\n        }\n\n        return true;\n    };\n}\n\n/**\n * Sometimes a selection in the editor can be slightly offset, for example:\n * it\"s possible for a selection to start or end at an empty node at the very end of\n * a line. This isn\"t obvious by looking at the editor and it\"s likely not what the\n * user intended - so we need to adjust the selection a bit in scenarios like that.\n */\nexport function adjustSelectionInList(\n    doc: Node,\n    selection: TextSelection,\n): TextSelection {\n    const { $from, $to } = selection;\n\n    const isSameLine = $from.pos === $to.pos;\n\n    let startPos = $from.pos;\n    const endPos = $to.pos;\n\n    if (isSameLine && startPos === doc.nodeSize - 3) {\n        // Line is empty, don\"t do anything\n        return selection;\n    }\n\n    // Selection started at the very beginning of a line and therefor points to the previous line.\n    if ($from.nodeBefore && !isSameLine) {\n        startPos++;\n        let node = doc.nodeAt(startPos);\n        while (!node || (node && !node.isText)) {\n            startPos++;\n            node = doc.nodeAt(startPos);\n        }\n    }\n\n    if (endPos === startPos) {\n        return new TextSelection(doc.resolve(startPos));\n    }\n\n    return new TextSelection(doc.resolve(startPos), doc.resolve(endPos));\n}\n\n// Get the depth of the nearest ancestor list\nexport const rootListDepth = (\n    pos: ResolvedPos,\n    nodes: Record<string, NodeType>,\n) => {\n    const { bulletList, orderedList, listItem } = nodes;\n    let depth;\n    for (let i = pos.depth - 1; i > 0; i--) {\n        const node = pos.node(i);\n        if (node.type === bulletList || node.type === orderedList) {\n            depth = i;\n        }\n        if (\n            node.type !== bulletList &&\n            node.type !== orderedList &&\n            node.type !== listItem\n        ) {\n            break;\n        }\n    }\n    return depth;\n};\n\n// Returns the number of nested lists that are ancestors of the given selection\nexport const numberNestedLists = (\n    resolvedPos: ResolvedPos,\n    nodes: Record<string, NodeType>,\n) => {\n    const { bulletList, orderedList } = nodes;\n    let count = 0;\n    for (let i = resolvedPos.depth - 1; i > 0; i--) {\n        const node = resolvedPos.node(i);\n        if (node.type === bulletList || node.type === orderedList) {\n            count += 1;\n        }\n    }\n    return count;\n};\n\nexport const toggleList = (\n    state: EditorState,\n    dispatch: (tr: Transaction) => void,\n    view: EditorView,\n    listType: \"bulletList\" | \"orderedList\",\n): boolean => {\n    const { selection } = state;\n    const fromNode = selection.$from.node(selection.$from.depth - 2);\n    const endNode = selection.$to.node(selection.$to.depth - 2);\n    if (\n        !fromNode ||\n        fromNode.type.name !== listType ||\n        (!endNode || endNode.type.name !== listType)\n    ) {\n        return toggleListCommand(listType)(state, dispatch, view);\n    } else {\n        const depth = rootListDepth(selection.$to, state.schema.nodes);\n        let tr = liftFollowingList(\n            state,\n            selection.$to.pos,\n            selection.$to.end(depth),\n            depth || 0,\n            state.tr,\n        );\n        tr = liftSelectionList(state, tr);\n        dispatch(tr);\n        return true;\n    }\n};\n\n/**\n * Check of is selection is inside a list of the specified type\n */\nexport function isInsideList(\n    state: EditorState,\n    listType: \"bulletList\" | \"orderedList\",\n) {\n    const { $from } = state.selection;\n    const parent = $from.node(-2);\n    const grandgrandParent = $from.node(-3);\n\n    return (\n        (parent && parent.type === state.schema.nodes[listType]) ||\n        (grandgrandParent && grandgrandParent.type === state.schema.nodes[listType])\n    );\n}\n\nexport function toggleListCommand(\n    listType: \"bulletList\" | \"orderedList\",\n): Command {\n    return function(state, dispatch, view) {\n        if (dispatch) {\n            dispatch(\n                state.tr.setSelection(\n                    adjustSelectionInList(state.doc, state.selection as TextSelection),\n                ),\n            );\n        }\n\n        if (!view) {\n            return false;\n        }\n\n        state = view.state;\n\n        const { $from, $to } = state.selection;\n        const isRangeOfSingleType = isRangeOfType(\n            state.doc,\n            $from,\n            $to,\n            state.schema.nodes[listType],\n        );\n\n        if (isInsideList(state, listType) && isRangeOfSingleType) {\n            // Untoggles list\n            return liftListItems()(state, dispatch);\n        } else {\n            // Converts list type e.g. bullet_list -> ordered_list if needed\n            if (!isRangeOfSingleType) {\n                liftListItems()(state, dispatch);\n                state = view.state;\n            }\n\n            // Remove any invalid marks that are not supported\n            const tr = sanitizeSelectionMarks(state);\n            if (tr) {\n                if (dispatch) {\n                    dispatch(tr);\n                }\n                state = view.state;\n            }\n            // Wraps selection in list\n            return wrapInList(state.schema.nodes[listType])(state, dispatch);\n        }\n    };\n}\n\nexport function toggleBulletList(view: EditorView) {\n    return toggleList(view.state, view.dispatch, view, \"bulletList\");\n}\n\nexport function toggleOrderedList(view: EditorView) {\n    return toggleList(view.state, view.dispatch, view, \"orderedList\");\n}\n\nexport function wrapInList(nodeType: NodeType): Command {\n    return baseCommand.autoJoin(\n        baseListCommand.wrapInList(nodeType),\n        (before, after) => before.type === after.type && before.type === nodeType,\n    );\n}\n","import {Component, Input, OnInit} from \"@angular/core\";\nimport {PopoverController} from \"@ionic/angular\";\nimport {HtmlEditor} from \"./editor\";\nimport {Command} from \"./prosemirror/command\";\nimport {indentList, outdentList, toggleList} from \"./prosemirror/list-commands\";\nimport {schema} from \"./prosemirror/schema\";\nimport {findParentNode} from \"prosemirror-utils\";\n\n@Component({\n    styles: [`\n        :host { user-select: none; }\n        :host ion-list { margin: 0px; padding: 0px; }\n        :host ion-item:last-child { --border-width: 0px; }\n        :host ion-item-divider { --background: transparent; font-size: small }\n        :host ion-item-divider ion-label { margin-top: 20px; opacity: 0.8; }\n    `],\n    template: `\n        <ion-list lines=\"full\">\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleList('bulletList')\">\n                <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/Bulleted list\" | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeUnnumberedList\"></ion-icon>\n                <ion-icon src=\"assets/html-editor/list-bulleted.svg\" slot=\"start\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleList('orderedList')\">\n                <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/Numbered list\" | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeNumberedList\"></ion-icon>\n                <ion-icon src=\"assets/html-editor/list-numbered.svg\" slot=\"start\"></ion-icon>\n            </ion-item>\n\n            <ng-template [ngIf]=\"activeUnnumberedList || activeNumberedList\">\n\n                <ion-item-divider>\n                    <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/Indent\" | intlMessage}}</ion-label>\n                </ion-item-divider>\n\n                <ion-item button=\"true\" detail=\"false\" (click)=\"level(-1)\">\n                    <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/Decrease indent\" | intlMessage}}</ion-label>\n                    <ion-icon src=\"assets/html-editor/indent-decrease.svg\" slot=\"start\"></ion-icon>\n                </ion-item>\n\n                <ion-item button=\"true\" detail=\"false\" (click)=\"level(1)\">\n                    <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/Increase indent\" | intlMessage}}</ion-label>\n                    <ion-icon src=\"assets/html-editor/indent-increase.svg\" slot=\"start\"></ion-icon>\n                </ion-item>\n\n            </ng-template>\n\n        </ion-list>\n    `\n})\nexport class ListMenu implements OnInit {\n\n    constructor(private popoverController: PopoverController) {\n    }\n\n    @Input()\n    private editor: HtmlEditor;\n\n    activeUnnumberedList: boolean;\n    activeNumberedList: boolean;\n\n    level(level: number) {\n\n        const command: Command = level < 0 ? outdentList() : indentList();\n        if (command(this.editor.state)) {\n            command(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        }\n\n        this.popoverController.dismiss();\n    }\n\n    toggleList(type: \"bulletList\" | \"orderedList\") {\n        toggleList(this.editor.state, (tr) => this.editor.view.dispatch(tr), this.editor.view, type);\n        this.popoverController.dismiss();\n    }\n\n    ngOnInit() {\n        this.activeUnnumberedList = !!findParentNode(predicate => predicate.hasMarkup(schema.nodes.bulletList))(this.editor.state.selection);\n        this.activeNumberedList = !!findParentNode(predicate => predicate.hasMarkup(schema.nodes.orderedList))(this.editor.state.selection);\n    }\n\n    ionViewWillLeave() {\n        this.editor.focus();\n    }\n}\n","import {MessageRef} from \"@co.mmons/js-intl\";\n\nexport class FontSize {\n\n    private static _sizes: FontSize[] = [];\n\n    static sizes() {\n        return FontSize._sizes.slice();\n    }\n\n    static readonly small = new FontSize(\"small\");\n    static readonly large = new FontSize(\"large\");\n\n    private constructor(public readonly size: string) {\n\n        FontSize._sizes.push(this);\n\n        this.label = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"textMenu/fontSize/\" + size.toUpperCase()[0] + size.substring(1));\n    }\n\n    readonly label: MessageRef;\n}\n","import {shallowEqual} from \"fast-equals\";\nimport {MarkType, Node} from \"prosemirror-model\";\nimport {Command} from \"../command\";\n\nfunction markApplies(doc: Node, from: number, to: number, type: MarkType) {\n\n    let applies = false;\n\n    doc.nodesBetween(from, to, (node, pos, parent) => {\n\n        if (applies) {\n            return false;\n        }\n\n        applies = node.isInline && parent.type.allowsMarkType(type);\n    });\n\n    return applies;\n}\n\n// return true iff all nodes in range have the mark with the same attrs\nfunction rangeHasMark(doc, from, to, type, attrs) {\n\n    let hasMark = null;\n\n    doc.nodesBetween(from, to, node => {\n\n        for (let i = 0; i < node.marks.length; i++) {\n            const markMatch = node.marks[i].type === type && (!attrs || shallowEqual(node.marks[i].attrs, attrs));\n            hasMark = (markMatch && (hasMark === null || hasMark === true));\n        }\n\n        return hasMark;\n    });\n\n    return !!hasMark;\n}\n\nexport function toggleInlineMark(markType: MarkType, attrs?: {[key: string]: any}): Command {\n\n    return function(state, dispatch) {\n\n        const { empty, from, to, $from } = state.selection;\n\n        if (!markApplies(state.doc, from, to, markType)) {\n            console.log(\"not applies\");\n            return false;\n        }\n\n        if (dispatch) {\n\n            if (empty) {\n\n                const markInSet = markType.isInSet(state.storedMarks || $from.marks());\n\n                if (markInSet && (!attrs || shallowEqual(markInSet.attrs, attrs))) {\n                    dispatch(state.tr.removeStoredMark(markType));\n                } else {\n                    dispatch(state.tr.addStoredMark(markType.create(attrs)));\n                }\n\n            } else {\n\n                if (rangeHasMark(state.doc, from, to, markType, attrs)) {\n                    dispatch(state.tr.removeMark(from, to, markType).scrollIntoView());\n                } else {\n                    dispatch(state.tr.addMark(from, to, markType.create(attrs)).scrollIntoView());\n                }\n            }\n        }\n\n        return true;\n    };\n}\n\n","import {Mark, MarkType, NodeType} from \"prosemirror-model\";\nimport {EditorState, NodeSelection} from \"prosemirror-state\";\n\nexport function isActive(state: EditorState, nodeType: NodeType, attrs?: {[key: string]: any}, marks?: Array<Mark<any>>) {\n\n    const selection = state.selection;\n\n    if (selection instanceof NodeSelection && selection.node) {\n        return selection.node.hasMarkup(nodeType, attrs, marks);\n    }\n\n    return selection.to <= selection.$from.end() && selection.$from.parent.hasMarkup(nodeType, attrs, marks);\n}\n\nexport function isMarkActive(state: EditorState, type: MarkType) {\n    const {from, $from, to, empty} = state.selection;\n\n    if (empty) {\n        return !!(type.isInSet(state.storedMarks || $from.marks()));\n    } else {\n        return state.doc.rangeHasMark(from, to, type);\n    }\n}\n\nexport function anyMarkActive(state: EditorState, types: MarkType[]) {\n\n    const {from, $from, to, empty} = state.selection;\n\n    if (empty) {\n\n        for (const type of types) {\n            if (type.isInSet(state.storedMarks || $from.marks())) {\n                return true;\n            }\n        }\n\n    } else {\n\n        for (const type of types) {\n            if (state.doc.rangeHasMark(from, to, type)) {\n                return true;\n            }\n        }\n\n    }\n\n    return false;\n}\n","import {Component, Input, OnInit} from \"@angular/core\";\nimport {PopoverController} from \"@ionic/angular\";\nimport {toggleMark} from \"prosemirror-commands\";\nimport {HtmlEditor} from \"./editor\";\nimport {FontSize} from \"./font-sizes\";\nimport {Command} from \"./prosemirror/command\";\nimport {toggleInlineMark} from \"./prosemirror/commands/toogle-inline-mark\";\nimport {isMarkActive} from \"./prosemirror/is-active\";\nimport {schema} from \"./prosemirror/schema\";\nimport {findMarksInSelection} from \"./prosemirror/utils/find-marks-in-selection\";\n\n@Component({\n    styles: [`\n        :host { user-select: none; }\n        :host ion-list { margin: 0px; padding: 0px; }\n        :host ion-item:last-child { --border-width: 0px; }\n        :host ion-item-divider { --background: transparent; font-size: small }\n        :host ion-item-divider ion-label { margin-top: 20px; opacity: 0.8; }\n    `],\n    template: `\n        <ion-list lines=\"full\">\n            \n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggle('bold')\">\n                <ion-label style=\"font-weight: bold\">{{\"@co.mmons/ionic-extensions/html-editor#textMenu/Bold\" | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"boldActivated\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggle('italic')\">\n                <ion-label style=\"font-style: italic\">{{\"@co.mmons/ionic-extensions/html-editor#textMenu/Italic\" | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"italicActivated\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggle('underline')\">\n                <ion-label style=\"text-decoration: underline\">{{\"@co.mmons/ionic-extensions/html-editor#textMenu/Underline\" | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"underlineActivated\"></ion-icon>\n            </ion-item>\n            \n            <ion-item-divider>\n                <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#textMenu/fontSize/Text size\" | intlMessage}}</ion-label>\n            </ion-item-divider>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"resetFontSize()\" *ngIf=\"activeFontSize\">\n                <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#textMenu/fontSize/Default\" | intlMessage}}</ion-label>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleFontSize(fontSize)\" *ngFor=\"let fontSize of FontSize.sizes()\">\n                <ion-label [style.fontSize]=\"fontSize.size\">{{fontSize.label | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeFontSize === fontSize\"></ion-icon>\n            </ion-item>\n\n        </ion-list>\n    `\n})\nexport class TextFormatMenu implements OnInit {\n\n    readonly FontSize = FontSize;\n\n    constructor(private popoverController: PopoverController) {\n    }\n\n    @Input()\n    editor: HtmlEditor;\n\n    boldActivated: boolean;\n\n    italicActivated: boolean;\n\n    underlineActivated: boolean;\n\n    activeFontSize: FontSize;\n\n\n    toggle(name: string) {\n\n        let command: Command;\n\n        if (name === \"bold\") {\n            command = toggleMark(schema.marks.strong);\n        } else if (name === \"italic\") {\n            command = toggleMark(schema.marks.em);\n        } else if (name === \"underline\") {\n            command = toggleMark(schema.marks.underline);\n        }\n\n        if (command(this.editor.state)) {\n            command(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        }\n\n        this.popoverController.dismiss();\n    }\n\n    resetFontSize() {\n        toggleMark(schema.marks.fontSize)(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        this.popoverController.dismiss();\n    }\n\n    toggleFontSize(size: FontSize) {\n\n        const command = toggleInlineMark(schema.marks.fontSize, {fontSize: size.size});\n        if (command(this.editor.state)) {\n            command(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        }\n\n        this.popoverController.dismiss();\n    }\n\n    ngOnInit() {\n        this.boldActivated = isMarkActive(this.editor.state, schema.marks.strong);\n        this.italicActivated = isMarkActive(this.editor.state, schema.marks.em);\n        this.underlineActivated = isMarkActive(this.editor.state, schema.marks.underline);\n\n        this.activeFontSize = undefined;\n        MARKS: for (const mark of findMarksInSelection(this.editor.state, schema.marks.fontSize)) {\n\n            for (const size of FontSize.sizes()) {\n                if (size.size === mark.attrs.fontSize) {\n\n                    // ups, mamy różne rozmiary w zaznaczeniu\n                    if (this.activeFontSize && size !== this.activeFontSize) {\n                        this.activeFontSize = undefined;\n                        break MARKS;\n                    }\n\n                    this.activeFontSize = size;\n                }\n            }\n        }\n    }\n\n    ionViewWillLeave() {\n        this.editor.focus();\n    }\n}\n","import {MarkType} from \"prosemirror-model\";\nimport {EditorState} from \"prosemirror-state\";\n\nexport function isBlockMarkActive(state: EditorState, type: MarkType) {\n    const {from, $from, to, empty} = state.selection;\n\n    if (empty) {\n\n        for (const mark of $from.parent.marks) {\n            if (mark.type === type) {\n                return true;\n            }\n        }\n    } else {\n        return state.doc.rangeHasMark(from, to, type);\n    }\n}\n","import {Component, OnDestroy, OnInit} from \"@angular/core\";\nimport {EventManager} from \"@angular/platform-browser\";\nimport {unsubscribe} from \"@co.mmons/rxjs-utils\";\nimport {ModalController, Platform, PopoverController} from \"@ionic/angular\";\nimport {redo, redoDepth, undo, undoDepth} from \"prosemirror-history\";\nimport {findParentNode, findParentNodeOfType} from \"prosemirror-utils\";\nimport {Subscription} from \"rxjs\";\nimport {AlignmentMenu} from \"./alignment-menu\";\nimport {HtmlEditor} from \"./editor\";\nimport {HeadingMenu} from \"./heading-menu\";\nimport {InsertMenu} from \"./insert-menu\";\nimport {LinkModal} from \"./link-modal\";\nimport {ListMenu} from \"./list-menu\";\nimport {anyMarkActive, isMarkActive} from \"./prosemirror/is-active\";\nimport {schema} from \"./prosemirror/schema\";\nimport {isBlockMarkActive} from \"./prosemirror/utils/selection/is-block-mark-active\";\nimport {TextFormatMenu} from \"./text-format-menu\";\n\n@Component({\n    selector: \"ionx-html-editor-toolbar\",\n    template: `\n        <ion-button size=\"small\" fill=\"clear\" [class.active-feature]=\"activeFeatures.text\" (click)=\"showMenu($event, 'text')\">\n            <ion-icon name=\"dropdown\" slot=\"end\"></ion-icon>\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#Text\" | intlMessage}}</span>\n        </ion-button>\n\n        <ion-button size=\"small\" fill=\"clear\" [class.active-feature]=\"activeFeatures.alignment\" (click)=\"showMenu($event, 'alignment')\" *ngIf=\"!editor.features || editor.features.alignment\">\n            <ion-icon name=\"dropdown\" slot=\"end\"></ion-icon>\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#Alignment\" | intlMessage}}</span>\n        </ion-button>\n\n        <ion-button size=\"small\" fill=\"clear\" [class.active-feature]=\"activeFeatures.heading\" (click)=\"showMenu($event, 'heading')\" *ngIf=\"!editor.features || editor.features.heading\">\n            <ion-icon name=\"dropdown\" slot=\"end\"></ion-icon>\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}}</span>\n        </ion-button>\n        \n        <ion-button size=\"small\" fill=\"clear\" [class.active-feature]=\"activeFeatures.list\" (click)=\"showMenu($event, 'list')\" *ngIf=\"!editor.features || editor.features.list\">\n            <ion-icon name=\"dropdown\" slot=\"end\"></ion-icon>\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/List\" | intlMessage}}</span>\n        </ion-button>\n\n        <ion-button size=\"small\" fill=\"clear\" (click)=\"showMenu($event, 'insert')\" *ngIf=\"!editor.features || editor.features.link || editor.features.multimedia\">\n            <ion-icon name=\"dropdown\" slot=\"end\"></ion-icon>\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#Insert\" | intlMessage}}</span>\n        </ion-button>\n        \n        <ion-button size=\"small\" fill=\"clear\" class=\"active-feature\" (click)=\"editLink()\" *ngIf=\"activeFeatures.link\">\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#link/Link\" | intlMessage}}</span>\n        </ion-button>\n        \n        <div ionx--buttons-group>\n            <ion-button size=\"small\" fill=\"clear\" tabindex=\"-1\" title=\"{{'@co.mmons/ionic-extensions/html-editor#Undo' | intlMessage}}\" [disabled]=\"!canUndo\" (click)=\"undo()\">\n                <ion-icon name=\"assets/html-editor/undo.svg\" slot=\"icon-only\"></ion-icon>\n            </ion-button>\n    \n            <ion-button size=\"small\" fill=\"clear\" title=\"{{'@co.mmons/ionic-extensions/html-editor#Redo' | intlMessage}}\" [disabled]=\"!canRedo\" (click)=\"redo()\">\n                <ion-icon name=\"assets/html-editor/redo.svg\" slot=\"icon-only\"></ion-icon>\n            </ion-button>\n        </div>\n    `,\n    styles: [`\n        :host { outline: none; display: flex; justify-content: center; flex-wrap: wrap; position: sticky; position: -webkit-sticky; top: 0px; background-color: var(--background); z-index: 1; }\n        :host-context(.ion-focused) { background-color: var(--background-focused); }\n        :host ion-button { margin: 0px 4px; --padding-end: 2px; --padding-start: 4px; }\n        :host ion-button.active-feature span { font-weight: 800; }\n        :host ion-icon[slot=\"end\"] { margin: 0px; }\n        :host ion-button[disabled] { opacity: 0.5; }\n        :host [ionx--buttons-group] { display: flex; }\n        :host [ionx--buttons-group] ion-button:not(:last-child) { margin-right: 0px; }\n    `]\n})\nexport class Toolbar implements OnInit, OnDestroy {\n\n    constructor(\n        private popoverController: PopoverController,\n        private platform: Platform,\n        public readonly editor: HtmlEditor,\n        protected eventManager: EventManager,\n        private modalController: ModalController\n    ) {\n\n    }\n\n    async showMenu(event: Event, menu: string) {\n\n        const components = {\n            text: TextFormatMenu,\n            list: ListMenu,\n            alignment: AlignmentMenu,\n            insert: InsertMenu,\n            heading: HeadingMenu\n        };\n\n        const popover = await this.popoverController.create({\n            component: components[menu],\n            componentProps: {\n                editor: this.editor\n            },\n            event: event,\n            showBackdrop: this.platform.is(\"ios\")\n        });\n\n        popover.present();\n    }\n\n    activeFeatures: {\n        link?: boolean,\n        text?: boolean,\n        alignment?: boolean,\n        heading?: boolean;\n        list?: boolean\n    } = {};\n\n    async editLink() {\n        LinkModal.present(this.modalController, this.editor);\n    }\n\n    canUndo: boolean;\n\n    canRedo: boolean;\n\n    undo() {\n        undo(this.editor.view.state, (transaction) => this.editor.view.updateState(this.editor.view.state.apply(transaction)));\n        this.editor.focus();\n    }\n\n    redo() {\n        redo(this.editor.view.state, (transaction) => this.editor.view.updateState(this.editor.view.state.apply(transaction)));\n        this.editor.focus();\n\n    }\n\n    private editorSelectionChanged() {\n\n        this.canUndo = undoDepth(this.editor.view.state) > 0;\n        this.canRedo = redoDepth(this.editor.view.state) > 0;\n\n        this.activeFeatures = {};\n\n        this.activeFeatures.text = anyMarkActive(this.editor.view.state, [schema.marks.strong, schema.marks.em, schema.marks.underline, schema.marks.fontSize]);\n        this.activeFeatures.list = !!findParentNode(predicate => predicate.hasMarkup(schema.nodes.orderedList) || predicate.hasMarkup(schema.nodes.bulletList))(this.editor.state.selection);\n        this.activeFeatures.alignment = isBlockMarkActive(this.editor.view.state, schema.marks.alignment);\n        this.activeFeatures.heading = !!findParentNodeOfType(schema.nodes.heading)(this.editor.state.selection);\n        this.activeFeatures.link = isMarkActive(this.editor.view.state, schema.marks.link);\n    }\n\n    private selectionSubscription: Subscription;\n\n    async ngOnInit() {\n\n        this.selectionSubscription = this.editor.selectionChange.subscribe(() => this.editorSelectionChanged());\n\n        this.editorSelectionChanged();\n    }\n\n    ngOnDestroy() {\n        unsubscribe(this.selectionSubscription);\n    }\n\n}\n","import {CommonModule} from \"@angular/common\";\nimport {NgModule} from \"@angular/core\";\nimport {FormsModule, ReactiveFormsModule} from \"@angular/forms\";\nimport {MatchMediaModule} from \"@co.mmons/angular-extensions/browser/match-media\";\nimport {IntlModule} from \"@co.mmons/angular-intl\";\nimport {FormHelperModule} from \"@co.mmons/ionic-extensions/form-helper\";\nimport {SelectModule} from \"@co.mmons/ionic-extensions/select\";\nimport {SpinnerModule} from \"@co.mmons/ionic-extensions/spinner\";\nimport {IonicModule} from \"@ionic/angular\";\nimport {ButtonsModule} from \"@co.mmons/ionic-extensions/buttons\";\nimport {AlignmentMenu} from \"./alignment-menu\";\nimport {HtmlEditor} from \"./editor\";\nimport {HeadingMenu} from \"./heading-menu\";\nimport {InsertMenu} from \"./insert-menu\";\nimport {LinkModal} from \"./link-modal\";\nimport {ListMenu} from \"./list-menu\";\nimport {TextFormatMenu} from \"./text-format-menu\";\nimport {Toolbar} from \"./toolbar\";\n\nexport {HtmlEditor} from \"./editor\";\nexport {HtmlEditorFeatures} from \"./editor-features\";\n\n@NgModule({\n    imports: [CommonModule, IonicModule, IntlModule, SelectModule, FormsModule, ReactiveFormsModule, FormHelperModule, ButtonsModule, MatchMediaModule, SpinnerModule],\n    declarations: [HtmlEditor, AlignmentMenu, HeadingMenu, InsertMenu, LinkModal, ListMenu, TextFormatMenu, Toolbar],\n    exports: [HtmlEditor, IntlModule],\n    entryComponents: [AlignmentMenu, HeadingMenu, InsertMenu, LinkModal, ListMenu, TextFormatMenu]\n})\nexport class HtmlEditorModule {\n}\n"],"names":["MessageRef","basicNodes","bulletList","orderedList","listItem","basicMarks","Schema","PopoverController","Input","Component","undo","redo","undoInputRule","joinUp","joinDown","lift","selectParentNode","toggleMark","splitListItem","removeSelectedNode","EventEmitter","DOMSerializer","EditorState","DOMParser","waitTill","keymap","baseKeymap","gapCursor","history","EditorView","ElementRef","EventManager","NgControl","Optional","IonItem","HostBinding","Output","setBlockType","findParentNodeOfType","Validators","deepEqual","sleep","FormGroup","FormControl","unsubscribe","ModalController","ViewChild","FormHelper","GapCursor","ReplaceAroundStep","Slice","Fragment","NodeRange","liftTarget","TextSelection","NodeSelection","findWrapping","hasParentNodeOfType","findPositionOfNodeBefore","baseCommand.chainCommands","baseListCommand.liftListItem","baseListCommand.sinkListItem","baseCommand.autoJoin","baseListCommand.wrapInList","findParentNode","shallowEqual","undoDepth","redoDepth","Platform","NgModule","CommonModule","IonicModule","IntlModule","SelectModule","FormsModule","ReactiveFormsModule","FormHelperModule","ButtonsModule","MatchMediaModule","SpinnerModule"],"mappings":"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"}