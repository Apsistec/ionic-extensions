{"version":3,"file":"html-editor-module.js","sources":["ng://@co.mmons/ionic-extensions/html-editor/alignment.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/commands/toogle-block-mark.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/alignment/commands.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/marks/font-size.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/marks/alignment.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/nodes/youtube.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/schema.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/utils/selection/find-block-marks.ts","ng://@co.mmons/ionic-extensions/html-editor/alignment-menu.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/keymap.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/views/youtube.ts","ng://@co.mmons/ionic-extensions/html-editor/scroll.ts","ng://@co.mmons/ionic-extensions/html-editor/editor.ts","ng://@co.mmons/ionic-extensions/html-editor/heading-menu.ts","ng://@co.mmons/ionic-extensions/html-editor/link-type.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/utils/find-marks.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/utils/find-marks-in-selection.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/utils/find-node-start-end.ts","ng://@co.mmons/ionic-extensions/html-editor/link-modal.ts","ng://@co.mmons/ionic-extensions/html-editor/insert-menu.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/commands/filter.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/commands/is-empty-selection-at-start.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/commands/is-first-child-of-parent.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/document-utils.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/list/transforms/lift-following-list.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/list/utils/get-list-lift-target.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/list/transforms/lift-selection-list.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/mark-utils.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/utils.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/utils/find-cut-before.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/list-commands.ts","ng://@co.mmons/ionic-extensions/html-editor/list-menu.ts","ng://@co.mmons/ionic-extensions/html-editor/font-sizes.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/commands/toogle-inline-mark.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/is-active.ts","ng://@co.mmons/ionic-extensions/html-editor/text-format-menu.ts","ng://@co.mmons/ionic-extensions/html-editor/prosemirror/utils/selection/is-block-mark-active.ts","ng://@co.mmons/ionic-extensions/html-editor/toolbar.ts","ng://@co.mmons/ionic-extensions/html-editor/index.ts","ng://@co.mmons/ionic-extensions/html-editor/html-editor-module.ts"],"sourcesContent":["import {MessageRef} from \"@co.mmons/js-intl\";\n\nexport class Alignment {\n\n    private static _alignments: Alignment[] = [];\n\n    static alignments() {\n        return Alignment._alignments.slice();\n    }\n\n    static readonly left = new Alignment(\"left\");\n    static readonly right = new Alignment(\"right\");\n    static readonly center = new Alignment(\"center\");\n    static readonly justify = new Alignment(\"justify\");\n\n    private constructor(public readonly alignment: string) {\n\n        Alignment._alignments.push(this);\n\n        this.label = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"alignmentMenu/\" + alignment);\n    }\n\n    readonly label: MessageRef;\n}\n","import {MarkType, Node as PMNode, NodeType, Schema} from \"prosemirror-model\";\nimport {Transaction} from \"prosemirror-state\";\nimport {Command} from \"../command\";\n\n/**\n * Toggles block mark based on the return type of `getAttrs`.\n * This is similar to ProseMirror\"s `getAttrs` from `AttributeSpec`\n * return `false` to remove the mark.\n * return `undefined for no-op.\n * return an `object` to update the mark.\n */\nexport const toggleBlockMark = <T = object>(\n    markType: MarkType,\n    getAttrs: ((prevAttrs?: T, node?: PMNode) => T | undefined | false),\n    allowedBlocks?:\n        | Array<NodeType>\n        | ((schema: Schema, node: PMNode, parent: PMNode) => boolean),\n): Command => (state, dispatch) => {\n    let markApplied = false;\n    const tr = state.tr;\n\n    const toggleBlockMarkOnRange = (from: number, to: number, tr: Transaction) => {\n\n        state.doc.nodesBetween(from, to, (node, pos, parent) => {\n\n            if (!node.type.isBlock) {\n                return false;\n            }\n\n            if (\n                (!allowedBlocks || (Array.isArray(allowedBlocks) ? allowedBlocks.indexOf(node.type) > -1 : allowedBlocks(state.schema, node, parent))) &&\n                parent.type.allowsMarkType(markType)\n            ) {\n\n                const oldMarks = node.marks.filter(mark => mark.type === markType);\n\n                const prevAttrs = oldMarks.length ? (oldMarks[0].attrs as T) : undefined;\n                const newAttrs = getAttrs(prevAttrs, node);\n\n                if (newAttrs !== undefined) {\n\n                    tr.setNodeMarkup(\n                        pos,\n                        node.type,\n                        node.attrs,\n                        node.marks\n                            .filter(mark => !markType.excludes(mark.type))\n                            .concat(newAttrs === false ? [] : markType.create(newAttrs)),\n                    );\n\n                    markApplied = true;\n                }\n            }\n\n            return;\n\n        });\n    };\n\n    const {from, to} = state.selection;\n    toggleBlockMarkOnRange(from, to, tr);\n\n    if (markApplied && tr.docChanged) {\n        if (dispatch) {\n            dispatch(tr.scrollIntoView());\n        }\n        return true;\n    }\n\n    return false;\n};\n","import {EditorState, Transaction} from \"prosemirror-state\";\nimport {Command, CommandDispatch} from \"../command\";\nimport {toggleBlockMark} from \"../commands/toogle-block-mark\";\nimport {AlignmentState} from \"./alignment-state\";\n\n/**\n * Iterates over the commands one after the other,\n * passes the tr through and dispatches the cumulated transaction\n */\nexport const cascadeCommands = (cmds: Array<Command>) => (\n    state: EditorState,\n    dispatch?: CommandDispatch,\n) => {\n    const {tr: baseTr} = state;\n    let shouldDispatch = false;\n\n    const onDispatchAction = (tr: Transaction) => {\n        tr.steps.forEach(st => {\n            baseTr.step(st);\n        });\n        shouldDispatch = true;\n    };\n\n    cmds.forEach(cmd => {\n        cmd(state, onDispatchAction);\n    });\n\n    if (dispatch && shouldDispatch) {\n        dispatch(baseTr);\n        return true;\n    }\n    return false;\n};\n\nexport const isAlignable = (align?: AlignmentState): Command => (state, dispatch) => {\n\n    const {\n        nodes: {paragraph, heading},\n        marks: {alignment},\n    } = state.schema;\n\n    return toggleBlockMark(\n        alignment,\n        () => (!align ? undefined : align === \"left\" ? false : {align}),\n        [paragraph, heading],\n    )(state, dispatch);\n};\n\nexport const changeAlignment = (align?: AlignmentState): Command => (state, dispatch) => {\n\n    const {\n        nodes: {paragraph, heading},\n        marks: {alignment}\n    } = state.schema;\n\n    return toggleBlockMark(alignment,\n        () => (!align ? undefined : align === \"left\" ? false : {align}),\n        [paragraph, heading],\n    )(state, dispatch);\n};\n","import {MarkSpec} from \"prosemirror-model\";\n\nexport const fontSize: MarkSpec = {\n    excludes: \"fontSize\",\n    group: \"fontSize\",\n    attrs: {\n        fontSize: {},\n    },\n    parseDOM: [\n        {\n            tag: \"span[data-font-size]\",\n            getAttrs: dom => {\n                const size = (dom as Element).getAttribute(\"data-font-size\");\n                return size ? {fontSize: size} : false;\n            },\n        },\n    ],\n    toDOM(mark) {\n        return [\n            \"span\",\n            {style: `font-size: ${mark.attrs.fontSize}`, \"data-font-size\": mark.attrs.fontSize},\n            0\n        ];\n    },\n};\n","import {MarkSpec} from \"prosemirror-model\";\n\nexport const alignment: MarkSpec = {\n    excludes: \"alignment\",\n    group: \"alignment\",\n    attrs: {\n        align: {},\n    },\n    parseDOM: [\n        {\n            tag: \"div[data-align]\",\n            getAttrs: dom => {\n                const align = (dom as Element).getAttribute(\"data-align\");\n                return align ? {align} : false;\n            },\n        },\n    ],\n    toDOM(mark) {\n        return [\n            \"div\",\n            {\n                style: `text-align: ${mark.attrs.align}`,\n                \"data-align\": mark.attrs.align,\n            },\n            0\n        ];\n    },\n};\n","import {NodeSpec} from \"prosemirror-model\";\n\nexport const youtube: NodeSpec = {\n    attrs: {id: {default: \"\"}, start: {default: 0}},\n    inline: false,\n    group: \"block\",\n    draggable: false,\n\n    toDOM: (node) => {\n\n        return [\n            \"div\",\n            {\"data-youtube\": node.attrs.id + (node.attrs.start ? \",\" + node.attrs.start : \"\")}\n        ];\n    },\n\n    parseDOM: [\n        {\n            tag: \"div[data-youtube]\",\n            getAttrs: (dom) => {\n\n                // @ts-ignore\n                const info = dom.getAttribute(\"data-youtube\").split(\",\");\n\n                return {\n                    id: info[0],\n                    start: info.length > 1 ? info[1] : 0\n                };\n            },\n        }\n    ]\n};\n","import {MarkSpec, NodeSpec, Schema} from \"prosemirror-model\";\nimport {marks as basicMarks, nodes as basicNodes} from \"prosemirror-schema-basic\";\nimport {bulletList, listItem, orderedList} from \"prosemirror-schema-list\";\nimport {fontSize} from \"./marks/font-size\";\nimport {alignment} from \"./marks/alignment\";\nimport {youtube} from \"./nodes/youtube\";\n\nexport const nodes = {\n    doc: {\n        content: \"block+\",\n        marks: \"alignment\",\n    },\n\n    paragraph: {\n        content: \"inline*\",\n        marks: \"alignment strong underline em fontSize link\",\n        group: \"block\",\n        parseDOM: [{tag: \"p\"}],\n        toDOM() { return [\"p\", 0]; }\n    } as NodeSpec,\n\n    blockquote: basicNodes.blockquote,\n    horizontalRule: basicNodes.horizontal_rule,\n    heading: basicNodes.heading,\n    text: basicNodes.text,\n    hardBreak: basicNodes.hard_break,\n\n    bulletList: Object.assign({}, bulletList, {\n        content: \"listItem+\",\n        group: \"block\"\n    }) as NodeSpec,\n\n    orderedList: Object.assign({}, orderedList, {\n        content: \"listItem+\",\n        group: \"block\"\n    }) as NodeSpec,\n\n    listItem: Object.assign({}, listItem, {\n        content: \"paragraph block*\",\n        marks: \"alignment\"\n    }) as NodeSpec,\n\n    youtube\n};\n\nexport const marks = {\n    link: basicMarks.link,\n    em: basicMarks.em,\n    strong: basicMarks.strong,\n    alignment,\n    fontSize: fontSize,\n\n    underline: {\n        parseDOM: [{tag: \"u\"}, {style: \"text-decoration=underline\"}],\n        toDOM() {\n            return [\"u\", 0];\n        }\n    } as MarkSpec\n};\n\nexport const schema = new Schema<keyof typeof nodes, keyof typeof marks>({nodes: nodes, marks: marks});\n\n","import {Mark, MarkType} from \"prosemirror-model\";\nimport {EditorState} from \"prosemirror-state\";\n\nexport function findBlockMarks(state: EditorState, markType: MarkType) {\n\n    const marks: Mark[] = [];\n\n    const {from, to} = state.selection;\n\n    state.doc.nodesBetween(from, to, (node, pos, parent) => {\n\n        if (!node.type.isBlock) {\n            return false;\n        }\n\n        for (const mark of node.marks) {\n            if (mark.type === markType) {\n                marks.push(mark);\n            }\n        }\n\n    });\n\n\n    return marks;\n}\n","import {Component, Input, OnInit} from \"@angular/core\";\nimport {PopoverController} from \"@ionic/angular\";\nimport {Alignment} from \"./alignment\";\nimport {HtmlEditor} from \"./editor\";\nimport {changeAlignment} from \"./prosemirror/alignment/commands\";\nimport {schema} from \"./prosemirror/schema\";\nimport {findBlockMarks} from \"./prosemirror/utils/selection/find-block-marks\";\n\n@Component({\n    styles: [`\n        :host ion-list { margin: 0px; padding: 0px; }\n        :host ion-item:last-child { --border-width: 0px; }\n    `],\n    template: `\n        <ion-list lines=\"full\">\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleAligment(alignment)\" *ngFor=\"let alignment of Alignment.alignments()\">\n                <ion-label>{{alignment.label | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"active === alignment.alignment\"></ion-icon>\n                <ion-icon src=\"assets/html-editor/align-{{alignment.alignment}}.svg\" slot=\"start\"></ion-icon>\n            </ion-item>\n\n        </ion-list>\n    `\n})\nexport class AlignmentMenu implements OnInit {\n\n    Alignment = Alignment;\n\n    constructor(private popoverController: PopoverController) {\n    }\n\n    @Input()\n    private editor: HtmlEditor;\n\n    active: string;\n\n    toggleAligment(alignment: Alignment) {\n\n        const command = changeAlignment(<any>alignment.alignment);\n\n        if (command(this.editor.state)) {\n            command(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        }\n\n        this.popoverController.dismiss();\n    }\n\n    ngOnInit() {\n\n        this.active = undefined;\n\n        for (const mark of findBlockMarks(this.editor.state, schema.marks.alignment)) {\n\n            // zaznaczonych wiele blocków z różnym wyrównaniem\n            if (this.active && this.active !== mark.attrs.align) {\n                this.active = undefined;\n                break;\n            }\n\n            this.active = mark.attrs.align;\n        }\n    }\n\n    ionViewWillLeave() {\n        this.editor.focus();\n    }\n}\n","import {joinDown, joinUp, lift, selectParentNode, toggleMark} from \"prosemirror-commands\";\nimport {redo, undo} from \"prosemirror-history\";\nimport {undoInputRule} from \"prosemirror-inputrules\";\nimport {Schema} from \"prosemirror-model\";\nimport {splitListItem} from \"prosemirror-schema-list\";\n\nconst mac = typeof navigator !== \"undefined\" ? /Mac/.test(navigator.platform) : false;\n\nexport function buildKeymap(schema: Schema, mapKeys?: any) {\n\n    const keys = {};\n    let type: any;\n\n    function bind(key, cmd) {\n\n        if (mapKeys) {\n            const mapped = mapKeys[key];\n\n            if (mapped === false) {\n                return;\n            }\n\n            if (mapped) {\n                key = mapped;\n            }\n        }\n\n        keys[key] = cmd;\n    }\n\n\n    bind(\"Mod-z\", undo);\n    bind(\"Shift-Mod-z\", redo);\n    bind(\"Backspace\", undoInputRule);\n    if (!mac) {\n        bind(\"Mod-y\", redo);\n    }\n\n    bind(\"Alt-ArrowUp\", joinUp);\n    bind(\"Alt-ArrowDown\", joinDown);\n    bind(\"Mod-BracketLeft\", lift);\n    bind(\"Escape\", selectParentNode);\n\n    if (type = schema.marks.strong) {\n        bind(\"Mod-b\", toggleMark(type));\n        bind(\"Mod-B\", toggleMark(type));\n    }\n\n    if (type = schema.marks.em) {\n        bind(\"Mod-i\", toggleMark(type));\n        bind(\"Mod-I\", toggleMark(type));\n    }\n\n    if (type = schema.marks.underline) {\n        bind(\"Mod-u\", toggleMark(type));\n        bind(\"Mod-U\", toggleMark(type));\n    }\n\n    if (type = schema.nodes.listItem) {\n        bind(\"Enter\", splitListItem(type));\n    }\n\n    if (type = schema.nodes.hardBreak) {\n\n        const br = type;\n\n        const cmd = (state, dispatch) => {\n            dispatch(state.tr.replaceSelectionWith(br.create()).scrollIntoView());\n            return true;\n        };\n\n        bind(\"Mod-Enter\", cmd);\n        bind(\"Shift-Enter\", cmd);\n\n        if (mac) {\n            bind(\"Ctrl-Enter\", cmd);\n        }\n    }\n\n    return keys;\n}\n","import {EventManager} from \"@angular/platform-browser\";\nimport {Node} from \"prosemirror-model\";\nimport {removeSelectedNode} from \"prosemirror-utils\";\nimport {EditorView, NodeView} from \"prosemirror-view\";\n\nexport function createYoutubeIframe(id: string, start?: string) {\n\n    const iframe = document.createElement(\"iframe\");\n    iframe.height = \"200px\";\n    iframe.width = \"100%\";\n    iframe.src = `https://www.youtube.com/embed/${id}${start ? \"?start=\" + start : \"\"}`;\n    iframe.frameBorder = \"0\";\n    iframe.allow = \"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\";\n    iframe.allowFullscreen = true;\n\n    return iframe;\n}\n\n// https://www.youtube.com/watch?v=m3V7_Ov52sY\nexport class YoutubeNodeView implements NodeView {\n\n    constructor(node: Node, protected view: EditorView, eventManager: EventManager) {\n\n        this.dom = document.createElement(\"div\");\n        this.dom.style.position = \"relative\";\n        this.dom.style.overflow = \"hidden\";\n        this.dom.style.height = \"200px\";\n        this.dom.style.marginTop = \"16px\";\n        this.dom.setAttribute(\"no-blur\", \"\");\n\n        this.dom.appendChild(createYoutubeIframe(node.attrs.id, node.attrs.start));\n\n        const overlay = this.dom.appendChild(document.createElement(\"div\"));\n        overlay.style.position = \"absolute\";\n        overlay.style.left = \"0px\";\n        overlay.style.top = \"0px\";\n        overlay.style.width = \"100%\";\n        overlay.style.height = \"200px\";\n        overlay.style.display = \"flex\";\n        overlay.style.justifyContent = \"center\";\n\n        const button = overlay.appendChild(document.createElement(\"ion-button\"));\n        button.classList.add(\"ionx--interactive\");\n        button.setAttribute(\"color\", \"primary\");\n        this.deleteUnlisten = eventManager.addEventListener(button, \"click\", () => this.deleteNode());\n\n        const icon = document.createElement(\"ion-icon\");\n        icon.setAttribute(\"name\", \"trash\");\n        icon.slot = \"icon-only\";\n        button.appendChild(icon);\n    }\n\n    private deleteUnlisten: Function;\n\n    dom: HTMLElement;\n\n    private deleteNode() {\n        this.view.dispatch(removeSelectedNode(this.view.state.tr));\n    }\n\n    selectNode() {\n        this.dom.classList.add(\"ionx--selected\");\n    }\n\n    deselectNode() {\n        this.dom.classList.remove(\"ionx--selected\");\n    }\n\n    update(node: Node) {\n        return false;\n    }\n\n    destroy() {\n\n        if (this.deleteUnlisten) {\n            this.deleteUnlisten();\n        }\n    }\n\n    stopEvent(event: Event) {\n        return false;\n    }\n\n    ignoreMutation() {\n        return true;\n    }\n}\n","export function findScrollParent(element: HTMLElement): HTMLElement {\n\n    if (!element) {\n        return;\n    }\n\n    if (element.scrollHeight >= element.clientHeight) {\n        const overflowY = window.getComputedStyle(element).overflowY;\n        if (overflowY !== \"visible\" && overflowY !== \"hidden\") {\n            return element;\n        }\n    }\n\n    if (element.assignedSlot) {\n        const p = findScrollParent(element.assignedSlot.parentElement);\n        if (p) {\n            return p;\n        }\n    }\n\n    return findScrollParent(element.parentElement);\n}\n\nexport function scrollIntoView(element: HTMLElement, parent: HTMLElement) {\n\n    if (parent) {\n\n        const parentRect = parent.getBoundingClientRect();\n        const rect = element.getBoundingClientRect();\n\n        if (!(rect.top > parentRect.top && rect.top <= parentRect.bottom && rect.bottom < parentRect.height)) {\n\n            let top = element.offsetTop - 100;\n\n            if (element.offsetParent) {\n                let offsetParent = element.offsetParent as HTMLElement;\n                while (offsetParent !== parent && !!offsetParent) {\n                    top += offsetParent.offsetTop;\n                    offsetParent = offsetParent.offsetParent as HTMLElement;\n                }\n            }\n\n            parent.scrollTo({top: top});\n        }\n\n        return;\n    }\n\n    element.scrollIntoView();\n}\n\nexport function scrollToCaret(parent: HTMLElement) {\n\n    if (parent) {\n\n        const parentRect = parent.getBoundingClientRect();\n        const rect = caretTopPoint();\n        rect.top -= 100;\n\n        if (!(rect.top > parentRect.top && rect.top <= parentRect.bottom)) {\n\n            let top = rect.top - parentRect.top;\n            parent.scrollTo({top: top, behavior: \"auto\"});\n        }\n\n        return;\n    }\n\n}\n\nexport function caretTopPoint(): {left: number, top: number} {\n\n    const selection = document.getSelection();\n    const range0 = selection.getRangeAt(0);\n\n    let rect: {left: number, top: number};\n    let range: Range;\n\n    // supposed to be textNode in most cases\n    // but div[contenteditable] when empty\n    const node = range0.startContainer as Element;\n\n    const offset = range0.startOffset;\n    if (offset > 0) {\n\n        // new range, don't influence DOM state\n        range = document.createRange();\n        range.setStart(node, (offset - 1));\n        range.setEnd(node, offset);\n\n        // https://developer.mozilla.org/en-US/docs/Web/API/range.getBoundingClientRect\n        // IE9, Safari?(but look good in Safari 8)\n        rect = range.getBoundingClientRect();\n\n        return {left: rect[\"right\"], top: rect.top};\n\n    } else if (offset < node[\"length\"]) {\n\n        range = document.createRange();\n        // similar but select next on letter\n        range.setStart(node, offset);\n        range.setEnd(node, (offset + 1));\n        rect = range.getBoundingClientRect();\n\n        return {left: rect.left, top: rect.top};\n\n    } else {\n        // textNode has length\n\n        // https://developer.mozilla.org/en-US/docs/Web/API/Element.getBoundingClientRect\n        rect = node.getBoundingClientRect();\n        const styles = getComputedStyle(node);\n        const lineHeight = parseInt(styles.lineHeight);\n        const fontSize = parseInt(styles.fontSize);\n\n        // roughly half the whitespace... but not exactly\n        const delta = (lineHeight - fontSize) / 2;\n\n        return {left: rect.left, top: (rect.top + delta)};\n    }\n\n}\n","import {AfterContentChecked, AfterViewInit, Component, ElementRef, EventEmitter, HostBinding, Input, OnChanges, OnDestroy, OnInit, Optional, Output, SimpleChanges} from \"@angular/core\";\nimport {ControlValueAccessor, NgControl} from \"@angular/forms\";\nimport {EventManager} from \"@angular/platform-browser\";\nimport {waitTill} from \"@co.mmons/js-utils/core\";\nimport {IonItem} from \"@ionic/angular\";\nimport {baseKeymap} from \"prosemirror-commands\";\nimport {gapCursor} from \"prosemirror-gapcursor\";\nimport {history} from \"prosemirror-history\";\nimport {keymap} from \"prosemirror-keymap\";\nimport {DOMParser, DOMSerializer, Schema} from \"prosemirror-model\";\nimport {EditorState, Plugin, Transaction} from \"prosemirror-state\";\nimport {EditorView} from \"prosemirror-view\";\nimport {HtmlEditorFeatures} from \"./editor-features\";\nimport {buildKeymap} from \"./prosemirror/keymap\";\nimport {schema} from \"./prosemirror/schema\";\nimport {createYoutubeIframe, YoutubeNodeView} from \"./prosemirror/views/youtube\";\nimport {findScrollParent, scrollIntoView, scrollToCaret} from \"./scroll\";\n\n@Component({\n    selector: \"ionx-html-editor\",\n    template: `\n        <ionx-html-editor-toolbar [style.display]=\"readonly ? 'none' : ''\"></ionx-html-editor-toolbar>\n    `,\n    styleUrls: [\"editor.scss\"]\n})\nexport class HtmlEditor implements OnInit, AfterViewInit, ControlValueAccessor, AfterContentChecked, OnDestroy, OnChanges {\n\n    private static idGenerator: number = 0;\n\n    constructor(\n        private element: ElementRef<HTMLElement>,\n        public eventManager: EventManager,\n        @Optional() private formControl: NgControl,\n        @Optional() private item: IonItem\n    ) {\n\n        if (formControl) {\n            this.formControl.valueAccessor = this;\n        }\n\n        this.id = \"ionx-trix-editor\" + (HtmlEditor.idGenerator++);\n        this.itemInputWrapper = !!this.item;\n\n        this.element.nativeElement.setAttribute(\"no-blur\", \"\");\n    }\n\n    private eventUnlisteners: Function[] = [];\n\n    readonly id: string;\n\n    @HostBinding(\"class.ionx-item-input-wrapper\")\n    /*private*/ itemInputWrapper: boolean;\n\n    @Input()\n    features: HtmlEditorFeatures;\n\n    @Input()\n    disabled: boolean;\n\n    @Input()\n    readonly: boolean;\n\n    /**\n     * Value, that should be set when editor is fully initialized.\n     */\n    private uninitializedValue: any;\n\n    private controlOnChange: Function;\n\n    private controlOnTouched: Function;\n\n    private focused: boolean;\n\n    private silentChanges: boolean;\n\n    view: EditorView;\n\n    get state() {\n        return this.view.state;\n    }\n\n    private schema: Schema;\n\n    private plugins: Plugin[];\n\n    private scrollParent: HTMLElement;\n\n    @Output()\n    readonly change: EventEmitter<any> = new EventEmitter();\n\n    @Output()\n    readonly selectionChange: EventEmitter<any> = new EventEmitter();\n\n    @Input()\n    public set value(html: string) {\n\n        if (this.view) {\n\n            const state = EditorState.create({\n                schema: this.view.state.schema,\n                plugins: this.view.state.plugins,\n                doc: this.editorDoc(html || \"<div></div>\")\n            });\n\n            this.view.updateState(state);\n\n        } else {\n            this.uninitializedValue = html;\n        }\n\n        this.silentChanges = false;\n    }\n\n    public get value(): string {\n        if (this.view) {\n            const value = DOMSerializer.fromSchema(this.schema).serializeFragment(this.state.doc.content);\n            const tmp = document.createElement(\"div\");\n            tmp.appendChild(value);\n\n            if (!tmp.innerText) {\n                return null;\n            } else {\n                return this.prepareOutputValue(tmp);\n            }\n\n        } else {\n            return this.uninitializedValue;\n        }\n    }\n\n    get nativeElement(): HTMLElement {\n        return this.element.nativeElement;\n    }\n\n    private prepareOutputValue(value: HTMLElement) {\n\n        value.querySelectorAll(\"div[data-youtube]\").forEach((node: HTMLElement) => {\n            const params = node.getAttribute(\"data-youtube\").split(\",\");\n            node.appendChild(createYoutubeIframe(params[0], params.length > 1 ? params[1] : undefined));\n        });\n\n        return value.innerHTML;\n    }\n\n    private prepareInputValue(value: HTMLElement) {\n\n    }\n\n    setDisabledState(isDisabled: boolean): void {\n        this.disabled = !!isDisabled;\n    }\n\n    writeValue(value: any) {\n        this.silentChanges = true;\n        this.value = value;\n    }\n\n    registerOnChange(fn: Function): void {\n        this.controlOnChange = fn;\n    }\n\n    registerOnTouched(fn: Function): void {\n        this.controlOnTouched = fn;\n    }\n\n    focus() {\n\n        if (!this.scrollParent) {\n            this.scrollParent = findScrollParent(this.element.nativeElement);\n        }\n\n        (this.view.dom as HTMLElement).focus({preventScroll: true});\n\n        const pos = this.view.domAtPos(this.view.state.selection.to);\n        if (pos.node) {\n            if (pos.node.nodeType === Node.TEXT_NODE) {\n                scrollToCaret(this.scrollParent);\n            } else {\n                scrollIntoView(this.view.dom.querySelector(\".ionx--selected\") || pos.node as HTMLElement, this.scrollParent);\n            }\n        }\n    }\n\n    // @ts-ignore\n    private async editorInitialized(event: Event) {\n\n        if (this.uninitializedValue) {\n            // this.trixEditor.loadHTML(this.uninitializedValue);\n        }\n\n        // this.trixEditorController.toolbarController.applyKeyboardCommand = this.applyKeyboardCommand.bind(this);\n    }\n\n    // @ts-ignore\n    private editorFocused(event: Event) {\n\n        if (this.controlOnTouched) {\n            this.controlOnTouched(true);\n        }\n\n        this.focused = true;\n        this.updateItemClasses();\n    }\n\n    // @ts-ignore\n    private editorBlured(event: Event) {\n        this.focused = false;\n        this.updateItemClasses();\n    }\n\n    private handleScroll(view: EditorView) {\n\n        if (!this.scrollParent) {\n            this.scrollParent = findScrollParent(this.element.nativeElement);\n        }\n\n        const pos = view.domAtPos(view.state.selection.to);\n        if (pos.node) {\n            if (pos.node.nodeType === Node.TEXT_NODE) {\n                scrollToCaret(this.scrollParent);\n            } else {\n                scrollIntoView(view.dom.querySelector(\".ionx--selected\") || pos.node as HTMLElement, this.scrollParent);\n            }\n        }\n\n        return false;\n    }\n\n    private editorDoc(html: string) {\n\n        const node = document.createElement(\"div\");\n        node.innerHTML = html;\n        this.prepareInputValue(node);\n\n        return DOMParser.fromSchema(this.schema).parse(node);\n    }\n\n    private resetControlCss() {\n\n        const classes = {\n            \"ion-untouched\": this.formControl.untouched,\n            \"ion-touched\": this.formControl.touched,\n            \"ion-pristine\": this.formControl.pristine,\n            \"ion-dirty\": this.formControl.dirty,\n            \"ion-valid\": this.formControl.valid,\n            \"ion-invalid\": !this.formControl.valid\n        };\n\n        const elements: HTMLElement[] = [];\n        elements.push(this.element.nativeElement);\n\n        if (this.item) {\n            elements.push(this.item[\"el\"]);\n        }\n\n        for (const e of elements) {\n            for (const c in classes) {\n                if (classes[c]) {\n                    e.classList.add(c);\n                } else {\n                    e.classList.remove(c);\n                }\n            }\n        }\n    }\n\n    private updateItemClasses() {\n\n        if (!this.item) {\n            return;\n        }\n\n        const item: HTMLElement = this.item[\"el\"];\n\n        if (this.disabled) {\n            item.classList.remove(\"item-interactive\");\n        } else {\n            item.classList.add(\"item-interactive\");\n        }\n\n        if (this.focused) {\n            item.classList.add(\"item-has-focus\");\n        } else {\n            item.classList.remove(\"item-has-focus\");\n        }\n    }\n\n    private async fixItemOverflow() {\n\n        if (this.item) {\n            const item: HTMLElement = this.item[\"el\"];\n            await waitTill(() => !!item.shadowRoot && !!item.shadowRoot.querySelector(\".item-inner\"));\n\n            item.style.overflow = \"initial\";\n\n            const style = document.createElement(\"style\");\n            style.innerHTML = `.item-native, .item-inner, .input-wrapper { overflow: initial !important; }`;\n            item.shadowRoot.appendChild(style);\n        }\n\n    }\n\n    private editorTransaction(transaction: Transaction) {\n\n        (this.view.dom as HTMLElement).focus({preventScroll: true});\n\n        this.view.updateState(this.view.state.apply(transaction));\n\n        this.focus();\n\n        this.selectionChange.next();\n\n        if (transaction.docChanged) {\n            this.change.next();\n\n            if (this.controlOnChange && !this.silentChanges) {\n                this.controlOnChange(this.value);\n            }\n        }\n\n        this.silentChanges = false;\n    }\n\n    private readonlyChanged() {\n\n        if (this.view) {\n            this.view.dom[\"contentEditable\"] = !this.readonly && !this.disabled ? \"true\" : \"false\";\n        }\n\n    }\n\n    ngAfterViewInit(): void {\n        this.fixItemOverflow();\n        this.updateItemClasses();\n    }\n\n    ngAfterContentChecked() {\n        this.resetControlCss();\n    }\n\n    ngOnDestroy() {\n\n        for (const unlisten of this.eventUnlisteners) {\n            unlisten();\n        }\n\n        this.view.destroy();\n        this.view = undefined;\n    }\n\n    ngOnInit() {\n\n        this.schema = schema;\n\n        this.plugins = [\n            keymap(buildKeymap(schema)),\n            keymap(baseKeymap),\n            gapCursor(),\n            history()\n        ];\n\n        const state = EditorState.create({\n            schema: this.schema,\n            plugins: this.plugins,\n            doc: this.editorDoc(this.uninitializedValue ? this.uninitializedValue : \"<div></div>\")\n        });\n\n        this.view = new EditorView(this.element.nativeElement, {\n            state: state,\n            dispatchTransaction: (transaction) => this.editorTransaction(transaction),\n            handleScrollToSelection: (view) => this.handleScroll(view),\n\n            nodeViews: {\n                youtube: (node, view) => new YoutubeNodeView(node, view, this.eventManager)\n            }\n        });\n\n        this.silentChanges = false;\n\n        if (this.readonly || this.disabled) {\n            this.readonlyChanged();\n        }\n    }\n\n    ngOnChanges(changes: SimpleChanges): void {\n\n        if (changes[\"readonly\"] || changes[\"disabled\"]) {\n            this.readonlyChanged();\n        }\n\n    }\n}\n","import {Component, Input, OnInit} from \"@angular/core\";\nimport {PopoverController} from \"@ionic/angular\";\nimport {HtmlEditor} from \"./editor\";\nimport {schema} from \"./prosemirror/schema\";\nimport {setBlockType} from \"prosemirror-commands\";\nimport {findParentNodeOfType} from \"prosemirror-utils\";\n\n@Component({\n    styles: [\n        `:host ion-list { margin: 0px; padding: 0px }`,\n        `:host ion-item:last-child { --border-width: 0px; }`,\n    ],\n    template: `\n        <ion-list lines=\"full\">\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(0)\" *ngIf=\"activeHeading > 0\">\n                <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#Plain text\" | intlMessage}}</ion-label>\n            </ion-item>\n            \n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(1)\">\n                <ion-label style=\"font-size: 130%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 1</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 1\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(2)\">\n                <ion-label style=\"font-size: 125%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 2</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 2\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(3)\">\n                <ion-label style=\"font-size: 120%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 3</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 3\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(4)\">\n                <ion-label style=\"font-size: 115%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 4</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 4\"></ion-icon>\n            </ion-item>\n            \n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(5)\">\n                <ion-label style=\"font-size: 110%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 5</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 5\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleHeading(6)\">\n                <ion-label style=\"font-size: 105%; font-weight: 500\">{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}} 6</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeHeading == 6\"></ion-icon>\n            </ion-item>\n            \n        </ion-list>\n    `\n})\nexport class HeadingMenu implements OnInit {\n\n    constructor(private popoverController: PopoverController) {\n    }\n\n    activeHeading: number;\n\n    @Input()\n    editor: HtmlEditor;\n\n\n    toggleHeading(heading: number) {\n\n        if (heading > 0 && this.activeHeading !== heading) {\n\n            const command = setBlockType(schema.nodes.heading, {level: heading});\n            if (command(this.editor.state)) {\n                command(this.editor.state, (tr) => {\n                    this.editor.view.dispatch(tr);\n                });\n            }\n\n        } else {\n            setBlockType(schema.nodes.paragraph)(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        }\n\n        this.popoverController.dismiss();\n    }\n\n    ngOnInit() {\n\n        const active = findParentNodeOfType(schema.nodes.heading)(this.editor.state.selection);\n        if (active) {\n            this.activeHeading = active.node.attrs.level;\n        }\n    }\n\n    ionViewWillLeave() {\n        this.editor.focus();\n    }\n}\n","import {AbstractControl, ValidationErrors, ValidatorFn, Validators} from \"@angular/forms\";\nimport {MessageRef} from \"@co.mmons/js-intl\";\n\nexport abstract class LinkType {\n\n    protected constructor(public readonly type: string) {\n    }\n\n    abstract get label(): MessageRef;\n\n    abstract get inputType(): string;\n\n    abstract get inputComponent(): any;\n\n    abstract get inputValidators(): ValidatorFn[];\n\n    abstract get inputHint(): MessageRef;\n\n    abstract get inputLabel(): MessageRef;\n\n    abstract uri(fromLink: string): string;\n\n    toString() {\n        return this.type;\n    }\n}\n\nexport class DefaultLinkType extends LinkType {\n\n    static readonly www = new DefaultLinkType(\"www\");\n    static readonly email = new DefaultLinkType(\"email\");\n    static readonly tel = new DefaultLinkType(\"tel\");\n    static readonly sms = new DefaultLinkType(\"sms\");\n    static readonly other = new DefaultLinkType(\"other\");\n\n    constructor(type: string) {\n        super(type);\n\n        this.label = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/type/\" + type);\n\n        if (type === \"www\") {\n            this.inputType = \"url\";\n        } else if (type === \"other\") {\n            this.inputType = \"text\";\n        } else if (type === \"sms\") {\n            this.inputType = \"sms\";\n        } else {\n            this.inputType = type;\n        }\n\n        if (type === \"www\") {\n            this.inputValidators = [urlValidator];\n            this.inputLabel = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/Web page url\");\n        }\n\n        if (type === \"email\") {\n            this.inputValidators = [Validators.email];\n            this.inputLabel = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/E-mail address\");\n        }\n\n        if (type === \"tel\" || type === \"sms\") {\n            this.inputLabel = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/Phone number\");\n            this.inputHint = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/phoneNumberHint\");\n        }\n    }\n\n\n    readonly label: MessageRef;\n\n    readonly inputType: string;\n\n    readonly inputValidators: ValidatorFn[];\n\n    readonly inputComponent = undefined;\n\n    readonly inputLabel: MessageRef;\n\n    readonly inputHint: MessageRef;\n\n    uri(fromLink: string) {\n\n        if (this.type === \"www\" || this.type === \"other\") {\n            return fromLink;\n        } else if (this.type === \"tel\") {\n            return `tel:${fromLink}`;\n        } else if (this.type === \"sms\") {\n            return `sms:${fromLink}`;\n        } else if (this.type === \"email\") {\n            return `mailto:${fromLink}`;\n        }\n\n        return fromLink;\n    }\n\n}\n\nconst urlValidatorRegex = /^(?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:[a-z\\u00a1-\\uffff]{2,}\\.?))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i;\n\nfunction urlValidator(control: AbstractControl): ValidationErrors {\n\n    const value = control.value;\n\n    if (urlValidatorRegex.test(value)) {\n        return undefined;\n    }\n\n    return {\n        invalidUrl: new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"link/invalidUrlError\")\n    };\n}\n","import {deepEqual} from \"fast-equals\";\nimport {Mark, MarkType, Node} from \"prosemirror-model\";\n\nexport function findMarks(doc: Node, from: number, to: number, markType: MarkType, attrs?: {[key: string]: any}) {\n\n    const marks: Mark[] = [];\n\n    doc.nodesBetween(from, to, node => {\n\n        for (let i = 0; i < node.marks.length; i++) {\n            if (node.marks[i].type === markType && (!attrs || deepEqual(node.marks[i].attrs, attrs))) {\n                marks.push(node.marks[i]);\n            }\n        }\n\n    });\n\n    return marks;\n}\n","import {findMarks} from \"./find-marks\";\nimport {MarkType} from \"prosemirror-model\";\nimport {EditorState} from \"prosemirror-state\";\n\nexport function findMarksInSelection(state: EditorState, markType: MarkType, attrs?: {[key: string]: any}) {\n    const doc = state.doc;\n    const {from, to} = state.selection;\n    return findMarks(doc, from, to, markType, attrs);\n}\n","import {Node} from \"prosemirror-model\";\n\nexport function findNodeStartEnd(doc: Node, pos: number) {\n\n    const $pos = doc.resolve(pos);\n    const start = pos - $pos.textOffset;\n    const end = start + $pos.parent.child($pos.index()).nodeSize;\n\n    return {start, end};\n}\n","import {Component, Input, OnDestroy, OnInit, ViewChild} from \"@angular/core\";\nimport {AbstractControl, FormControl, FormGroup, ValidationErrors, Validators} from \"@angular/forms\";\nimport {FormHelper} from \"@co.mmons/ionic-extensions/form-helper\";\nimport {sleep, waitTill} from \"@co.mmons/js-utils/core\";\nimport {unsubscribe} from \"@co.mmons/rxjs-utils\";\nimport {ModalController} from \"@ionic/angular\";\nimport {toggleMark} from \"prosemirror-commands\";\nimport {Subscription} from \"rxjs\";\nimport {HtmlEditor} from \"./editor\";\nimport {DefaultLinkType, LinkType} from \"./link-type\";\nimport {schema} from \"./prosemirror/schema\";\nimport {findMarksInSelection} from \"./prosemirror/utils/find-marks-in-selection\";\nimport {findNodeStartEnd} from \"./prosemirror/utils/find-node-start-end\";\n\n@Component({\n    templateUrl: \"link-modal.html\",\n    styles: [\n        `:host ion-item:not(.ion-dirty) { --highlight-height: 0px; }`\n    ]\n})\nexport class LinkModal implements OnDestroy, OnInit {\n\n    static async present(modalController: ModalController, editor: HtmlEditor) {\n\n        const modal = await modalController.create({component: LinkModal, componentProps: {editor: editor}});\n        modal.present();\n    }\n\n    constructor(private modalController: ModalController) {\n    }\n\n    @Input()\n    private editor: HtmlEditor;\n\n    existing: boolean;\n\n    private existingType: LinkType;\n\n    private existingLink: string;\n\n    types: LinkType[];\n\n    form: FormGroup;\n\n    @ViewChild(FormHelper, {static: false})\n    formHelper: FormHelper;\n\n    async close() {\n        await this.modalController.dismiss();\n        this.editor.focus();\n    }\n\n    async unlink() {\n\n        await this.modalController.dismiss();\n\n        const selection = this.editor.state.selection;\n\n        if (selection.empty) {\n\n            const tr = this.editor.state.tr;\n\n            tr.doc.nodesBetween(selection.from, selection.to, (node, pos) => {\n\n                if (node.isText) {\n                    const $pos = tr.doc.resolve(pos);\n                    const start = pos - $pos.textOffset;\n                    const end = start + $pos.parent.child($pos.index()).nodeSize;\n\n                    tr.removeMark(start, end, schema.marks.link);\n                }\n            });\n\n            this.editor.view.dispatch(tr);\n\n        } else {\n            toggleMark(schema.marks.link)(this.editor.state, tr => this.editor.view.dispatch(tr));\n        }\n    }\n\n    async ok() {\n        this.formHelper.validateAll(\"dirty\");\n\n        if (this.form.valid) {\n            await this.modalController.dismiss();\n\n            const linkType = this.form.controls.type.value as LinkType;\n            const selection = this.editor.state.selection;\n\n            const tr = this.editor.state.tr;\n\n            if (selection.empty) {\n\n                tr.doc.nodesBetween(selection.from, selection.to, (node, pos) => {\n\n                    if (node.isText) {\n                        const {start, end} = findNodeStartEnd(tr.doc, pos);\n                        tr.addMark(start, end, schema.mark(schema.marks.link, {href: linkType.uri(this.form.controls.link.value)}));\n                    }\n                });\n\n            } else {\n\n                // usuwamy poprzedni link\n                tr.doc.nodesBetween(selection.from, selection.to, (node, pos) => {\n\n                    if (node.isText) {\n                        const {start, end} = findNodeStartEnd(tr.doc, pos);\n                        tr.removeMark(start, end, schema.marks.link);\n                    }\n                });\n\n                tr.addMark(selection.from, selection.to, schema.mark(schema.marks.link, {href: linkType.uri(this.form.controls.link.value)}));\n            }\n\n            this.editor.view.dispatch(tr);\n        }\n    }\n\n    private async typeChanged() {\n\n        if (this.form.controls.link.value) {\n            this.form.controls.link.markAsDirty();\n            this.form.controls.link.updateValueAndValidity();\n        }\n\n        await sleep(50); // we must wait for closing type selector\n\n        if (this.formHelper) {\n            this.formHelper.focus(\"link\", false);\n        }\n    }\n\n    private parseLink(uri: string): {type: LinkType, link: string} {\n\n        const prefixes = {\n            \"http:\": DefaultLinkType.www,\n            \"https:\": DefaultLinkType.www,\n            \"tel:\": DefaultLinkType.tel,\n            \"sms:\": DefaultLinkType.sms,\n            \"mailto:\": DefaultLinkType.email\n        };\n\n        const lowerCasedUri = uri.trim().toLowerCase();\n\n        for (const prefix of Object.keys(prefixes)) {\n            if (lowerCasedUri.startsWith(prefix)) {\n\n                const link = {type: prefixes[prefix], link: uri.trim()};\n\n                if (prefixes[prefix] !== DefaultLinkType.www) {\n                    link.link = uri.substring(prefix.length).trim();\n                }\n\n                return link;\n            }\n        }\n\n        return {type: DefaultLinkType.other, link: uri};\n    }\n\n    private linkValidator(control: AbstractControl): ValidationErrors {\n\n        const required = Validators.required(control);\n        if (required) {\n            return required;\n        }\n\n        const type = this.form.controls.type.value as LinkType;\n        const validators = type.inputValidators;\n\n        if (validators) {\n            for (const validator of validators) {\n                const r = validator(control);\n                if (r) {\n                    return r;\n                }\n            }\n        }\n    }\n\n    async ionViewDidEnter() {\n\n        this.types = [DefaultLinkType.www, DefaultLinkType.email, DefaultLinkType.tel, DefaultLinkType.sms, DefaultLinkType.other];\n\n        this.form = new FormGroup({\n            type: new FormControl(this.existingType || DefaultLinkType.www),\n            link: new FormControl(this.existingLink)\n        });\n\n        this.form.controls.link.setValidators(control => this.linkValidator(control));\n\n        this.typeChangesSubscription = this.form.controls[\"type\"].valueChanges.subscribe(() => this.typeChanged());\n        this.typeChanged();\n\n        await waitTill(() => !!this.formHelper);\n\n        this.formHelper.focus(\"link\", false);\n    }\n\n    async ionViewWillLeave() {\n        this.editor.focus();\n    }\n\n    ngOnInit() {\n\n        MARKS: for (const mark of findMarksInSelection(this.editor.state, schema.marks.link)) {\n            const parsed = this.parseLink(mark.attrs.href);\n            if (parsed) {\n                this.existingType = parsed.type;\n                this.existingLink = parsed.link;\n                this.existing = true;\n                break MARKS;\n            }\n        }\n    }\n\n    private typeChangesSubscription: Subscription;\n\n    ngOnDestroy() {\n        unsubscribe(this.typeChangesSubscription);\n    }\n\n}\n","import {Component, Input, OnInit, ViewChild} from \"@angular/core\";\nimport {sleep, waitTill} from \"@co.mmons/js-utils/core\";\nimport {IonInput, ModalController, PopoverController} from \"@ionic/angular\";\nimport {OverlayEventDetail} from \"@ionic/core\";\nimport {HtmlEditor} from \"./editor\";\nimport {LinkModal} from \"./link-modal\";\n\n@Component({\n    styles: [\n        `:host ion-list { margin: 0px; padding: 0px }`,\n        `:host ion-item:last-child { --border-width: 0px; }`,\n        `:host ion-item { --highlight-height: 0px; }`\n    ],\n    template: `\n        <ion-list lines=\"full\">\n            \n            <ng-template [ngIf]=\"!inputView\">\n                \n                <ion-item button=\"true\" detail=\"false\" (click)=\"insertLink()\">\n                    <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#link/Link\" | intlMessage}}</ion-label>\n                    <ion-icon name=\"link\" slot=\"start\"></ion-icon>\n                </ion-item>\n    \n                <ion-item button=\"true\" detail=\"false\" (click)=\"insertYoutube()\">\n                    <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#youtube/YouTube video\" | intlMessage}}</ion-label>\n                    <ion-icon name=\"logo-youtube\" slot=\"start\"></ion-icon>\n                </ion-item>\n                \n            </ng-template>\n            \n            <ng-template [ngIf]=\"inputView == 'youtube'\">\n\n                <ion-item>\n                    <ion-icon name=\"logo-youtube\" slot=\"start\"></ion-icon>\n                    <ion-input #youtubeInput [placeholder]=\"'@co.mmons/ionic-extensions/html-editor#youtube/Paste YouTube video url' | intlMessage\" (keydown.enter)=\"applyYoutube()\"></ion-input>\n                </ion-item>\n                \n                <ion-item>\n                    <ionx-buttons slot=\"end\">\n                        <ion-button fill=\"clear\" color=\"dark\" (click)=\"cancel()\">\n                            <ion-label>{{\"@co.mmons/js-intl#Cancel\" | intlMessage}}</ion-label>\n                        </ion-button>\n                        \n                        <ion-button fill=\"clear\" color=\"primary\" (click)=\"applyYoutube()\">\n                            <ion-label>{{\"@co.mmons/js-intl#Ok\" | intlMessage}}</ion-label>\n                        </ion-button>\n                    </ionx-buttons>\n                </ion-item>\n    \n            </ng-template>\n            \n        </ion-list>\n    `\n})\nexport class InsertMenu implements OnInit {\n\n    // @ts-ignore\n    constructor(private popoverController: PopoverController, private modalController: ModalController) {\n    }\n\n    @Input()\n    private editor: HtmlEditor;\n\n    inputView: \"youtube\";\n\n    // @ts-ignore\n    private editorLastSelection: [number, number];\n\n\n    async insertLink() {\n\n        this.popoverController.dismiss(undefined, \"link\");\n\n        LinkModal.present(this.modalController, this.editor);\n    }\n\n    @ViewChild(\"youtubeInput\", {static: false})\n    private youtubeInput: IonInput;\n\n    async insertYoutube() {\n\n        this.inputView = \"youtube\";\n\n        await waitTill(() => !!this.youtubeInput, undefined, 2000);\n        this.youtubeInput.setFocus();\n    }\n\n    // @ts-ignore\n    private parseYoutube(value: string): {id: string, start?: string} {\n        // https://www.youtube.com/watch?v=NqMgaHUNSQc\n        // https://youtu.be/NqMgaHUNSQc\n        // https://www.youtube.com/embed/NqMgaHUNSQc\n        // https://www.youtube-nocookie.com/embed/NqMgaHUNSQc\n        // https://youtu.be/NqMgaHUNSQc?t=17\n\n        value = value.replace(\"-nocookie.com/\", \".com/\");\n        value = value.replace(\"/embed/\", \"/\");\n        value = value.replace(\"youtu.be/\", \"youtube.com/\");\n        value = value.replace(\"watch?v=\", \"\");\n        value = value.replace(\"?\", \"&\");\n\n        const info = {id: undefined, start: undefined};\n\n        if (value.indexOf(\"youtube.com/\") > -1) {\n            value = value.split(\"youtube.com/\").splice(1, 1)[0];\n\n            for (const param of value.split(\"&\")) {\n                if (param.indexOf(\"=\") < 0) {\n                    info.id = param;\n                } else if (param.startsWith(\"t=\")) {\n                    info.start = param.substring(2);\n                } else if (param.startsWith(\"start=\")) {\n                    info.start = param.substring(6);\n                }\n            }\n\n        } else  {\n        }\n\n        if (info.id) {\n            return info;\n        }\n    }\n\n\n    applyYoutube() {\n\n\n        const info = this.parseYoutube(this.youtubeInput.value as string);\n        if (info) {\n            const tr = this.editor.state.tr.replaceSelectionWith(this.editor.state.schema.nodes.youtube.create({id: info.id, start: info.start || 0}));\n            this.editor.view.dispatch(tr);\n        }\n\n        this.popoverController.dismiss(undefined, \"youtube\");\n    }\n\n    cancel() {\n        this.popoverController.dismiss();\n    }\n\n    ngOnInit() {\n    }\n\n    async ionViewWillLeave(event: OverlayEventDetail<any>) {\n\n        if (!this.inputView && !event.role) {\n            this.editor.focus();\n        }\n    }\n\n    async ionViewDidLeave(event: OverlayEventDetail<any>) {\n\n        if (this.inputView) {\n            await sleep(50);\n            this.editor.focus();\n\n        } else if (!event.role) {\n            this.editor.focus();\n        }\n    }\n}\n","import {Command} from \"../command\";\nimport {Predicate} from \"../predicate\";\n\nexport const filter = (predicates: Predicate[] | Predicate, cmd: Command): Command => {\n\n    return function(state, dispatch, view): boolean {\n        if (!Array.isArray(predicates)) {\n            predicates = [predicates];\n        }\n\n        if (predicates.some(pred => !pred(state, view))) {\n            return false;\n        }\n\n        return cmd(state, dispatch, view) || false;\n    };\n};\n","import {GapCursor} from \"prosemirror-gapcursor\";\nimport {EditorState} from \"prosemirror-state\";\n\nexport const isEmptySelectionAtStart = (state: EditorState): boolean => {\n    const {empty, $from} = state.selection;\n    return (\n        empty &&\n        ($from.parentOffset === 0 || state.selection instanceof GapCursor)\n    );\n};\n\n","import {GapCursor} from \"prosemirror-gapcursor\";\nimport {EditorState} from \"prosemirror-state\";\n\nexport const isFirstChildOfParent = (state: EditorState): boolean => {\n    const {$from} = state.selection;\n    return $from.depth > 1\n        ? (state.selection instanceof GapCursor &&\n        $from.parentOffset === 0) ||\n        $from.index($from.depth - 1) === 0\n        : true;\n};\n","import {Node} from \"prosemirror-model\";\nimport {EditorState, Selection, Transaction} from \"prosemirror-state\";\nimport {ContentNodeWithPos} from \"prosemirror-utils\";\n\n/**\n * Checks if node is an empty paragraph.\n */\nexport function isEmptyParagraph(node?: Node | null): boolean {\n    return (\n        !node ||\n        (node.type.name === \"paragraph\" && !node.textContent && !node.childCount)\n    );\n}\n\n/**\n * Returns false if node contains only empty inline nodes and hardBreaks.\n */\nexport function hasVisibleContent(node: Node): boolean {\n    const isInlineNodeHasVisibleContent = (inlineNode: Node) => {\n        return inlineNode.isText\n            ? !!inlineNode.textContent.trim()\n            : inlineNode.type.name !== \"hardBreak\";\n    };\n\n    if (node.isInline) {\n        return isInlineNodeHasVisibleContent(node);\n    } else if (node.isBlock && (node.isLeaf || node.isAtom)) {\n        return true;\n    } else if (!node.childCount) {\n        return false;\n    }\n\n    for (let index = 0; index < node.childCount; index++) {\n        const child = node.child(index);\n\n        if (hasVisibleContent(child)) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\n/**\n * Checks if a node has any content. Ignores node that only contain empty block nodes.\n */\nexport function isNodeEmpty(node?: Node): boolean {\n    if (node && node.textContent) {\n        return false;\n    }\n\n    if (\n        !node ||\n        !node.childCount ||\n        (node.childCount === 1 && isEmptyParagraph(node.firstChild))\n    ) {\n        return true;\n    }\n\n    const block: Node[] = [];\n    const nonBlock: Node[] = [];\n\n    node.forEach(child => {\n        child.isInline ? nonBlock.push(child) : block.push(child);\n    });\n\n    return (\n        !nonBlock.length &&\n        !block.filter(\n            childNode =>\n                (!!childNode.childCount &&\n                    !(\n                        childNode.childCount === 1 && isEmptyParagraph(childNode.firstChild)\n                    )) ||\n                childNode.isAtom,\n        ).length\n    );\n}\n\n/**\n * Checks if a node looks like an empty document\n */\nexport function isEmptyDocument(node: Node): boolean {\n    const nodeChild = node.content.firstChild;\n\n    if (node.childCount !== 1 || !nodeChild) {\n        return false;\n    }\n    return (\n        nodeChild.type.name === \"paragraph\" &&\n        !nodeChild.childCount &&\n        nodeChild.nodeSize === 2 &&\n        (!nodeChild.marks || nodeChild.marks.length === 0)\n    );\n}\n\nexport const getStepRange = (\n    transaction: Transaction,\n): { from: number; to: number } | null => {\n    let from = -1;\n    let to = -1;\n\n    transaction.steps.forEach(step => {\n        step.getMap().forEach((_oldStart, _oldEnd, newStart, newEnd) => {\n            from = newStart < from || from === -1 ? newStart : from;\n            to = newEnd < to || to === -1 ? newEnd : to;\n        });\n    });\n\n    if (from !== -1) {\n        return { from, to };\n    }\n\n    return null;\n};\n\n/**\n * Find the farthest node given a condition\n * @param predicate Function to check the node\n */\nexport const findFarthestParentNode = (predicate: (node: Node) => boolean) => (\n    selection: Selection,\n): ContentNodeWithPos | null => {\n    const { $from } = selection;\n\n    let candidate: ContentNodeWithPos | null = null;\n\n    for (let i = $from.depth; i > 0; i--) {\n        const node = $from.node(i);\n        if (predicate(node)) {\n            candidate = {\n                pos: i > 0 ? $from.before(i) : 0,\n                start: $from.start(i),\n                depth: i,\n                node,\n            };\n        }\n    }\n    return candidate;\n};\n\nexport const isSelectionEndOfParagraph = (state: EditorState): boolean =>\n    state.selection.$to.parent.type === state.schema.nodes.paragraph &&\n    state.selection.$to.pos === state.doc.resolve(state.selection.$to.pos).end();\n\nexport function nodesBetweenChanged(\n    tr: Transaction,\n    f: (\n        node: Node<any>,\n        pos: number,\n        parent: Node<any>,\n        index: number,\n    ) => boolean | null | undefined | void,\n    startPos?: number,\n) {\n    const stepRange = getStepRange(tr);\n    if (!stepRange) {\n        return;\n    }\n\n    tr.doc.nodesBetween(stepRange.from, stepRange.to, f, startPos);\n}\n\nexport function getNodesCount(node: Node): Record<string, number> {\n    const count: Record<string, number> = {};\n\n    node.nodesBetween(0, node.nodeSize - 2, node => {\n        count[node.type.name] = (count[node.type.name] || 0) + 1;\n    });\n\n    return count;\n}\n","import {Fragment, NodeRange, Slice} from \"prosemirror-model\";\nimport {EditorState, Selection, TextSelection, Transaction,} from \"prosemirror-state\";\nimport {liftTarget, ReplaceAroundStep} from \"prosemirror-transform\";\n\nfunction liftListItem(\n    state: EditorState,\n    selection: Selection,\n    tr: Transaction,\n): Transaction {\n    const { $from, $to } = selection;\n    const nodeType = state.schema.nodes.listItem;\n    let range = $from.blockRange(\n        $to,\n        node =>\n            !!node.childCount &&\n            !!node.firstChild &&\n            node.firstChild.type === nodeType,\n    );\n    if (\n        !range ||\n        range.depth < 2 ||\n        $from.node(range.depth - 1).type !== nodeType\n    ) {\n        return tr;\n    }\n    const end = range.end;\n    const endOfList = $to.end(range.depth);\n    if (end < endOfList) {\n        tr.step(\n            new ReplaceAroundStep(\n                end - 1,\n                endOfList,\n                end,\n                endOfList,\n                new Slice(\n                    Fragment.from(nodeType.create(undefined, range.parent.copy())),\n                    1,\n                    0,\n                ),\n                1,\n                true,\n            ),\n        );\n\n        range = new NodeRange(\n            tr.doc.resolve($from.pos),\n            tr.doc.resolve(endOfList),\n            range.depth,\n        );\n    }\n    return tr.lift(range, liftTarget(range) as number).scrollIntoView();\n}\n\nexport function liftFollowingList(\n    state: EditorState,\n    from: number,\n    to: number,\n    rootListDepth: number,\n    tr: Transaction,\n): Transaction {\n    const { listItem } = state.schema.nodes;\n    let lifted = false;\n    tr.doc.nodesBetween(from, to, (node, pos) => {\n        if (!lifted && node.type === listItem && pos > from) {\n            lifted = true;\n            let listDepth = rootListDepth + 3;\n            while (listDepth > rootListDepth + 2) {\n                const start = tr.doc.resolve(tr.mapping.map(pos));\n                listDepth = start.depth;\n                const end = tr.doc.resolve(\n                    tr.mapping.map(pos + node.textContent.length),\n                );\n                const sel = new TextSelection(start, end);\n                tr = liftListItem(state, sel, tr);\n            }\n        }\n    });\n    return tr;\n}\n","import {ResolvedPos, Schema} from \"prosemirror-model\";\n\n// This will return (depth - 1) for root list parent of a list.\nexport const getListLiftTarget = (\n    schema: Schema,\n    resPos: ResolvedPos,\n): number => {\n    let target = resPos.depth;\n    const { bulletList, orderedList, listItem } = schema.nodes;\n    for (let i = resPos.depth; i > 0; i--) {\n        const node = resPos.node(i);\n        if (node.type === bulletList || node.type === orderedList) {\n            target = i;\n        }\n        if (\n            node.type !== bulletList &&\n            node.type !== orderedList &&\n            node.type !== listItem\n        ) {\n            break;\n        }\n    }\n    return target - 1;\n};\n","import {EditorState, Transaction} from \"prosemirror-state\";\nimport {getListLiftTarget} from \"../utils/get-list-lift-target\";\n\n// The function will list paragraphs in selection out to level 1 below root list.\nexport function liftSelectionList(\n    state: EditorState,\n    tr: Transaction,\n): Transaction {\n    const {from, to} = state.selection;\n    const {paragraph} = state.schema.nodes;\n    const listCol: any[] = [];\n    tr.doc.nodesBetween(from, to, (node, pos) => {\n        if (node.type === paragraph) {\n            listCol.push({node, pos});\n        }\n    });\n    for (let i = listCol.length - 1; i >= 0; i--) {\n        const paragraph = listCol[i];\n        const start = tr.doc.resolve(tr.mapping.map(paragraph.pos));\n        if (start.depth > 0) {\n            let end;\n            if (paragraph.node.textContent && paragraph.node.textContent.length > 0) {\n                end = tr.doc.resolve(\n                    tr.mapping.map(paragraph.pos + paragraph.node.textContent.length),\n                );\n            } else {\n                end = tr.doc.resolve(tr.mapping.map(paragraph.pos + 1));\n            }\n            const range = start.blockRange(end);\n            if (range) {\n                tr.lift(range, getListLiftTarget(state.schema, start));\n            }\n        }\n    }\n    return tr;\n}\n","import { Node, Mark, MarkType } from \"prosemirror-model\";\nimport { SelectionRange, EditorState, Transaction } from \"prosemirror-state\";\n\nexport const isMarkAllowedInRange = (\n    doc: Node,\n    ranges: Array<SelectionRange>,\n    type: MarkType,\n): boolean => {\n    for (let i = 0; i < ranges.length; i++) {\n        const { $from, $to } = ranges[i];\n        let can = $from.depth === 0 ? doc.type.allowsMarkType(type) : false;\n        doc.nodesBetween($from.pos, $to.pos, node => {\n            if (can) {\n                return false;\n            }\n            can = node.inlineContent && node.type.allowsMarkType(type);\n            return;\n        });\n        if (can) {\n            return can;\n        }\n    }\n    return false;\n};\n\nexport const isMarkExcluded = (\n    type: MarkType,\n    marks?: Array<Mark> | null,\n): boolean => {\n    if (marks) {\n        return marks.some(mark => mark.type !== type && mark.type.excludes(type));\n    }\n    return false;\n};\n\nconst not = <T>(fn: ((args: T) => boolean)) => (arg: T) => !fn(arg);\n\nexport const removeBlockMarks = (\n    state: EditorState,\n    marks: Array<MarkType | undefined>,\n): Transaction | undefined => {\n    const { selection, schema } = state;\n    let { tr } = state;\n\n    // Marks might not exist in Schema\n    const marksToRemove = marks.filter(Boolean);\n    if (marksToRemove.length === 0) {\n        return undefined;\n    }\n\n    /** Saves an extra dispatch */\n    let blockMarksExists = false;\n\n    const hasMark = (mark: Mark) => marksToRemove.indexOf(mark.type) > -1;\n    /**\n     * When you need to toggle the selection\n     * when another type which does not allow alignment is applied\n     */\n    state.doc.nodesBetween(selection.from, selection.to, (node, pos) => {\n        if (node.type === schema.nodes.paragraph && node.marks.some(hasMark)) {\n            blockMarksExists = true;\n            const resolvedPos = state.doc.resolve(pos);\n            const withoutBlockMarks = node.marks.filter(not(hasMark));\n            tr = tr.setNodeMarkup(\n                resolvedPos.pos,\n                undefined,\n                node.attrs,\n                withoutBlockMarks,\n            );\n        }\n    });\n    return blockMarksExists ? tr : undefined;\n};\n\n/**\n * Removes marks from nodes in the current selection that are not supported\n */\nexport const sanitizeSelectionMarks = (\n    state: EditorState,\n): Transaction | undefined => {\n    let tr: Transaction | undefined;\n    const { $from, $to } = state.tr.selection;\n    state.doc.nodesBetween($from.pos, $to.pos, (node, pos) => {\n        node.marks.forEach(mark => {\n            if (!node.type.allowsMarkType(mark.type)) {\n                const filteredMarks = node.marks.filter(m => m.type !== mark.type);\n                const position = pos > 0 ? pos - 1 : 0;\n                tr = (tr || state.tr).setNodeMarkup(\n                    position,\n                    undefined,\n                    node.attrs,\n                    filteredMarks,\n                );\n            }\n        });\n    });\n    return tr;\n};\n","import { toggleMark } from \"prosemirror-commands\";\nimport {GapCursor} from \"prosemirror-gapcursor\";\nimport {\n    Fragment,\n    Mark as PMMark,\n    MarkType,\n    Node,\n    NodeType,\n    ResolvedPos,\n    Slice,\n    Schema,\n    NodeRange,\n    Mark,\n} from \"prosemirror-model\";\nimport { EditorView } from \"prosemirror-view\";\nimport {\n    EditorState,\n    NodeSelection,\n    Selection,\n    TextSelection,\n    Transaction,\n} from \"prosemirror-state\";\nimport { liftTarget, findWrapping } from \"prosemirror-transform\";\nimport { hasParentNodeOfType } from \"prosemirror-utils\";\nimport { isNodeEmpty } from \"./document-utils\";\n\nexport {\n    isEmptyParagraph,\n    hasVisibleContent,\n    isNodeEmpty,\n    isEmptyDocument,\n    getStepRange,\n    findFarthestParentNode,\n    isSelectionEndOfParagraph,\n    nodesBetweenChanged,\n} from \"./document-utils\";\n\n\nexport const ZeroWidthSpace = \"\\u200b\";\n\nfunction validateNode(_node: Node): boolean {\n    return false;\n}\n\nfunction isMarkTypeCompatibleWithMark(\n    markType: MarkType,\n    mark: PMMark,\n): boolean {\n    return !mark.type.excludes(markType) && !markType.excludes(mark.type);\n}\n\nfunction isMarkTypeAllowedInNode(\n    markType: MarkType,\n    state: EditorState,\n): boolean {\n    return toggleMark(markType)(state);\n}\n\nfunction closest(\n    node: HTMLElement | null | undefined,\n    s: string,\n): HTMLElement | null {\n    let el = node as HTMLElement;\n    if (!el) {\n        return null;\n    }\n    if (!document.documentElement || !document.documentElement.contains(el)) {\n        return null;\n    }\n    const matches = el.matches ? \"matches\" : \"msMatchesSelector\";\n\n    do {\n        // @ts-ignore\n        if (el[matches] && el[matches](s)) {\n            return el;\n        }\n        el = (el.parentElement || el.parentNode) as HTMLElement;\n    } while (el !== null && el.nodeType === 1);\n    return null;\n}\n\nexport const isImage = (fileType?: string): boolean => {\n    return (\n        !!fileType &&\n        (fileType.indexOf(\"image/\") > -1 || fileType.indexOf(\"video/\") > -1)\n    );\n};\n\nexport function canMoveUp(state: EditorState): boolean {\n    const { selection, doc } = state;\n\n    /**\n     * If there\"s a media element on the selection,\n     * add text blocks with arrow navigation.\n     * Also, the selection could be media | mediaGroup.\n     */\n    if (selection instanceof NodeSelection) {\n        if (selection.node.type.name === \"media\") {\n            /** Weird way of checking if the previous element is a paragraph */\n            const mediaAncestorNode = doc.nodeAt(selection.anchor - 3);\n            return !!(\n                mediaAncestorNode && mediaAncestorNode.type.name === \"paragraph\"\n            );\n        } else if (selection.node.type.name === \"mediaGroup\") {\n            const mediaGroupAncestorNode = selection.$anchor.nodeBefore;\n            return !!(\n                mediaGroupAncestorNode &&\n                mediaGroupAncestorNode.type.name === \"paragraph\"\n            );\n        }\n    }\n\n    if (selection instanceof TextSelection) {\n        if (!selection.empty) {\n            return true;\n        }\n    }\n\n    return !atTheBeginningOfDoc(state);\n}\n\nexport function canMoveDown(state: EditorState): boolean {\n    const { selection, doc } = state;\n\n    /**\n     * If there\"s a media element on the selection,\n     * add text blocks with arrow navigation.\n     * Also, the selection could be media | mediaGroup.\n     */\n    if (selection instanceof NodeSelection) {\n        if (selection.node.type.name === \"media\") {\n            const nodeAfter = doc.nodeAt(selection.$head.after());\n            return !!(nodeAfter && nodeAfter.type.name === \"paragraph\");\n        } else if (selection.node.type.name === \"mediaGroup\") {\n            return !(\n                selection.$head.parentOffset === selection.$anchor.parent.content.size\n            );\n        }\n    }\n    if (selection instanceof TextSelection) {\n        if (!selection.empty) {\n            return true;\n        }\n    }\n\n    return !atTheEndOfDoc(state);\n}\n\nexport function isSelectionInsideLastNodeInDocument(\n    selection: Selection,\n): boolean {\n    const docNode = selection.$anchor.node(0);\n    const rootNode = selection.$anchor.node(1);\n\n    return docNode.lastChild === rootNode;\n}\n\nexport function atTheEndOfDoc(state: EditorState): boolean {\n    const { selection, doc } = state;\n    return doc.nodeSize - selection.$to.pos - 2 === selection.$to.depth;\n}\n\nexport function atTheBeginningOfDoc(state: EditorState): boolean {\n    const { selection } = state;\n    return selection.$from.pos === selection.$from.depth;\n}\n\nexport function atTheEndOfBlock(state: EditorState): boolean {\n    const { selection } = state;\n    const { $to } = selection;\n    if (selection instanceof GapCursor) {\n        return false;\n    }\n    if (selection instanceof NodeSelection && selection.node.isBlock) {\n        return true;\n    }\n    return endPositionOfParent($to) === $to.pos + 1;\n}\n\nexport function atTheBeginningOfBlock(state: EditorState): boolean {\n    const { selection } = state;\n    const { $from } = selection;\n    if (selection instanceof GapCursor) {\n        return false;\n    }\n    if (selection instanceof NodeSelection && selection.node.isBlock) {\n        return true;\n    }\n    return startPositionOfParent($from) === $from.pos;\n}\n\nexport function startPositionOfParent(resolvedPos: ResolvedPos): number {\n    return resolvedPos.start(resolvedPos.depth);\n}\n\nexport function endPositionOfParent(resolvedPos: ResolvedPos): number {\n    return resolvedPos.end(resolvedPos.depth) + 1;\n}\n\nexport function getCursor(selection: Selection): ResolvedPos | undefined {\n    return (selection as TextSelection).$cursor || undefined;\n}\n\n/**\n * Check if a mark is allowed at the current selection / cursor based on a given state.\n * This method looks at both the currently active marks on the transaction, as well as\n * the node and marks at the current selection to determine if the given mark type is\n * allowed.\n */\nexport function isMarkTypeAllowedInCurrentSelection(\n    markType: MarkType,\n    state: EditorState,\n) {\n\n    if (!isMarkTypeAllowedInNode(markType, state)) {\n        return false;\n    }\n\n    const { empty, $cursor, ranges } = state.selection as TextSelection;\n    if (empty && !$cursor) {\n        return false;\n    }\n\n    const isCompatibleMarkType = (mark: PMMark) =>\n        isMarkTypeCompatibleWithMark(markType, mark);\n\n    // Handle any new marks in the current transaction\n    if (\n        state.tr.storedMarks &&\n        !state.tr.storedMarks.every(isCompatibleMarkType)\n    ) {\n        return false;\n    }\n\n    if ($cursor) {\n        return $cursor.marks().every(isCompatibleMarkType);\n    }\n\n    // Check every node in a selection - ensuring that it is compatible with the current mark type\n    return ranges.every(({ $from, $to }) => {\n        let allowedInActiveMarks =\n            $from.depth === 0 ? state.doc.marks.every(isCompatibleMarkType) : true;\n\n        state.doc.nodesBetween($from.pos, $to.pos, node => {\n            allowedInActiveMarks =\n                allowedInActiveMarks && node.marks.every(isCompatibleMarkType);\n        });\n\n        return allowedInActiveMarks;\n    });\n}\n\n/**\n * Step through block-nodes between $from and $to and returns false if a node is\n * found that isn\"t of the specified type\n */\nexport function isRangeOfType(\n    doc: Node,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n    nodeType: NodeType,\n): boolean {\n    return (\n        getAncestorNodesBetween(doc, $from, $to).filter(\n            node => node.type !== nodeType,\n        ).length === 0\n    );\n}\n\nexport function createSliceWithContent(content: string, state: EditorState) {\n    return new Slice(Fragment.from(state.schema.text(content)), 0, 0);\n}\n\n/**\n * Determines if content inside a selection can be joined with the next block.\n * We need this check since the built-in method for \"joinDown\" will join a orderedList with bulletList.\n */\nexport function canJoinDown(\n    selection: Selection,\n    doc: any,\n    nodeType: NodeType,\n): boolean {\n    return checkNodeDown(selection, doc, node => node.type === nodeType);\n}\n\nexport function checkNodeDown(\n    selection: Selection,\n    doc: Node,\n    filter: (node: Node) => boolean,\n): boolean {\n    const res = doc.resolve(\n        selection.$to.after(findAncestorPosition(doc, selection.$to).depth),\n    );\n    return res.nodeAfter ? filter(res.nodeAfter) : false;\n}\n\nexport const setNodeSelection = (view: EditorView, pos: number) => {\n    const { state, dispatch } = view;\n\n    if (!isFinite(pos)) {\n        return;\n    }\n\n    const tr = state.tr.setSelection(NodeSelection.create(state.doc, pos));\n    dispatch(tr);\n};\n\nexport function setTextSelection(\n    view: EditorView,\n    anchor: number,\n    head?: number,\n) {\n    const { state } = view;\n    const tr = state.tr.setSelection(\n        TextSelection.create(state.doc, anchor, head),\n    );\n    view.dispatch(tr);\n}\n\n/**\n * Determines if content inside a selection can be joined with the previous block.\n * We need this check since the built-in method for \"joinUp\" will join a orderedList with bulletList.\n */\nexport function canJoinUp(\n    selection: Selection,\n    doc: any,\n    nodeType: NodeType,\n): boolean {\n    const res = doc.resolve(\n        selection.$from.before(findAncestorPosition(doc, selection.$from).depth),\n    );\n    return res.nodeBefore && res.nodeBefore.type === nodeType;\n}\n\n/**\n * Returns all top-level ancestor-nodes between $from and $to\n */\nexport function getAncestorNodesBetween(\n    doc: Node,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n): Node[] {\n    const nodes = Array<Node>();\n    const maxDepth = findAncestorPosition(doc, $from).depth;\n    let current = doc.resolve($from.start(maxDepth));\n\n    while (current.pos <= $to.start($to.depth)) {\n        const depth = Math.min(current.depth, maxDepth);\n        const node = current.node(depth);\n\n        if (node) {\n            nodes.push(node);\n        }\n\n        if (depth === 0) {\n            break;\n        }\n\n        let next: ResolvedPos = doc.resolve(current.after(depth));\n        if (next.start(depth) >= doc.nodeSize - 2) {\n            break;\n        }\n\n        if (next.depth !== current.depth) {\n            next = doc.resolve(next.pos + 2);\n        }\n\n        if (next.depth) {\n            current = doc.resolve(next.start(next.depth));\n        } else {\n            current = doc.resolve(next.end(next.depth));\n        }\n    }\n\n    return nodes;\n}\n\n/**\n * Finds all \"selection-groups\" within a range. A selection group is based on ancestors.\n *\n * Example:\n * Given the following document and selection ({<} = start of selection and {>} = end)\n *  doc\n *    blockquote\n *      ul\n *        li\n *        li{<}\n *        li\n *     p\n *     p{>}\n *\n * The output will be two selection-groups. One within the ul and one with the two paragraphs.\n */\nexport function getGroupsInRange(\n    doc: Node,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n    isNodeValid: (node: Node) => boolean = validateNode,\n): Array<{ $from: ResolvedPos; $to: ResolvedPos }> {\n    const groups = Array<{ $from: ResolvedPos; $to: ResolvedPos }>();\n    const commonAncestor = hasCommonAncestor(doc, $from, $to);\n    const fromAncestor = findAncestorPosition(doc, $from);\n\n    if (\n        commonAncestor ||\n        (fromAncestor.depth === 1 && isNodeValid($from.node(1)))\n    ) {\n        groups.push({ $from, $to });\n    } else {\n        let current = $from;\n\n        while (current.pos < $to.pos) {\n            let ancestorPos = findAncestorPosition(doc, current);\n            while (ancestorPos.depth > 1) {\n                ancestorPos = findAncestorPosition(doc, ancestorPos);\n            }\n\n            const endPos = doc.resolve(\n                Math.min(\n                    // should not be smaller then start position in case of an empty paragraph for example.\n                    Math.max(\n                        ancestorPos.start(ancestorPos.depth),\n                        ancestorPos.end(ancestorPos.depth) - 3,\n                    ),\n                    $to.pos,\n                ),\n            );\n\n            groups.push({\n                $from: current,\n                $to: endPos,\n            });\n\n            current = doc.resolve(Math.min(endPos.after(1) + 1, doc.nodeSize - 2));\n        }\n    }\n\n    return groups;\n}\n\n/**\n * Traverse the document until an \"ancestor\" is found. Any nestable block can be an ancestor.\n */\nexport function findAncestorPosition(doc: Node, pos: any): any {\n    const nestableBlocks = [\"blockquote\", \"bulletList\", \"orderedList\"];\n\n    if (pos.depth === 1) {\n        return pos;\n    }\n\n    let node: Node | undefined = pos.node(pos.depth);\n    let newPos = pos;\n    while (pos.depth >= 1) {\n        pos = doc.resolve(pos.before(pos.depth));\n        node = pos.node(pos.depth);\n\n        if (node && nestableBlocks.indexOf(node.type.name) !== -1) {\n            newPos = pos;\n        }\n    }\n\n    return newPos;\n}\n\n/**\n * Determine if two positions have a common ancestor.\n */\nexport function hasCommonAncestor(\n    doc: Node,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n): boolean {\n    let current;\n    let target;\n\n    if ($from.depth > $to.depth) {\n        current = findAncestorPosition(doc, $from);\n        target = findAncestorPosition(doc, $to);\n    } else {\n        current = findAncestorPosition(doc, $to);\n        target = findAncestorPosition(doc, $from);\n    }\n\n    while (current.depth > target.depth && current.depth > 1) {\n        current = findAncestorPosition(doc, current);\n    }\n\n    return current.node(current.depth) === target.node(target.depth);\n}\n\n/**\n * Takes a selection $from and $to and lift all text nodes from their parents to document-level\n */\nexport function liftSelection(\n    tr: Transaction,\n    doc: Node,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n) {\n    let startPos = $from.start($from.depth);\n    let endPos = $to.end($to.depth);\n    const target = Math.max(0, findAncestorPosition(doc, $from).depth - 1);\n\n    tr.doc.nodesBetween(startPos, endPos, (node, pos) => {\n        if (\n            node.isText || // Text node\n            (node.isTextblock && !node.textContent) // Empty paragraph\n        ) {\n            const res = tr.doc.resolve(tr.mapping.map(pos));\n            const sel = new NodeSelection(res);\n            const range = sel.$from.blockRange(sel.$to);\n\n            if (liftTarget(range as NodeRange) !== undefined) {\n                tr.lift(range, target);\n            }\n        }\n    });\n\n    startPos = tr.mapping.map(startPos);\n    endPos = tr.mapping.map(endPos);\n    endPos = tr.doc.resolve(endPos).end(tr.doc.resolve(endPos).depth); // We want to select the entire node\n\n    tr.setSelection(\n        new TextSelection(tr.doc.resolve(startPos), tr.doc.resolve(endPos)),\n    );\n\n    return {\n        tr: tr,\n        $from: tr.doc.resolve(startPos),\n        $to: tr.doc.resolve(endPos),\n    };\n}\n\n/**\n * Lift nodes in block to one level above.\n */\nexport function liftSiblingNodes(view: EditorView) {\n    const { tr } = view.state;\n    const { $from, $to } = view.state.selection;\n    const blockStart = tr.doc.resolve($from.start($from.depth - 1));\n    const blockEnd = tr.doc.resolve($to.end($to.depth - 1));\n    const range = blockStart.blockRange(blockEnd);\n    view.dispatch(tr.lift(range as NodeRange, blockStart.depth - 1));\n}\n\n/**\n * Lift sibling nodes to document-level and select them.\n */\nexport function liftAndSelectSiblingNodes(view: EditorView): Transaction {\n    const { tr } = view.state;\n    const { $from, $to } = view.state.selection;\n    const blockStart = tr.doc.resolve($from.start($from.depth - 1));\n    const blockEnd = tr.doc.resolve($to.end($to.depth - 1));\n    // TODO: [ts30] handle void and null properly\n    const range = blockStart.blockRange(blockEnd) as NodeRange;\n    tr.setSelection(new TextSelection(blockStart, blockEnd));\n    tr.lift(range as NodeRange, blockStart.depth - 1);\n    return tr;\n}\n\nexport function wrapIn(\n    nodeType: NodeType,\n    tr: Transaction,\n    $from: ResolvedPos,\n    $to: ResolvedPos,\n): Transaction {\n    const range = $from.blockRange($to) as any;\n    const wrapping = range && (findWrapping(range, nodeType) as any);\n    if (wrapping) {\n        tr = tr.wrap(range, wrapping).scrollIntoView();\n    }\n    return tr;\n}\n\n/**\n * Repeating string for multiple times\n */\nexport function stringRepeat(text: string, length: number): string {\n    let result = \"\";\n    for (let x = 0; x < length; x++) {\n        result += text;\n    }\n    return result;\n}\n\n/**\n * A replacement for `Array.from` until it becomes widely implemented.\n */\nexport function arrayFrom(obj: any): any[] {\n    return Array.prototype.slice.call(obj);\n}\n\n/**\n * Replacement for Element.closest, until it becomes widely implemented\n * Returns the ancestor element of a particular type if exists or null\n */\nexport function closestElement(\n    node: HTMLElement | null | undefined,\n    s: string,\n): HTMLElement | null {\n    return closest(node, s);\n}\n\n/*\n * From Modernizr\n * Returns the kind of transitionevent available for the element\n */\nexport function whichTransitionEvent<TransitionEventName extends string>() {\n    const el = document.createElement(\"fakeelement\");\n    const transitions: Record<string, string> = {\n        transition: \"transitionend\",\n        MozTransition: \"transitionend\",\n        OTransition: \"oTransitionEnd\",\n        WebkitTransition: \"webkitTransitionEnd\",\n    };\n\n    for (const t in transitions) {\n        if (el.style[t as keyof CSSStyleDeclaration] !== undefined) {\n            // Use a generic as the return type because TypeScript doesnt know\n            // about cross browser features, so we cast here to align to the\n            // standard Event spec and propagate the type properly to the callbacks\n            // of `addEventListener` and `removeEventListener`.\n            return transitions[t] as TransitionEventName;\n        }\n    }\n\n    return;\n}\n\n/**\n * Function will create a list of wrapper blocks present in a selection.\n */\nfunction getSelectedWrapperNodes(state: EditorState): NodeType[] {\n    const nodes: Array<NodeType> = [];\n    if (state.selection) {\n        const { $from, $to } = state.selection;\n        const {\n            blockquote,\n            panel,\n            orderedList,\n            bulletList,\n            listItem,\n            codeBlock,\n        } = state.schema.nodes;\n        state.doc.nodesBetween($from.pos, $to.pos, node => {\n            if (\n                (node.isBlock &&\n                    [blockquote, panel, orderedList, bulletList, listItem].indexOf(\n                        node.type,\n                    ) >= 0) ||\n                node.type === codeBlock\n            ) {\n                nodes.push(node.type);\n            }\n        });\n    }\n    return nodes;\n}\n\n/**\n * Function will check if changing block types: Paragraph, Heading is enabled.\n */\nexport function areBlockTypesDisabled(state: EditorState): boolean {\n    const nodesTypes: NodeType[] = getSelectedWrapperNodes(state);\n    const { panel } = state.schema.nodes;\n    return nodesTypes.filter(type => type !== panel).length > 0;\n}\n\nexport const isTemporary = (id: string): boolean => {\n    return id.indexOf(\"temporary:\") === 0;\n};\n\n\nexport const isEmptyNode = (schema: Schema) => {\n    const {\n        doc,\n        paragraph,\n        codeBlock,\n        blockquote,\n        panel,\n        heading,\n        listItem,\n        bulletList,\n        orderedList,\n        taskList,\n        taskItem,\n        decisionList,\n        decisionItem,\n        media,\n        mediaGroup,\n        mediaSingle,\n    } = schema.nodes;\n    const innerIsEmptyNode = (node: Node): boolean => {\n        switch (node.type) {\n            case media:\n            case mediaGroup:\n            case mediaSingle:\n                return false;\n            case paragraph:\n            case codeBlock:\n            case heading:\n            case taskItem:\n            case decisionItem:\n                return node.content.size === 0;\n            case blockquote:\n            case panel:\n            case listItem:\n                return (\n                    node.content.size === 2 && innerIsEmptyNode(node.content.firstChild)\n                );\n            case bulletList:\n            case orderedList:\n                return (\n                    node.content.size === 4 && innerIsEmptyNode(node.content.firstChild)\n                );\n            case taskList:\n            case decisionList:\n                return (\n                    node.content.size === 2 && innerIsEmptyNode(node.content.firstChild)\n                );\n            case doc:\n                let isEmpty = true;\n                node.content.forEach(child => {\n                    isEmpty = isEmpty && innerIsEmptyNode(child);\n                });\n                return isEmpty;\n            default:\n                return isNodeEmpty(node);\n        }\n    };\n    return innerIsEmptyNode;\n};\n\nexport const insideTable = (state: EditorState): Boolean => {\n    const { table, tableCell } = state.schema.nodes;\n\n    return hasParentNodeOfType([table, tableCell])(state.selection);\n};\n\nexport const insideTableCell = (state: EditorState) => {\n    const { tableCell, tableHeader } = state.schema.nodes;\n    return hasParentNodeOfType([tableCell, tableHeader])(state.selection);\n};\n\nexport const isElementInTableCell = (\n    element: HTMLElement | null,\n): HTMLElement | null => {\n    return closest(element, \"td\") || closest(element, \"th\");\n};\n\nexport const isLastItemMediaGroup = (node: Node): boolean => {\n    const { content } = node;\n    return !!content.lastChild && content.lastChild.type.name === \"mediaGroup\";\n};\n\nexport const isInListItem = (state: EditorState): boolean => {\n    return hasParentNodeOfType(state.schema.nodes.listItem)(state.selection);\n};\n\nexport const hasOpenEnd = (slice: Slice): boolean => {\n    return slice.openStart > 0 || slice.openEnd > 0;\n};\n\nexport function filterChildrenBetween(\n    doc: Node,\n    from: number,\n    to: number,\n    predicate: (node: Node, pos: number, parent: Node) => boolean | undefined,\n) {\n    const results = [] as { node: Node; pos: number }[];\n    doc.nodesBetween(from, to, (node, pos, parent) => {\n        if (predicate(node, pos, parent)) {\n            results.push({ node, pos });\n        }\n    });\n    return results;\n}\n\nexport function dedupe<T>(\n    list: T[] = [],\n    iteratee?: (p: T) => T[keyof T] | T,\n): T[] {\n    const transformed = iteratee ? list.map(iteratee) : list;\n\n    return transformed\n        .map((item, index, list) => (list.indexOf(item) === index ? item : null))\n        .reduce<T[]>(\n            (acc, item, index) => (!!item ? acc.concat(list[index]) : acc),\n            [],\n        );\n}\n\nexport const isTextSelection = (\n    selection: Selection,\n): selection is TextSelection => selection instanceof TextSelection;\n\n/** Helper type for single arg function */\ntype Func<A, B> = (a: A) => B;\ntype FuncN<A extends any[], B> = (...args: A) => B;\n\n/**\n * Compose 1 to n functions.\n * @param func first function\n * @param funcs additional functions\n */\nexport function compose<\n    F1 extends Func<any, any>,\n    FN extends Array<Func<any, any>>,\n    R extends FN extends []\n        ? F1\n        : FN extends [Func<infer A, any>]\n            ? (a: A) => ReturnType<F1>\n            : FN extends [any, Func<infer A, any>]\n                ? (a: A) => ReturnType<F1>\n                : FN extends [any, any, Func<infer A, any>]\n                    ? (a: A) => ReturnType<F1>\n                    : FN extends [any, any, any, Func<infer A, any>]\n                        ? (a: A) => ReturnType<F1>\n                        : FN extends [any, any, any, any, Func<infer A, any>]\n                            ? (a: A) => ReturnType<F1>\n                            : Func<any, ReturnType<F1>> // Doubtful we\"d ever want to pipe this many functions, but in the off chance someone does, we can still infer the return type\n    >(func: F1, ...funcs: FN): R {\n    const allFuncs = [func, ...funcs];\n    return function composed(raw: any) {\n        return allFuncs.reduceRight((memo, func) => func(memo), raw);\n    } as R;\n}\n\nexport function pipe(): <R>(a: R) => R;\n\nexport function pipe<F extends Function>(f: F): F;\n\n// one function\nexport function pipe<F1 extends FuncN<any, any>>(\n    f1: F1,\n): (...args: Parameters<F1>) => ReturnType<F1>;\n\n// two function\nexport function pipe<\n    F1 extends FuncN<any, any>,\n    F2 extends Func<ReturnType<F1>, any>\n    >(f1: F1, f2: F2): (...args: Parameters<F1>) => ReturnType<F2>;\n\n// three function\nexport function pipe<\n    F1 extends FuncN<any, any>,\n    F2 extends Func<ReturnType<F1>, any>,\n    F3 extends Func<ReturnType<F2>, any>\n    >(f1: F1, f2: F2, f3: F3): (...args: Parameters<F1>) => ReturnType<F3>;\n// If needed add more than 3 function\n// Generic\nexport function pipe<\n    F1 extends FuncN<any, any>,\n    F2 extends Func<ReturnType<F1>, any>,\n    F3 extends Func<ReturnType<F2>, any>,\n    FN extends Array<Func<any, any>>\n    >(f1: F1, f2: F2, f3: F3, ...fn: FN): (...args: Parameters<F1>) => any;\n\n// rest\nexport function pipe(...fns: Function[]) {\n    if (fns.length === 0) {\n        return (a: any) => a;\n    }\n\n    if (fns.length === 1) {\n        return fns[0];\n    }\n\n    return fns.reduce((prevFn, nextFn) => (...args: any[]) =>\n        nextFn(prevFn(...args)),\n    );\n}\n\nexport const normaliseNestedLayout = (state: EditorState, node: Node) => {\n    if (state.selection.$from.depth > 1) {\n        if (node.attrs.layout && node.attrs.layout !== \"default\") {\n            return node.type.createChecked(\n                {\n                    ...node.attrs,\n                    layout: \"default\",\n                },\n                node.content,\n                node.marks,\n            );\n        }\n\n        // If its a breakout layout, we can remove the mark\n        // Since default isn\"t a valid breakout mode.\n        const breakoutMark: Mark = state.schema.marks.breakout;\n        if (breakoutMark && breakoutMark.isInSet(node.marks)) {\n            const newMarks = breakoutMark.removeFromSet(node.marks);\n            return node.type.createChecked(node.attrs, node.content, newMarks);\n        }\n    }\n\n    return node;\n};\n","// https://github.com/ProseMirror/prosemirror-commands/blob/master/src/commands.js#L90\n// Keep going left up the tree, without going across isolating boundaries, until we\n// can go along the tree at that same level\n//\n// You can think of this as, if you could construct each document like we do in the tests,\n// return the position of the first ) backwards from the current selection.\nimport {ResolvedPos} from \"prosemirror-model\";\n\nexport function findCutBefore($pos: ResolvedPos): ResolvedPos | null {\n\n    // parent is non-isolating, so we can look across this boundary\n    if (!$pos.parent.type.spec.isolating) {\n        // search up the tree from the pos\"s *parent*\n        for (let i = $pos.depth - 1; i >= 0; i--) {\n            // starting from the inner most node\"s parent, find out\n            // if we\"re not its first child\n            if ($pos.index(i) > 0) {\n                return $pos.doc.resolve($pos.before(i + 1));\n            }\n\n            if ($pos.node(i).type.spec.isolating) {\n                break;\n            }\n        }\n    }\n\n    return null;\n}\n","import * as baseCommand from \"prosemirror-commands\";\nimport {GapCursor} from \"prosemirror-gapcursor\";\nimport {Fragment, Node, NodeRange, NodeType, ResolvedPos, Slice} from \"prosemirror-model\";\nimport * as baseListCommand from \"prosemirror-schema-list\";\nimport {EditorState, NodeSelection, TextSelection, Transaction} from \"prosemirror-state\";\nimport {liftTarget, ReplaceAroundStep} from \"prosemirror-transform\";\nimport {findPositionOfNodeBefore, hasParentNodeOfType} from \"prosemirror-utils\";\nimport {EditorView} from \"prosemirror-view\";\nimport {Command} from \"./command\";\nimport {filter} from \"./commands/filter\";\nimport {isEmptySelectionAtStart} from \"./commands/is-empty-selection-at-start\";\nimport {isFirstChildOfParent} from \"./commands/is-first-child-of-parent\";\nimport {hasVisibleContent, isNodeEmpty} from \"./document-utils\";\nimport {liftFollowingList} from \"./list/transforms/lift-following-list\";\nimport {liftSelectionList} from \"./list/transforms/lift-selection-list\";\nimport {sanitizeSelectionMarks} from \"./mark-utils\";\nimport {compose, isRangeOfType} from \"./utils\";\nimport {findCutBefore} from \"./utils/find-cut-before\";\n\nconst maxIndentation = 5;\n\nconst deletePreviousEmptyListItem: Command = (state, dispatch) => {\n    const { $from } = state.selection;\n    const { listItem } = state.schema.nodes;\n\n    const $cut = findCutBefore($from);\n    if (!$cut || !$cut.nodeBefore || !($cut.nodeBefore.type === listItem)) {\n        return false;\n    }\n\n    const previousListItemEmpty = $cut.nodeBefore.childCount === 1 && $cut.nodeBefore.firstChild && $cut.nodeBefore.firstChild.nodeSize <= 2;\n\n    if (previousListItemEmpty) {\n        const { tr } = state;\n\n        if (dispatch) {\n            dispatch(\n                tr\n                    .delete($cut.pos - $cut.nodeBefore.nodeSize, $from.pos)\n                    .scrollIntoView(),\n            );\n        }\n        return true;\n    }\n\n    return false;\n};\n\nconst joinToPreviousListItem: Command = (state, dispatch) => {\n    const { $from } = state.selection;\n    const {\n        paragraph,\n        listItem,\n        codeBlock,\n        bulletList,\n        orderedList,\n    } = state.schema.nodes;\n    const isGapCursorShown = state.selection instanceof GapCursor;\n    const $cutPos = isGapCursorShown ? state.doc.resolve($from.pos + 1) : $from;\n    const $cut = findCutBefore($cutPos);\n    if (!$cut) {\n        return false;\n    }\n\n    // see if the containing node is a list\n    if (\n        $cut.nodeBefore &&\n        [bulletList, orderedList].indexOf($cut.nodeBefore.type) > -1\n    ) {\n        // and the node after this is a paragraph or a codeBlock\n        if (\n            $cut.nodeAfter &&\n            ($cut.nodeAfter.type === paragraph || $cut.nodeAfter.type === codeBlock)\n        ) {\n            // find the nearest paragraph that precedes this node\n            let $lastNode = $cut.doc.resolve($cut.pos - 1);\n\n            while ($lastNode.parent.type !== paragraph) {\n                $lastNode = state.doc.resolve($lastNode.pos - 1);\n            }\n\n            let { tr } = state;\n            if (isGapCursorShown) {\n                const nodeBeforePos = findPositionOfNodeBefore(tr.selection);\n                if (typeof nodeBeforePos !== \"number\") {\n                    return false;\n                }\n                // append the codeblock to the list node\n                const list = $cut.nodeBefore.copy(\n                    $cut.nodeBefore.content.append(\n                        Fragment.from(listItem.createChecked({}, $cut.nodeAfter)),\n                    ),\n                );\n                tr.replaceWith(\n                    nodeBeforePos,\n                    $from.pos + $cut.nodeAfter.nodeSize,\n                    list,\n                );\n            } else {\n                // take the text content of the paragraph and insert after the paragraph up until before the the cut\n                tr = state.tr.step(\n                    new ReplaceAroundStep(\n                        $lastNode.pos,\n                        $cut.pos + $cut.nodeAfter.nodeSize,\n                        $cut.pos + 1,\n                        $cut.pos + $cut.nodeAfter.nodeSize - 1,\n                        state.tr.doc.slice($lastNode.pos, $cut.pos),\n                        0,\n                        true,\n                    ),\n                );\n            }\n\n            // find out if there\"s now another list following and join them\n            // as in, [list, p, list] => [list with p, list], and we want [joined list]\n            const $postCut = tr.doc.resolve(\n                tr.mapping.map($cut.pos + $cut.nodeAfter.nodeSize),\n            );\n            if (\n                $postCut.nodeBefore &&\n                $postCut.nodeAfter &&\n                $postCut.nodeBefore.type === $postCut.nodeAfter.type &&\n                [bulletList, orderedList].indexOf($postCut.nodeBefore.type) > -1\n            ) {\n                tr = tr.join($postCut.pos);\n            }\n\n            if (dispatch) {\n                dispatch(tr.scrollIntoView());\n            }\n            return true;\n        }\n    }\n\n    return false;\n};\n\nconst isInsideListItem = (state: EditorState): boolean => {\n    const { $from } = state.selection;\n    const { listItem, paragraph } = state.schema.nodes;\n\n    if (state.selection instanceof GapCursor) {\n        return $from.parent.type === listItem;\n    }\n\n    return (\n        hasParentNodeOfType(listItem)(state.selection) &&\n        $from.parent.type === paragraph\n    );\n};\n\nconst canToJoinToPreviousListItem = (state: EditorState): boolean => {\n    const { $from } = state.selection;\n    const { bulletList, orderedList } = state.schema.nodes;\n\n    const $before = state.doc.resolve($from.pos - 1);\n    let nodeBefore = $before ? $before.nodeBefore : null;\n\n    if (state.selection instanceof GapCursor) {\n        nodeBefore = $from.nodeBefore;\n    }\n\n    return (\n        !!nodeBefore && [bulletList, orderedList].indexOf(nodeBefore.type) > -1\n    );\n};\n\nconst canOutdent = (state: EditorState): boolean => {\n    const { parent } = state.selection.$from;\n    const { listItem, paragraph } = state.schema.nodes;\n\n    if (state.selection instanceof GapCursor) {\n        return parent.type === listItem;\n    }\n\n    return (\n        parent.type === paragraph && hasParentNodeOfType(listItem)(state.selection)\n    );\n};\n\nexport const enterKeyCommand: Command = (state, dispatch): boolean => {\n    const { selection } = state;\n    if (selection.empty) {\n        const { $from } = selection;\n        const { listItem, codeBlock } = state.schema.nodes;\n        const node = $from.node($from.depth);\n        const wrapper = $from.node($from.depth - 1);\n\n        if (wrapper && wrapper.type === listItem) {\n            /** Check if the wrapper has any visible content */\n            const wrapperHasContent = hasVisibleContent(wrapper);\n            if (isNodeEmpty(node) && !wrapperHasContent) {\n                return outdentList()(state, dispatch);\n            } else if (!hasParentNodeOfType(codeBlock)(selection)) {\n                return splitListItem(listItem)(state, dispatch);\n            }\n        }\n    }\n    return false;\n};\n\nexport const backspaceKeyCommand = baseCommand.chainCommands(\n    // if we\"re at the start of a list item, we need to either backspace\n    // directly to an empty list item above, or outdent this node\n    filter(\n        [\n            isEmptySelectionAtStart,\n\n            // list items might have multiple paragraphs; only do this at the first one\n            isFirstChildOfParent,\n            canOutdent,\n        ],\n        baseCommand.chainCommands(deletePreviousEmptyListItem, outdentList()),\n    ),\n\n    // if we\"re just inside a paragraph node (or gapcursor is shown) and backspace, then try to join\n    // the text to the previous list item, if one exists\n    filter(\n        [isEmptySelectionAtStart, canToJoinToPreviousListItem],\n        joinToPreviousListItem,\n    ),\n);\n\n/**\n * Implemetation taken and modified for our needs from PM\n * @param itemType Node\n * Splits the list items, specific implementation take from PM\n */\nfunction splitListItem(itemType: NodeType): Command {\n    return function(state, dispatch) {\n        const ref = state.selection as NodeSelection;\n        const $from = ref.$from;\n        const $to = ref.$to;\n        const node = ref.node;\n        if ((node && node.isBlock) || $from.depth < 2 || !$from.sameParent($to)) {\n            return false;\n        }\n        const grandParent = $from.node(-1);\n        if (grandParent.type !== itemType) {\n            return false;\n        }\n        /** --> The following line changed from the original PM implementation to allow list additions with multiple paragraphs */\n        if (\n            (grandParent.content as any).content.length <= 1 &&\n            $from.parent.content.size === 0 &&\n            !(grandParent.content.size === 0)\n        ) {\n            // In an empty block. If this is a nested list, the wrapping\n            // list item should be split. Otherwise, bail out and let next\n            // command handle lifting.\n            if (\n                $from.depth === 2 ||\n                $from.node(-3).type !== itemType ||\n                $from.index(-2) !== $from.node(-2).childCount - 1\n            ) {\n                return false;\n            }\n            if (dispatch) {\n                let wrap = Fragment.empty;\n                const keepItem = $from.index(-1) > 0;\n                // Build a fragment containing empty versions of the structure\n                // from the outer list item to the parent node of the cursor\n                for (\n                    let d = $from.depth - (keepItem ? 1 : 2);\n                    d >= $from.depth - 3;\n                    d--\n                ) {\n                    wrap = Fragment.from($from.node(d).copy(wrap));\n                }\n                // Add a second list item with an empty default start node\n                wrap = wrap.append(Fragment.from(itemType.createAndFill()));\n                const tr$1 = state.tr.replace(\n                    $from.before(keepItem ? undefined : -1),\n                    $from.after(-3),\n                    new Slice(wrap, keepItem ? 3 : 2, 2),\n                );\n                tr$1.setSelection(\n                    (state.selection.constructor as any).near(\n                        tr$1.doc.resolve($from.pos + (keepItem ? 3 : 2)),\n                    ),\n                );\n                dispatch(tr$1.scrollIntoView());\n            }\n            return true;\n        }\n        const nextType =\n            $to.pos === $from.end()\n                ? grandParent.contentMatchAt(0).defaultType\n                : undefined;\n        const tr = state.tr.delete($from.pos, $to.pos);\n        const types = nextType && [undefined, { type: nextType }];\n\n        if (dispatch) {\n            dispatch(tr.split($from.pos, 2, types as any).scrollIntoView());\n        }\n        return true;\n    };\n}\n\n/**\n * Merge closest bullet list blocks into one\n */\nfunction mergeLists(listItem: NodeType, range: NodeRange) {\n    return (command: Command): Command => {\n        return (state, dispatch) =>\n            command(state, tr => {\n                /* we now need to handle the case that we lifted a sublist out,\n                 * and any listItems at the current level get shifted out to\n                 * their own new list; e.g.:\n                 *\n                 * unorderedList\n                 *  listItem(A)\n                 *  listItem\n                 *    unorderedList\n                 *      listItem(B)\n                 *  listItem(C)\n                 *\n                 * becomes, after unindenting the first, top level listItem, A:\n                 *\n                 * content of A\n                 * unorderedList\n                 *  listItem(B)\n                 * unorderedList\n                 *  listItem(C)\n                 *\n                 * so, we try to merge these two lists if they\"re of the same type, to give:\n                 *\n                 * content of A\n                 * unorderedList\n                 *  listItem(B)\n                 *  listItem(C)\n                 */\n\n                const $start: ResolvedPos = state.doc.resolve(range.start);\n                const $end: ResolvedPos = state.doc.resolve(range.end);\n                const $join = tr.doc.resolve(tr.mapping.map(range.end - 1));\n\n                if (\n                    $join.nodeBefore &&\n                    $join.nodeAfter &&\n                    $join.nodeBefore.type === $join.nodeAfter.type\n                ) {\n                    if (\n                        $end.nodeAfter &&\n                        $end.nodeAfter.type === listItem &&\n                        $end.parent.type === $start.parent.type\n                    ) {\n                        tr.join($join.pos);\n                    }\n                }\n\n                if (dispatch) {\n                    dispatch(tr.scrollIntoView());\n                }\n            });\n    };\n}\n\nexport function outdentList(): Command {\n    return function(state, dispatch) {\n        const { listItem } = state.schema.nodes;\n        const { $from, $to } = state.selection;\n        if (isInsideListItem(state)) {\n            // if we\"re backspacing at the start of a list item, unindent it\n            // take the the range of nodes we might be lifting\n\n            // the predicate is for when you\"re backspacing a top level list item:\n            // we don\"t want to go up past the doc node, otherwise the range\n            // to clear will include everything\n            const range = $from.blockRange(\n                $to,\n                node => node.childCount > 0 && node.firstChild && node.firstChild.type === listItem,\n            );\n\n            if (!range) {\n                return false;\n            }\n            return compose(\n                mergeLists(listItem, range), // 2. Check if I need to merge nearest list\n                baseListCommand.liftListItem, // 1. First lift list item\n            )(listItem)(state, dispatch);\n        }\n\n        return false;\n    };\n}\n\n/**\n * Check if we can sink the list.\n *\n * @returns true if we can sink the list, false if we reach the max indentation level\n */\nfunction canSink(initialIndentationLevel: number, state: EditorState): boolean {\n    /*\n        - Keep going forward in document until indentation of the node is < than the initial\n        - If indentation is EVER > max indentation, return true and don\"t sink the list\n        */\n    let currentIndentationLevel: number;\n    let currentPos = state.tr.selection.$to.pos;\n    do {\n        const resolvedPos = state.doc.resolve(currentPos);\n        currentIndentationLevel = numberNestedLists(\n            resolvedPos,\n            state.schema.nodes,\n        );\n        if (currentIndentationLevel > maxIndentation) {\n            // Cancel sink list.\n            // If current indentation less than the initial, it won\"t be\n            // larger than the max, and the loop will terminate at end of this iteration\n            return false;\n        }\n        currentPos++;\n    } while (currentIndentationLevel >= initialIndentationLevel);\n\n    return true;\n}\n\nexport function indentList(): Command {\n    return function(state, dispatch) {\n        const { listItem } = state.schema.nodes;\n        if (isInsideListItem(state)) {\n            // Record initial list indentation\n            const initialIndentationLevel = numberNestedLists(\n                state.selection.$from,\n                state.schema.nodes,\n            );\n\n            if (canSink(initialIndentationLevel, state)) {\n                compose(\n                    baseListCommand.sinkListItem,\n                )(listItem)(state, dispatch);\n            }\n            return true;\n        }\n        return false;\n    };\n}\n\nexport function liftListItems(): Command {\n    return function(state, dispatch) {\n        const { tr } = state;\n        const { $from, $to } = state.selection;\n\n        tr.doc.nodesBetween($from.pos, $to.pos, (node, pos) => {\n            // Following condition will ensure that block types paragraph, heading, codeBlock, blockquote, panel are lifted.\n            // isTextblock is true for paragraph, heading, codeBlock.\n            if (\n                node.isTextblock ||\n                node.type.name === \"blockquote\" ||\n                node.type.name === \"panel\"\n            ) {\n                const sel = new NodeSelection(tr.doc.resolve(tr.mapping.map(pos)));\n                const range = sel.$from.blockRange(sel.$to);\n\n                if (!range || sel.$from.parent.type !== state.schema.nodes.listItem) {\n                    return false;\n                }\n\n                const target = range && liftTarget(range);\n\n                if (target === undefined || target === null) {\n                    return false;\n                }\n\n                tr.lift(range, target);\n            }\n            return;\n        });\n\n        if (dispatch) {\n            dispatch(tr);\n        }\n\n        return true;\n    };\n}\n\n/**\n * Sometimes a selection in the editor can be slightly offset, for example:\n * it\"s possible for a selection to start or end at an empty node at the very end of\n * a line. This isn\"t obvious by looking at the editor and it\"s likely not what the\n * user intended - so we need to adjust the selection a bit in scenarios like that.\n */\nexport function adjustSelectionInList(\n    doc: Node,\n    selection: TextSelection,\n): TextSelection {\n    const { $from, $to } = selection;\n\n    const isSameLine = $from.pos === $to.pos;\n\n    let startPos = $from.pos;\n    const endPos = $to.pos;\n\n    if (isSameLine && startPos === doc.nodeSize - 3) {\n        // Line is empty, don\"t do anything\n        return selection;\n    }\n\n    // Selection started at the very beginning of a line and therefor points to the previous line.\n    if ($from.nodeBefore && !isSameLine) {\n        startPos++;\n        let node = doc.nodeAt(startPos);\n        while (!node || (node && !node.isText)) {\n            startPos++;\n            node = doc.nodeAt(startPos);\n        }\n    }\n\n    if (endPos === startPos) {\n        return new TextSelection(doc.resolve(startPos));\n    }\n\n    return new TextSelection(doc.resolve(startPos), doc.resolve(endPos));\n}\n\n// Get the depth of the nearest ancestor list\nexport const rootListDepth = (\n    pos: ResolvedPos,\n    nodes: Record<string, NodeType>,\n) => {\n    const { bulletList, orderedList, listItem } = nodes;\n    let depth;\n    for (let i = pos.depth - 1; i > 0; i--) {\n        const node = pos.node(i);\n        if (node.type === bulletList || node.type === orderedList) {\n            depth = i;\n        }\n        if (\n            node.type !== bulletList &&\n            node.type !== orderedList &&\n            node.type !== listItem\n        ) {\n            break;\n        }\n    }\n    return depth;\n};\n\n// Returns the number of nested lists that are ancestors of the given selection\nexport const numberNestedLists = (\n    resolvedPos: ResolvedPos,\n    nodes: Record<string, NodeType>,\n) => {\n    const { bulletList, orderedList } = nodes;\n    let count = 0;\n    for (let i = resolvedPos.depth - 1; i > 0; i--) {\n        const node = resolvedPos.node(i);\n        if (node.type === bulletList || node.type === orderedList) {\n            count += 1;\n        }\n    }\n    return count;\n};\n\nexport const toggleList = (\n    state: EditorState,\n    dispatch: (tr: Transaction) => void,\n    view: EditorView,\n    listType: \"bulletList\" | \"orderedList\",\n): boolean => {\n    const { selection } = state;\n    const fromNode = selection.$from.node(selection.$from.depth - 2);\n    const endNode = selection.$to.node(selection.$to.depth - 2);\n    if (\n        !fromNode ||\n        fromNode.type.name !== listType ||\n        (!endNode || endNode.type.name !== listType)\n    ) {\n        return toggleListCommand(listType)(state, dispatch, view);\n    } else {\n        const depth = rootListDepth(selection.$to, state.schema.nodes);\n        let tr = liftFollowingList(\n            state,\n            selection.$to.pos,\n            selection.$to.end(depth),\n            depth || 0,\n            state.tr,\n        );\n        tr = liftSelectionList(state, tr);\n        dispatch(tr);\n        return true;\n    }\n};\n\n/**\n * Check of is selection is inside a list of the specified type\n */\nexport function isInsideList(\n    state: EditorState,\n    listType: \"bulletList\" | \"orderedList\",\n) {\n    const { $from } = state.selection;\n    const parent = $from.node(-2);\n    const grandgrandParent = $from.node(-3);\n\n    return (\n        (parent && parent.type === state.schema.nodes[listType]) ||\n        (grandgrandParent && grandgrandParent.type === state.schema.nodes[listType])\n    );\n}\n\nexport function toggleListCommand(\n    listType: \"bulletList\" | \"orderedList\",\n): Command {\n    return function(state, dispatch, view) {\n        if (dispatch) {\n            dispatch(\n                state.tr.setSelection(\n                    adjustSelectionInList(state.doc, state.selection as TextSelection),\n                ),\n            );\n        }\n\n        if (!view) {\n            return false;\n        }\n\n        state = view.state;\n\n        const { $from, $to } = state.selection;\n        const isRangeOfSingleType = isRangeOfType(\n            state.doc,\n            $from,\n            $to,\n            state.schema.nodes[listType],\n        );\n\n        if (isInsideList(state, listType) && isRangeOfSingleType) {\n            // Untoggles list\n            return liftListItems()(state, dispatch);\n        } else {\n            // Converts list type e.g. bullet_list -> ordered_list if needed\n            if (!isRangeOfSingleType) {\n                liftListItems()(state, dispatch);\n                state = view.state;\n            }\n\n            // Remove any invalid marks that are not supported\n            const tr = sanitizeSelectionMarks(state);\n            if (tr) {\n                if (dispatch) {\n                    dispatch(tr);\n                }\n                state = view.state;\n            }\n            // Wraps selection in list\n            return wrapInList(state.schema.nodes[listType])(state, dispatch);\n        }\n    };\n}\n\nexport function toggleBulletList(view: EditorView) {\n    return toggleList(view.state, view.dispatch, view, \"bulletList\");\n}\n\nexport function toggleOrderedList(view: EditorView) {\n    return toggleList(view.state, view.dispatch, view, \"orderedList\");\n}\n\nexport function wrapInList(nodeType: NodeType): Command {\n    return baseCommand.autoJoin(\n        baseListCommand.wrapInList(nodeType),\n        (before, after) => before.type === after.type && before.type === nodeType,\n    );\n}\n","import {Component, Input, OnInit} from \"@angular/core\";\nimport {PopoverController} from \"@ionic/angular\";\nimport {HtmlEditor} from \"./editor\";\nimport {Command} from \"./prosemirror/command\";\nimport {indentList, outdentList, toggleList} from \"./prosemirror/list-commands\";\nimport {schema} from \"./prosemirror/schema\";\nimport {findParentNode} from \"prosemirror-utils\";\n\n@Component({\n    styles: [`\n        :host { user-select: none; }\n        :host ion-list { margin: 0px; padding: 0px; }\n        :host ion-item:last-child { --border-width: 0px; }\n        :host ion-item-divider { --background: transparent; font-size: small }\n        :host ion-item-divider ion-label { margin-top: 20px; opacity: 0.8; }\n    `],\n    template: `\n        <ion-list lines=\"full\">\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleList('bulletList')\">\n                <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/Bulleted list\" | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeUnnumberedList\"></ion-icon>\n                <ion-icon src=\"assets/html-editor/list-bulleted.svg\" slot=\"start\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleList('orderedList')\">\n                <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/Numbered list\" | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeNumberedList\"></ion-icon>\n                <ion-icon src=\"assets/html-editor/list-numbered.svg\" slot=\"start\"></ion-icon>\n            </ion-item>\n\n            <ng-template [ngIf]=\"activeUnnumberedList || activeNumberedList\">\n\n                <ion-item-divider>\n                    <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/Indent\" | intlMessage}}</ion-label>\n                </ion-item-divider>\n\n                <ion-item button=\"true\" detail=\"false\" (click)=\"level(-1)\">\n                    <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/Decrease indent\" | intlMessage}}</ion-label>\n                    <ion-icon src=\"assets/html-editor/indent-decrease.svg\" slot=\"start\"></ion-icon>\n                </ion-item>\n\n                <ion-item button=\"true\" detail=\"false\" (click)=\"level(1)\">\n                    <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/Increase indent\" | intlMessage}}</ion-label>\n                    <ion-icon src=\"assets/html-editor/indent-increase.svg\" slot=\"start\"></ion-icon>\n                </ion-item>\n\n            </ng-template>\n\n        </ion-list>\n    `\n})\nexport class ListMenu implements OnInit {\n\n    constructor(private popoverController: PopoverController) {\n    }\n\n    @Input()\n    private editor: HtmlEditor;\n\n    activeUnnumberedList: boolean;\n    activeNumberedList: boolean;\n\n    level(level: number) {\n\n        const command: Command = level < 0 ? outdentList() : indentList();\n        if (command(this.editor.state)) {\n            command(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        }\n\n        this.popoverController.dismiss();\n    }\n\n    toggleList(type: \"bulletList\" | \"orderedList\") {\n        toggleList(this.editor.state, (tr) => this.editor.view.dispatch(tr), this.editor.view, type);\n        this.popoverController.dismiss();\n    }\n\n    ngOnInit() {\n        this.activeUnnumberedList = !!findParentNode(predicate => predicate.hasMarkup(schema.nodes.bulletList))(this.editor.state.selection);\n        this.activeNumberedList = !!findParentNode(predicate => predicate.hasMarkup(schema.nodes.orderedList))(this.editor.state.selection);\n    }\n\n    ionViewWillLeave() {\n        this.editor.focus();\n    }\n}\n","import {MessageRef} from \"@co.mmons/js-intl\";\n\nexport class FontSize {\n\n    private static _sizes: FontSize[] = [];\n\n    static sizes() {\n        return FontSize._sizes.slice();\n    }\n\n    static readonly small = new FontSize(\"small\");\n    static readonly large = new FontSize(\"large\");\n\n    private constructor(public readonly size: string) {\n\n        FontSize._sizes.push(this);\n\n        this.label = new MessageRef(\"@co.mmons/ionic-extensions/html-editor\", \"textMenu/fontSize/\" + size.toUpperCase()[0] + size.substring(1));\n    }\n\n    readonly label: MessageRef;\n}\n","import {shallowEqual} from \"fast-equals\";\nimport {MarkType, Node} from \"prosemirror-model\";\nimport {Command} from \"../command\";\n\nfunction markApplies(doc: Node, from: number, to: number, type: MarkType) {\n\n    let applies = false;\n\n    doc.nodesBetween(from, to, (node, pos, parent) => {\n\n        if (applies) {\n            return false;\n        }\n\n        applies = node.isInline && parent.type.allowsMarkType(type);\n    });\n\n    return applies;\n}\n\n// return true iff all nodes in range have the mark with the same attrs\nfunction rangeHasMark(doc, from, to, type, attrs) {\n\n    let hasMark = null;\n\n    doc.nodesBetween(from, to, node => {\n\n        for (let i = 0; i < node.marks.length; i++) {\n            const markMatch = node.marks[i].type === type && (!attrs || shallowEqual(node.marks[i].attrs, attrs));\n            hasMark = (markMatch && (hasMark === null || hasMark === true));\n        }\n\n        return hasMark;\n    });\n\n    return !!hasMark;\n}\n\nexport function toggleInlineMark(markType: MarkType, attrs?: {[key: string]: any}): Command {\n\n    return function(state, dispatch) {\n\n        const { empty, from, to, $from } = state.selection;\n\n        if (!markApplies(state.doc, from, to, markType)) {\n            console.log(\"not applies\");\n            return false;\n        }\n\n        if (dispatch) {\n\n            if (empty) {\n\n                const markInSet = markType.isInSet(state.storedMarks || $from.marks());\n\n                if (markInSet && (!attrs || shallowEqual(markInSet.attrs, attrs))) {\n                    dispatch(state.tr.removeStoredMark(markType));\n                } else {\n                    dispatch(state.tr.addStoredMark(markType.create(attrs)));\n                }\n\n            } else {\n\n                if (rangeHasMark(state.doc, from, to, markType, attrs)) {\n                    dispatch(state.tr.removeMark(from, to, markType).scrollIntoView());\n                } else {\n                    dispatch(state.tr.addMark(from, to, markType.create(attrs)).scrollIntoView());\n                }\n            }\n        }\n\n        return true;\n    };\n}\n\n","import {Mark, MarkType, NodeType} from \"prosemirror-model\";\nimport {EditorState, NodeSelection} from \"prosemirror-state\";\n\nexport function isActive(state: EditorState, nodeType: NodeType, attrs?: {[key: string]: any}, marks?: Array<Mark<any>>) {\n\n    const selection = state.selection;\n\n    if (selection instanceof NodeSelection && selection.node) {\n        return selection.node.hasMarkup(nodeType, attrs, marks);\n    }\n\n    return selection.to <= selection.$from.end() && selection.$from.parent.hasMarkup(nodeType, attrs, marks);\n}\n\nexport function isMarkActive(state: EditorState, type: MarkType) {\n    const {from, $from, to, empty} = state.selection;\n\n    if (empty) {\n        return !!(type.isInSet(state.storedMarks || $from.marks()));\n    } else {\n        return state.doc.rangeHasMark(from, to, type);\n    }\n}\n\nexport function anyMarkActive(state: EditorState, types: MarkType[]) {\n\n    const {from, $from, to, empty} = state.selection;\n\n    if (empty) {\n\n        for (const type of types) {\n            if (type.isInSet(state.storedMarks || $from.marks())) {\n                return true;\n            }\n        }\n\n    } else {\n\n        for (const type of types) {\n            if (state.doc.rangeHasMark(from, to, type)) {\n                return true;\n            }\n        }\n\n    }\n\n    return false;\n}\n","import {Component, Input, OnInit} from \"@angular/core\";\nimport {PopoverController} from \"@ionic/angular\";\nimport {toggleMark} from \"prosemirror-commands\";\nimport {HtmlEditor} from \"./editor\";\nimport {FontSize} from \"./font-sizes\";\nimport {Command} from \"./prosemirror/command\";\nimport {toggleInlineMark} from \"./prosemirror/commands/toogle-inline-mark\";\nimport {isMarkActive} from \"./prosemirror/is-active\";\nimport {schema} from \"./prosemirror/schema\";\nimport {findMarksInSelection} from \"./prosemirror/utils/find-marks-in-selection\";\n\n@Component({\n    styles: [`\n        :host { user-select: none; }\n        :host ion-list { margin: 0px; padding: 0px; }\n        :host ion-item:last-child { --border-width: 0px; }\n        :host ion-item-divider { --background: transparent; font-size: small }\n        :host ion-item-divider ion-label { margin-top: 20px; opacity: 0.8; }\n    `],\n    template: `\n        <ion-list lines=\"full\">\n            \n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggle('bold')\">\n                <ion-label style=\"font-weight: bold\">{{\"@co.mmons/ionic-extensions/html-editor#textMenu/Bold\" | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"boldActivated\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggle('italic')\">\n                <ion-label style=\"font-style: italic\">{{\"@co.mmons/ionic-extensions/html-editor#textMenu/Italic\" | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"italicActivated\"></ion-icon>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggle('underline')\">\n                <ion-label style=\"text-decoration: underline\">{{\"@co.mmons/ionic-extensions/html-editor#textMenu/Underline\" | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"underlineActivated\"></ion-icon>\n            </ion-item>\n            \n            <ion-item-divider>\n                <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#textMenu/fontSize/Text size\" | intlMessage}}</ion-label>\n            </ion-item-divider>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"resetFontSize()\" *ngIf=\"activeFontSize\">\n                <ion-label>{{\"@co.mmons/ionic-extensions/html-editor#textMenu/fontSize/Default\" | intlMessage}}</ion-label>\n            </ion-item>\n\n            <ion-item button=\"true\" detail=\"false\" (click)=\"toggleFontSize(fontSize)\" *ngFor=\"let fontSize of FontSize.sizes()\">\n                <ion-label [style.fontSize]=\"fontSize.size\">{{fontSize.label | intlMessage}}</ion-label>\n                <ion-icon name=\"checkmark\" slot=\"end\" *ngIf=\"activeFontSize === fontSize\"></ion-icon>\n            </ion-item>\n\n        </ion-list>\n    `\n})\nexport class TextFormatMenu implements OnInit {\n\n    readonly FontSize = FontSize;\n\n    constructor(private popoverController: PopoverController) {\n    }\n\n    @Input()\n    editor: HtmlEditor;\n\n    boldActivated: boolean;\n\n    italicActivated: boolean;\n\n    underlineActivated: boolean;\n\n    activeFontSize: FontSize;\n\n\n    toggle(name: string) {\n\n        let command: Command;\n\n        if (name === \"bold\") {\n            command = toggleMark(schema.marks.strong);\n        } else if (name === \"italic\") {\n            command = toggleMark(schema.marks.em);\n        } else if (name === \"underline\") {\n            command = toggleMark(schema.marks.underline);\n        }\n\n        if (command(this.editor.state)) {\n            command(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        }\n\n        this.popoverController.dismiss();\n    }\n\n    resetFontSize() {\n        toggleMark(schema.marks.fontSize)(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        this.popoverController.dismiss();\n    }\n\n    toggleFontSize(size: FontSize) {\n\n        const command = toggleInlineMark(schema.marks.fontSize, {fontSize: size.size});\n        if (command(this.editor.state)) {\n            command(this.editor.state, (tr) => this.editor.view.dispatch(tr));\n        }\n\n        this.popoverController.dismiss();\n    }\n\n    ngOnInit() {\n        this.boldActivated = isMarkActive(this.editor.state, schema.marks.strong);\n        this.italicActivated = isMarkActive(this.editor.state, schema.marks.em);\n        this.underlineActivated = isMarkActive(this.editor.state, schema.marks.underline);\n\n        this.activeFontSize = undefined;\n        MARKS: for (const mark of findMarksInSelection(this.editor.state, schema.marks.fontSize)) {\n\n            for (const size of FontSize.sizes()) {\n                if (size.size === mark.attrs.fontSize) {\n\n                    // ups, mamy różne rozmiary w zaznaczeniu\n                    if (this.activeFontSize && size !== this.activeFontSize) {\n                        this.activeFontSize = undefined;\n                        break MARKS;\n                    }\n\n                    this.activeFontSize = size;\n                }\n            }\n        }\n    }\n\n    ionViewWillLeave() {\n        this.editor.focus();\n    }\n}\n","import {MarkType} from \"prosemirror-model\";\nimport {EditorState} from \"prosemirror-state\";\n\nexport function isBlockMarkActive(state: EditorState, type: MarkType) {\n    const {from, $from, to, empty} = state.selection;\n\n    if (empty) {\n\n        for (const mark of $from.parent.marks) {\n            if (mark.type === type) {\n                return true;\n            }\n        }\n    } else {\n        return state.doc.rangeHasMark(from, to, type);\n    }\n}\n","import {Component, OnDestroy, OnInit} from \"@angular/core\";\nimport {EventManager} from \"@angular/platform-browser\";\nimport {unsubscribe} from \"@co.mmons/rxjs-utils\";\nimport {ModalController, Platform, PopoverController} from \"@ionic/angular\";\nimport {redo, redoDepth, undo, undoDepth} from \"prosemirror-history\";\nimport {findParentNode, findParentNodeOfType} from \"prosemirror-utils\";\nimport {Subscription} from \"rxjs\";\nimport {AlignmentMenu} from \"./alignment-menu\";\nimport {HtmlEditor} from \"./editor\";\nimport {HeadingMenu} from \"./heading-menu\";\nimport {InsertMenu} from \"./insert-menu\";\nimport {LinkModal} from \"./link-modal\";\nimport {ListMenu} from \"./list-menu\";\nimport {anyMarkActive, isMarkActive} from \"./prosemirror/is-active\";\nimport {schema} from \"./prosemirror/schema\";\nimport {isBlockMarkActive} from \"./prosemirror/utils/selection/is-block-mark-active\";\nimport {TextFormatMenu} from \"./text-format-menu\";\n\n@Component({\n    selector: \"ionx-html-editor-toolbar\",\n    template: `\n        <ion-button size=\"small\" fill=\"clear\" [class.active-feature]=\"activeFeatures.text\" (click)=\"showMenu($event, 'text')\">\n            <ion-icon name=\"dropdown\" slot=\"end\"></ion-icon>\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#Text\" | intlMessage}}</span>\n        </ion-button>\n\n        <ion-button size=\"small\" fill=\"clear\" [class.active-feature]=\"activeFeatures.alignment\" (click)=\"showMenu($event, 'alignment')\" *ngIf=\"!editor.features || editor.features.alignment\">\n            <ion-icon name=\"dropdown\" slot=\"end\"></ion-icon>\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#Alignment\" | intlMessage}}</span>\n        </ion-button>\n\n        <ion-button size=\"small\" fill=\"clear\" [class.active-feature]=\"activeFeatures.heading\" (click)=\"showMenu($event, 'heading')\" *ngIf=\"!editor.features || editor.features.heading\">\n            <ion-icon name=\"dropdown\" slot=\"end\"></ion-icon>\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#Heading\" | intlMessage}}</span>\n        </ion-button>\n        \n        <ion-button size=\"small\" fill=\"clear\" [class.active-feature]=\"activeFeatures.list\" (click)=\"showMenu($event, 'list')\" *ngIf=\"!editor.features || editor.features.list\">\n            <ion-icon name=\"dropdown\" slot=\"end\"></ion-icon>\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#listMenu/List\" | intlMessage}}</span>\n        </ion-button>\n\n        <ion-button size=\"small\" fill=\"clear\" (click)=\"showMenu($event, 'insert')\" *ngIf=\"!editor.features || editor.features.link || editor.features.multimedia\">\n            <ion-icon name=\"dropdown\" slot=\"end\"></ion-icon>\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#Insert\" | intlMessage}}</span>\n        </ion-button>\n        \n        <ion-button size=\"small\" fill=\"clear\" class=\"active-feature\" (click)=\"editLink()\" *ngIf=\"activeFeatures.link\">\n            <span>{{\"@co.mmons/ionic-extensions/html-editor#link/Link\" | intlMessage}}</span>\n        </ion-button>\n        \n        <div ionx--buttons-group>\n            <ion-button size=\"small\" fill=\"clear\" tabindex=\"-1\" title=\"{{'@co.mmons/ionic-extensions/html-editor#Undo' | intlMessage}}\" [disabled]=\"!canUndo\" (click)=\"undo()\">\n                <ion-icon name=\"assets/html-editor/undo.svg\" slot=\"icon-only\"></ion-icon>\n            </ion-button>\n    \n            <ion-button size=\"small\" fill=\"clear\" title=\"{{'@co.mmons/ionic-extensions/html-editor#Redo' | intlMessage}}\" [disabled]=\"!canRedo\" (click)=\"redo()\">\n                <ion-icon name=\"assets/html-editor/redo.svg\" slot=\"icon-only\"></ion-icon>\n            </ion-button>\n        </div>\n    `,\n    styles: [`\n        :host { outline: none; display: flex; justify-content: center; flex-wrap: wrap; position: sticky; position: -webkit-sticky; top: 0px; background-color: var(--background); z-index: 1; }\n        :host-context(.ion-focused) { background-color: var(--background-focused); }\n        :host ion-button { margin: 0px 4px; --padding-end: 2px; --padding-start: 4px; }\n        :host ion-button.active-feature span { font-weight: 800; }\n        :host ion-icon[slot=\"end\"] { margin: 0px; }\n        :host ion-button[disabled] { opacity: 0.5; }\n        :host [ionx--buttons-group] { display: flex; }\n        :host [ionx--buttons-group] ion-button:not(:last-child) { margin-right: 0px; }\n    `]\n})\nexport class Toolbar implements OnInit, OnDestroy {\n\n    constructor(\n        private popoverController: PopoverController,\n        private platform: Platform,\n        public readonly editor: HtmlEditor,\n        protected eventManager: EventManager,\n        private modalController: ModalController\n    ) {\n\n    }\n\n    async showMenu(event: Event, menu: string) {\n\n        const components = {\n            text: TextFormatMenu,\n            list: ListMenu,\n            alignment: AlignmentMenu,\n            insert: InsertMenu,\n            heading: HeadingMenu\n        };\n\n        const popover = await this.popoverController.create({\n            component: components[menu],\n            componentProps: {\n                editor: this.editor\n            },\n            event: event,\n            showBackdrop: this.platform.is(\"ios\")\n        });\n\n        popover.present();\n    }\n\n    activeFeatures: {\n        link?: boolean,\n        text?: boolean,\n        alignment?: boolean,\n        heading?: boolean;\n        list?: boolean\n    } = {};\n\n    async editLink() {\n        LinkModal.present(this.modalController, this.editor);\n    }\n\n    canUndo: boolean;\n\n    canRedo: boolean;\n\n    undo() {\n        undo(this.editor.view.state, (transaction) => this.editor.view.updateState(this.editor.view.state.apply(transaction)));\n        this.editor.focus();\n    }\n\n    redo() {\n        redo(this.editor.view.state, (transaction) => this.editor.view.updateState(this.editor.view.state.apply(transaction)));\n        this.editor.focus();\n\n    }\n\n    private editorSelectionChanged() {\n\n        this.canUndo = undoDepth(this.editor.view.state) > 0;\n        this.canRedo = redoDepth(this.editor.view.state) > 0;\n\n        this.activeFeatures = {};\n\n        this.activeFeatures.text = anyMarkActive(this.editor.view.state, [schema.marks.strong, schema.marks.em, schema.marks.underline, schema.marks.fontSize]);\n        this.activeFeatures.list = !!findParentNode(predicate => predicate.hasMarkup(schema.nodes.orderedList) || predicate.hasMarkup(schema.nodes.bulletList))(this.editor.state.selection);\n        this.activeFeatures.alignment = isBlockMarkActive(this.editor.view.state, schema.marks.alignment);\n        this.activeFeatures.heading = !!findParentNodeOfType(schema.nodes.heading)(this.editor.state.selection);\n        this.activeFeatures.link = isMarkActive(this.editor.view.state, schema.marks.link);\n    }\n\n    private selectionSubscription: Subscription;\n\n    async ngOnInit() {\n\n        this.selectionSubscription = this.editor.selectionChange.subscribe(() => this.editorSelectionChanged());\n\n        this.editorSelectionChanged();\n    }\n\n    ngOnDestroy() {\n        unsubscribe(this.selectionSubscription);\n    }\n\n}\n","import {CommonModule} from \"@angular/common\";\nimport {NgModule} from \"@angular/core\";\nimport {FormsModule, ReactiveFormsModule} from \"@angular/forms\";\nimport {MatchMediaModule} from \"@co.mmons/angular-extensions/browser/match-media\";\nimport {IntlModule} from \"@co.mmons/angular-intl\";\nimport {FormHelperModule} from \"@co.mmons/ionic-extensions/form-helper\";\nimport {SelectModule} from \"@co.mmons/ionic-extensions/select\";\nimport {SpinnerModule} from \"@co.mmons/ionic-extensions/spinner\";\nimport {IonicModule} from \"@ionic/angular\";\nimport {ButtonsModule} from \"@co.mmons/ionic-extensions/buttons\";\nimport {AlignmentMenu} from \"./alignment-menu\";\nimport {HtmlEditor} from \"./editor\";\nimport {HeadingMenu} from \"./heading-menu\";\nimport {InsertMenu} from \"./insert-menu\";\nimport {LinkModal} from \"./link-modal\";\nimport {ListMenu} from \"./list-menu\";\nimport {TextFormatMenu} from \"./text-format-menu\";\nimport {Toolbar} from \"./toolbar\";\n\nexport {HtmlEditor} from \"./editor\";\nexport {HtmlEditorFeatures} from \"./editor-features\";\n\n@NgModule({\n    imports: [CommonModule, IonicModule, IntlModule, SelectModule, FormsModule, ReactiveFormsModule, FormHelperModule, ButtonsModule, MatchMediaModule, SpinnerModule],\n    declarations: [HtmlEditor, AlignmentMenu, HeadingMenu, InsertMenu, LinkModal, ListMenu, TextFormatMenu, Toolbar],\n    exports: [HtmlEditor, IntlModule],\n    entryComponents: [AlignmentMenu, HeadingMenu, InsertMenu, LinkModal, ListMenu, TextFormatMenu]\n})\nexport class HtmlEditorModule {\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n\nexport {AlignmentMenu as ɵa} from './alignment-menu';\nexport {HeadingMenu as ɵb} from './heading-menu';\nexport {InsertMenu as ɵc} from './insert-menu';\nexport {LinkModal as ɵd} from './link-modal';\nexport {ListMenu as ɵe} from './list-menu';\nexport {TextFormatMenu as ɵf} from './text-format-menu';\nexport {Toolbar as ɵg} from './toolbar';"],"names":["basicNodes","basicMarks","splitListItem","baseCommand.chainCommands","baseListCommand.liftListItem","baseListCommand.sinkListItem","baseCommand.autoJoin","baseListCommand.wrapInList"],"mappings":"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"}