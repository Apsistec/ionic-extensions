{"version":3,"file":"virtual-scroll-helper-module.js","sources":["ng://@co.mmons/ionic-extensions/virtual-scroll-helper/virtual-scroll-helper.ts","ng://@co.mmons/ionic-extensions/virtual-scroll-helper/index.ts","ng://@co.mmons/ionic-extensions/virtual-scroll-helper/virtual-scroll-helper-module.ts"],"sourcesContent":["import {Directive, ElementRef, HostListener, OnDestroy, OnInit} from \"@angular/core\";\nimport {ViewObserver} from \"@co.mmons/ionic-extensions/view-observer\";\nimport {sleep} from \"@co.mmons/js-utils/core\";\nimport {Platform} from \"@ionic/angular\";\n\n@Directive({\n    selector: \"ion-virtual-scroll\",\n})\nexport class VirtualScrollHelper implements OnInit, OnDestroy {\n\n    constructor(private readonly element: ElementRef<HTMLIonVirtualScrollElement>, private platform: Platform) {\n    }\n\n    private viewObserver: ViewObserver;\n\n    private scheduleRerender: boolean;\n\n    private scrollPosition: number;\n\n    private content: HTMLIonContentElement;\n\n    private contentScrollEndListener: (ev: Event) => void;\n\n    private async contentScrolled() {\n        if (!this.scheduleRerender && this.viewObserver.isActive()) {\n            this.scrollPosition = (await this.content.getScrollElement()).scrollTop;\n        }\n    }\n\n    @HostListener(\"window:resize\")\n    markAsDirtyWhenInactive() {\n        if (!this.viewObserver.isActive()) {\n            this.scheduleRerender = true;\n        }\n    }\n\n    async rerender() {\n\n        await this.element.nativeElement.checkRange(0);\n\n        const scroll = await this.content.getScrollElement();\n\n        for (let i = 0; i < 20; i++) {\n            scroll.scrollTop = this.scrollPosition;\n\n            if (scroll.scrollTop === this.scrollPosition || scroll.scrollHeight < this.scrollPosition) {\n                break;\n            }\n\n            await sleep(100);\n        }\n    }\n\n    ngOnInit() {\n        this.content = this.element.nativeElement.closest(\"ion-content\");\n        this.content.scrollEvents = true;\n        this.content.addEventListener(\"ionScrollEnd\", this.contentScrollEndListener = () => this.contentScrolled());\n\n        this.viewObserver = new ViewObserver(this.content, this.platform);\n    }\n\n    ngOnDestroy() {\n        this.content.removeEventListener(\"ionScrollEnd\" as any, this.contentScrollEndListener);\n        this.viewObserver.destroy();\n    }\n}\n","import {CommonModule} from \"@angular/common\";\nimport {NgModule} from \"@angular/core\";\nimport {IonicModule} from \"@ionic/angular\";\nimport {VirtualScrollHelper} from \"./virtual-scroll-helper\";\n\nexport {VirtualScrollHelper} from \"./virtual-scroll-helper\";\n\n@NgModule({\n    declarations: [VirtualScrollHelper],\n    exports: [VirtualScrollHelper],\n    imports: [CommonModule, IonicModule],\n})\nexport class VirtualScrollHelperModule {\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["tslib_1.__decorate"],"mappings":";;;;;;;;IAUI,6BAA6B,OAAgD,EAAU,QAAkB;QAA5E,YAAO,GAAP,OAAO,CAAyC;QAAU,aAAQ,GAAR,QAAQ,CAAU;KACxG;IAYa,6CAAe,GAA7B;;;;;;8BACQ,CAAC,IAAI,CAAC,gBAAgB,IAAI,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,CAAA,EAAtD,wBAAsD;wBACtD,KAAA,IAAI,CAAA;wBAAmB,qBAAM,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE,EAAA;;wBAA5D,GAAK,cAAc,GAAG,CAAC,SAAqC,EAAE,SAAS,CAAC;;;;;;KAE/E;IAGD,qDAAuB,GAAvB;QACI,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,EAAE;YAC/B,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;SAChC;KACJ;IAEK,sCAAQ,GAAd;;;;;4BAEI,qBAAM,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC,CAAC,EAAA;;wBAA9C,SAA8C,CAAC;wBAEhC,qBAAM,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE,EAAA;;wBAA9C,MAAM,GAAG,SAAqC;wBAE3C,CAAC,GAAG,CAAC;;;8BAAE,CAAC,GAAG,EAAE,CAAA;wBAClB,MAAM,CAAC,SAAS,GAAG,IAAI,CAAC,cAAc,CAAC;wBAEvC,IAAI,MAAM,CAAC,SAAS,KAAK,IAAI,CAAC,cAAc,IAAI,MAAM,CAAC,YAAY,GAAG,IAAI,CAAC,cAAc,EAAE;4BACvF,wBAAM;yBACT;wBAED,qBAAM,KAAK,CAAC,GAAG,CAAC,EAAA;;wBAAhB,SAAgB,CAAC;;;wBAPG,CAAC,EAAE,CAAA;;;;;;KAS9B;IAED,sCAAQ,GAAR;QAAA,iBAMC;QALG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;QACjE,IAAI,CAAC,OAAO,CAAC,YAAY,GAAG,IAAI,CAAC;QACjC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,cAAc,EAAE,IAAI,CAAC,wBAAwB,GAAG,cAAM,OAAA,KAAI,CAAC,eAAe,EAAE,GAAA,CAAC,CAAC;QAE5G,IAAI,CAAC,YAAY,GAAG,IAAI,YAAY,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;KACrE;IAED,yCAAW,GAAX;QACI,IAAI,CAAC,OAAO,CAAC,mBAAmB,CAAC,cAAqB,EAAE,IAAI,CAAC,wBAAwB,CAAC,CAAC;QACvF,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC;KAC/B;;gBAtDqC,UAAU;gBAAiD,QAAQ;;IAoBzGA;QADC,YAAY,CAAC,eAAe,CAAC;sEAK7B;IA1BQ,mBAAmB;QAH/B,SAAS,CAAC;YACP,QAAQ,EAAE,oBAAoB;SACjC,CAAC;OACW,mBAAmB,CAyD/B;IAAD,0BAAC;CAzDD;;;ICIA;KACC;IADY,yBAAyB;QALrC,QAAQ,CAAC;YACN,YAAY,EAAE,CAAC,mBAAmB,CAAC;YACnC,OAAO,EAAE,CAAC,mBAAmB,CAAC;YAC9B,OAAO,EAAE,CAAC,YAAY,EAAE,WAAW,CAAC;SACvC,CAAC;OACW,yBAAyB,CACrC;IAAD,gCAAC;CADD;;ACZA;;GAEG;;;;"}