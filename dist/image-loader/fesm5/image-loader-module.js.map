{"version":3,"file":"image-loader-module.js","sources":["ng://@co.mmons/ionic-extensions/image-loader/image-loader.ts","ng://@co.mmons/ionic-extensions/image-loader/index.ts","ng://@co.mmons/ionic-extensions/image-loader/image-loader-module.ts"],"sourcesContent":["import {Directive, ElementRef, Input} from \"@angular/core\";\nimport {ensureLazyLoad} from \"@co.mmons/ionic-extensions/lazy-load\";\n\nexport interface ImageLoaderStateCssClasses {\n\tloaded?: string;\n\tloading?: string;\n\terror?: string;\n}\n\n@Directive({\n\tselector: \"[ionx-image-loader]\",\n\thost: {\n\t\t\"[attr.ionx-image-loader]\": \"true\"\n\t}\n})\nexport class ImageLoader {\n\n\tconstructor(private element: ElementRef<HTMLElement>) {\n\t}\n\n\tprivate _src: string;\n\n\tprivate _alternate: string;\n\n\tloaded: boolean;\n\n\tloading: boolean;\n\n\terror: boolean;\n\n\t//@ts-ignore\n\tprivate tmpImg: HTMLImageElement;\n\n\tprivate initialized: boolean;\n\n\t@Input(\"src\")\n\tpublic set src(value: string) {\n\t\tlet old = this._src;\n\t\tthis._src = value;\n\n\t\tif (old != this._src) {\n\t\t\tthis.reload();\n\t\t}\n\t}\n\n\tpublic get src() {\n\t\treturn this._src;\n\t}\n\n\t@Input(\"ionx-image-loader\")\n\tprotected set src2(value: string) {\n\t\tthis.src = value;\n\t}\n\n\t@Input(\"alternate\")\n\tpublic set alternate(value: string) {\n\t\tlet old = this._alternate;\n\t\tthis._alternate = value;\n\n\t\tif (old != this._alternate) {\n\t\t\tthis.reload();\n\t\t}\n\t}\n\n\t@Input(\"ionx-image-loader-alternate\")\n\tprotected set alternate2(value: string) {\n\t\tthis.alternate = value;\n\t}\n\n\tprivate _cssClasses: ImageLoaderStateCssClasses;\n\n\t@Input(\"css-classes\")\n\tpublic set cssClasses(value: ImageLoaderStateCssClasses) {\n\t\tthis._cssClasses = value;\n\t}\n\n\t@Input(\"ionx-image-loader-css-classes\")\n\tprotected set cssClasses2(value: ImageLoaderStateCssClasses) {\n\t\tthis._cssClasses = value;\n\t}\n\n\tprivate _cssClassesTarget: string;\n\n\t@Input(\"css-classes-target\")\n\tpublic set cssClassesTarget(value: string) {\n\t\tthis._cssClassesTarget = value;\n\t}\n\n\t@Input(\"ionx-image-loader-css-classes-target\")\n\tprotected set cssClassesParent(value: string) {\n\t\tthis._cssClassesTarget = value;\n\t}\n\n\treload() {\n\t\tif (!this.loading && this.initialized) {\n\t\t\tthis.loaded = false;\n\t\t\tthis.error = false;\n\n\t\t\tif (this._cssClasses) {\n\n\t\t\t\tlet target = this._cssClassesTarget ? this.element.nativeElement.closest(this._cssClassesTarget) : this.element.nativeElement;\n\n\t\t\t\tif (this._cssClasses.loaded) {\n\t\t\t\t\ttarget.classList.remove(this._cssClasses.loaded);\n\t\t\t\t}\n\n\t\t\t\tif (this._cssClasses.error) {\n\t\t\t\t\ttarget.classList.remove(this._cssClasses.error);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis.load();\n\t\t}\n\t}\n\n\tprivate load() {\n\n\t\tif (this.loaded || this.error || !this._src || this.loading) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.loading = true;\n\t\tif (this._cssClasses && this._cssClasses.loading) {\n\t\t\tthis.element.nativeElement.classList.add(this._cssClasses.loading);\n\t\t}\n\n\t\tlet element: HTMLElement = this.element.nativeElement;\n\t\t\n\t\tlet img: HTMLImageElement;\n\n\t\t// if host element is not <img>, we need to create tmp \n\t\tif (element.tagName.toLowerCase() != \"img\") {\n\t\t\timg = this.tmpImg = new Image();\n\t\t} else {\n\t\t\timg = <any>element;\n\t\t}\n\n\t\timg.onload = () => {\n\t\t\t\n\t\t\tif (img !== element) {\n\t\t\t\telement.style.backgroundImage = `url(${img.src})`;\n\t\t\t}\n\n\t\t\timg.onerror = undefined;\n\t\t\timg.onload = undefined;\n\n\t\t\tthis.tmpImg = undefined;\n\t\t\tthis.loaded = true;\n\t\t\tthis.loading = false;\n\t\t\tthis.error = false;\n\n\t\t\tif (this._cssClasses) {\n\t\t\t\tlet target = this._cssClassesTarget ? element.closest(this._cssClassesTarget) : element;\n\n\t\t\t\tif (target) {\n\t\t\t\t\tif (this._cssClasses.loading) {\n\t\t\t\t\t\ttarget.classList.remove(this._cssClasses.loading);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._cssClasses.loaded) {\n\t\t\t\t\t\ttarget.classList.add(this._cssClasses.loaded);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\timg.onerror = () => {\n\n\t\t\tif (this._alternate && this._alternate != img.src) {\n\t\t\t\timg.src = this._alternate;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\timg.onerror = undefined;\n\t\t\timg.onload = undefined;\n\n\t\t\tthis.tmpImg = undefined;\n\t\t\tthis.loading = false;\n\t\t\tthis.loaded = false;\n\t\t\tthis.error = true;\n\n\t\t\tif (this._cssClasses) {\n\t\t\t\tlet target = this._cssClassesTarget ? element.closest(this._cssClassesTarget) : element;\n\n\t\t\t\tif (target) {\n\t\t\t\t\tif (this._cssClasses.loading) {\n\t\t\t\t\t\ttarget.classList.remove(this._cssClasses.loading);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._cssClasses.error) {\n\t\t\t\t\t\ttarget.classList.add(this._cssClasses.error);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\timg.src = this._src;\n\t}\n\n\tngAfterViewInit() {\n\t\tthis.initialized = true;\n\t\tthis.element.nativeElement[\"ionxImageLoader\"] = this;\n\t\tthis.load();\n\t}\n\n\tngOnDestroy() {\n\t\tif (this.element.nativeElement) {\n\t\t\tdelete this.element.nativeElement[\"ionxImageLoader\"];\n\t\t}\n\t}\n\n}\n\nexport async function ensureImagesLoaded(root: HTMLElement, options?: {retryError?: boolean, lazy?: boolean}) {\n\n\tlet images = root.querySelectorAll(\"[ionx-image-loader]\");\n\tfor (let i = 0; i < images.length; i++) {\n\t\tlet image: Element & ImageLoaderElement = images.item(i);\n\n\t\tif (!image.ionxImageLoader || !image.ionxImageLoader.src || image.ionxImageLoader.loaded || (image.ionxImageLoader.error && (!options || !options.retryError))) {\n\t\t\tcontinue;\n\t\t}\n\n\t\timage.ionxImageLoader.reload();\n\t}\n\n\tif (options && options.lazy) {\n\t\tawait ensureLazyLoad(root, {retryError: options && options.retryError});\n\t}\n}\n\ninterface ImageLoaderElement {\n\tionxImageLoader?: ImageLoader;\n}\n","import {NgModule} from \"@angular/core\";\nimport {ImageLoader} from \"./image-loader\";\n\nexport {ImageLoader, ensureImagesLoaded} from \"./image-loader\";\n\n@NgModule({\n    declarations: [ImageLoader],\n    exports: [ImageLoader]\n})\nexport class ImageLoaderModule {\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}